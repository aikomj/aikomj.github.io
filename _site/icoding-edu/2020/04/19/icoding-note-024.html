<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <title> 飞天班第24节：企业项目构建-阿里云视频点播 - 大伟的博客 </title>
    <meta name="keywords" content="springboot，springcloud">
    <meta name="description"
          content="开通阿里云视频点播服务了解收费规则，视频安全HLS加密，使用服务端API/SDK上传播放视频，搭建视频微服务集成到项目中">

    <link rel="canonical" href="http://47.113.95.179/jk-blog/icoding-edu/2020/04/19/icoding-note-024.html">
    <link rel="alternate" type="application/rss+xml" title="大伟,专注Spring Boot,Spring Cloud,Docker,Java后端技术" href="http://47.113.95.179/jk-blog/feed.xml">

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/gitalk.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->

    

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">-->

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/lock.js"></script>
</head>


    <body>

    <header class="site-header">
    <div class="site-header-topbar">
        <div class="container">
            <div class="topbar-menu">
                
                <div class="item">
                    <a href="/archives.html"
                       target="_self"
                       title="Archives">
                        Archives
                    </a>
                </div>
                
                <div class="item">
                    <a href="/linux.html"
                       target="_self"
                       title="Linux">
                        Linux
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mysql.html"
                       target="_self"
                       title="Mysql">
                        Mysql
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mongodb.html"
                       target="_self"
                       title="MongoB">
                        MongoB
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mq.html"
                       target="_self"
                       title="MQ">
                        MQ
                    </a>
                </div>
                
                <div class="item">
                    <a href="/fastdfs.html"
                       target="_self"
                       title="FastDFS">
                        FastDFS
                    </a>
                </div>
                
                <div class="item">
                    <a href="/redis.html"
                       target="_self"
                       title="Redis">
                        Redis
                    </a>
                </div>
                
                <div class="item">
                    <a href="/elasticsearch.html"
                       target="_self"
                       title="ES">
                        ES
                    </a>
                </div>
                
                <div class="item">
                    <a href="/docker.html"
                       target="_self"
                       title="Docker">
                        Docker
                    </a>
                </div>
                
                <div class="item">
                    <a href="/k8s.html"
                       target="_self"
                       title="K8s">
                        K8s
                    </a>
                </div>
                
                <div class="item">
                    <a href="/architect.html"
                       target="_self"
                       title="架构师">
                        架构师
                    </a>
                </div>
                
                <div class="item">
                    <a href="/gitee.html"
                       target="_self"
                       title="开源项目">
                        开源项目
                    </a>
                </div>
                
                <div class="item">
                    <a href="/tool.html"
                       target="_self"
                       title="工具">
                        工具
                    </a>
                </div>
                
                <div class="item">
                    <a href="/life.html"
                       target="_self"
                       title="生活">
                        生活
                    </a>
                </div>
                
                <div class="item">
                    <a href="/say.html"
                       target="_self"
                       title="说说">
                        说说
                    </a>
                </div>
                
                <div class="item">
                    <a href="/link.html"
                       target="_self"
                       title="友链">
                        友链
                    </a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container">
        <a id="site-header-brand" href="/" title="大展宏兔">
            <!--<span class="octicon octicon-mark-github"></span>-->
            <img class="logo" src="/assets/images/favicon.jpeg">
            大展宏兔
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/"
                   target=""
                   title="Home">
                    Home
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Icoding">
                    Icoding
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/icoding-edu.html" 
                           target="_self"
                     >飞天班笔记</a></li>
                    
                    <li><a href="/icoding-gavin.html" 
                           target="_self"
                     >黄埔班笔记</a></li>
                    
                    <li><a href="/icoding-allen.html" 
                           target="_self"
                     >源码分析</a></li>
                    
                    <li><a href="https://www.icodingedu.com/" 
                           target="_blank"
                     >艾编程官网</a></li>
                    
                    <li><a href="https://leetcode-cn.com/problemset/all/" 
                           target="_blank"
                     >力扣刷题</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Java">
                    Java
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/java-base.html" 
                           target="_self"
                     >Java基础</a></li>
                    
                    <li><a href="/java-concurrent.html" 
                           target="_self"
                     >Java并发</a></li>
                    
                    <li><a href="/design-mode.html" 
                           target="_self"
                     >设计模式</a></li>
                    
                    <li><a href="http://www.justdojava.com" 
                           target="_blank"
                     >Java 极客技术</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring.html"
                   target="_self"
                   title="Spring">
                    Spring
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-boot.html"
                   target="_self"
                   title="Spring Boot">
                    Spring Boot
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-cloud.html"
                   target="_self"
                   title="Spring Cloud">
                    Spring Cloud
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Go全栈">
                    Go全栈
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/go-base.html" 
                           target="_self"
                     >Go语言基础</a></li>
                    
                    <li><a href="/go-web.html" 
                           target="_self"
                     >Web开发</a></li>
                    
                    <li><a href="/go-middleware.html" 
                           target="_self"
                     >中间件</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/front.html"
                   target="_self"
                   title="大前端">
                    大前端
                </a>
                
            </div>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="飞天班第24节：企业项目构建-阿里云视频点播">
    <div class="container">
        <div id="jumbotron-meta-info">        
            <h1>飞天班第24节：企业项目构建-阿里云视频点播</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2020/04/19
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container noneed" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h2 id="1了解并开通点播业务">1、了解并开通点播业务</h2>

<p>阅读：<a href="https://blog.csdn.net/qq_33857573/article/details/79564255">阿里云视频点播技术能力盘点</a></p>

<p>​		阿里云视频点播是集音视频<mark>采集、编辑、上传、自动化转码处理、媒体资源管理、分发加速、视频播放</mark>于一体的一站式音视频点播解决方案，为用户提供了Web管理控制台和软件开发工具包（API+SDK，包括视频上传、播放器等），用户可以通过它们使用、管理视频点播服务，也可以与自己的应用或服务集成，快速搭建安全、弹性、高可定制的视频点播功能。
流程：</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-steps.gif" alt="" /></p>

<p>好处：</p>

<ul>
  <li>SDK几行代码即可接入</li>
  <li>私有加密算法加密视频，告别视频安全困扰</li>
  <li>视频+AI加速内容处理效率</li>
  <li>窄带高清技术，最多节省30%流量</li>
</ul>

<blockquote>
  <p>开通服务</p>
</blockquote>

<p>1、找到视频点播</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-product.gif" alt="" /></p>

<p><mark>选择按量计费</mark></p>

<p>了解资费说明 <a href="https://www.aliyun.com/price/product?spm=5176.12672711.overview.8.70f71fa3fxC5xA#/vod/detail">https://www.aliyun.com/price/product?spm=5176.12672711.overview.8.70f71fa3fxC5xA#/vod/detail</a></p>

<p>视频点播服务（后付费）计费项包含：视频加速(CDN）、媒资管理（存储等）、媒体处理（转码）、增值服务（智能审核、视频DNA）。
 其中视频加速可选按[流量]付费或按[日峰值带宽 ]计费</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-money.gif" alt="" /></p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-money2.gif" alt="" /></p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-money3.gif" alt="" /></p>

<p>2、视频上传后，web播放器(静态html代码)</p>

<p><img src="/assets/images/2020/icoding/ali-vod/web-player.gif" alt="" /></p>

<p>3、转码说明</p>

<p>默认不转码，也可以自己添加转码设置（配置管理-》媒体处理配置）</p>

<p><mark>点击模板，高级参数勾选HLS加密，视频就会加密</mark>，十分简单</p>

<p><img src="/images/2020/icoding/ali-vod/vod-transcodetemplate.gif" alt="" /></p>

<p>4、域名绑定：</p>

<p><img src="/assets/images/2020/icoding/ali-vod/bind-cname.gif" alt="" /></p>

<p><img src="/assets/images/2020/icoding/ali-vod/bind-cname-add.gif" alt="" /></p>

<p>添加域名后，配置cname：<a href="https://help.aliyun.com/document_detail/86076.html?spm=5176.12672711.0.0.27ba1fa3AgJtT4">https://help.aliyun.com/document_detail/86076.html?spm=5176.12672711.0.0.27ba1fa3AgJtT4</a></p>

<h2 id="2学会使用服务端api">2、学会使用服务端API</h2>

<p>找到API文档</p>

<p><img src="/assets/images/2020/icoding/ali-vod/api-document.gif" alt="" /></p>

<p>准备工作，使用我们之前的oss子用户账号，开通账号用户组的阿里云点播权限:AliyunVodFullAccess</p>

<p>API，官网：<a href="https://help.aliyun.com/document_detail/44435.html?spm=a2c4g.11186623.6.708.6770448bTi8D8L">https://help.aliyun.com/document_detail/44435.html?spm=a2c4g.11186623.6.708.6770448bTi8D8L</a></p>

<p>创建测试maven项目</p>

<p>导入依赖</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>httpclient<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.5.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>创建工具类AliyunVodApiUtils，复制官方<a href="https://help.aliyun.com/document_detail/44435.html?spm=a2c4g.11186623.6.708.6770448bTi8D8L">调用示例代码</a></p>

<p>测试，原理步骤4步</p>

<p><img src="/assets/images/2020/icoding/ali-vod/get-playauth-test.gif" alt="" /></p>

<p><img src="/assets/images/2020/icoding/ali-vod/get-playauth-generate.gif" alt="" /></p>

<p>加入签名，可以防止重放攻击，接口校验随机数在有效期内的唯一性，避免重复请求。</p>

<p><img src="/assets/images/2020/icoding/ali-vod/get-playauth.gif" alt="" /></p>

<h2 id="3学会使用服务端的sdk">3、学会使用服务端的SDK</h2>

<p>找到SDK文档</p>

<p><img src="/assets/images/2020/icoding/ali-vod/api-document.gif" alt="" /></p>

<p>找到Java SDK</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-sdk.gif" alt="" /></p>

<blockquote>
  <p>安装</p>
</blockquote>

<p>Pom.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 添加阿里云的仓库 --&gt;</span>
<span class="nt">&lt;repositories&gt;</span>
  <span class="nt">&lt;repository&gt;</span>
    <span class="nt">&lt;id&gt;</span>sonatype-nexus-staging<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;name&gt;</span>Sonatype Nexus Staging<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;url&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;releases&gt;</span>
      <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
    <span class="nt">&lt;/releases&gt;</span>
    <span class="nt">&lt;snapshots&gt;</span>
      <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
    <span class="nt">&lt;/snapshots&gt;</span>
  <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/repositories&gt;</span>
</code></pre></div></div>

<p>添加SDK依赖</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.aliyun<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aliyun-java-sdk-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.3.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.aliyun<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aliyun-java-sdk-vod<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.15.5<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.google.code.gson<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>gson<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.8.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>创建工具类AliyunVodSDKUtils，复制官方使用 账号AccessKey 初始化的代码</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AliyunVodSDKUtils</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="nc">DefaultAcsClient</span> <span class="nf">initVodClient</span><span class="o">(</span><span class="nc">String</span> <span class="n">accessKeyId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">accessKeySecret</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ClientException</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">regionId</span> <span class="o">=</span> <span class="s">"cn-shanghai"</span><span class="o">;</span>  <span class="c1">// 点播服务接入区域</span>
		<span class="nc">DefaultProfile</span> <span class="n">profile</span> <span class="o">=</span> <span class="nc">DefaultProfile</span><span class="o">.</span><span class="na">getProfile</span><span class="o">(</span><span class="n">regionId</span><span class="o">,</span> <span class="n">accessKeyId</span><span class="o">,</span> <span class="n">accessKeySecret</span><span class="o">);</span>
		<span class="nc">DefaultAcsClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultAcsClient</span><span class="o">(</span><span class="n">profile</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">client</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>测试</p>
</blockquote>

<p>获取播放凭证</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getVideoPlayAuth</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="c1">// 初始化客户端</span>
  <span class="nc">DefaultAcsClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">AliyunVodSDKUtils</span><span class="o">.</span><span class="na">initVodClient</span><span class="o">(</span><span class="n">access_key_id</span><span class="o">,</span><span class="n">access_key_secret</span><span class="o">);</span>
  <span class="c1">// 请求</span>
  <span class="nc">GetVideoPlayAuthRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GetVideoPlayAuthRequest</span><span class="o">();</span>
  <span class="c1">// 响应</span>
  <span class="nc">GetVideoPlayAuthResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GetVideoPlayAuthResponse</span><span class="o">();</span>

  <span class="c1">// 设置请求参数，视频ID</span>
  <span class="n">request</span><span class="o">.</span><span class="na">setVideoId</span><span class="o">(</span><span class="s">"2126ddd619254837a7fe909ff6242cd6"</span><span class="o">);</span>
  <span class="c1">// 获取请求的响应</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getAcsResponse</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
  <span class="c1">// 播放凭证</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getPlayAuth</span><span class="o">());</span>
  <span class="c1">// 媒体信息</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getVideoMeta</span><span class="o">().</span><span class="na">getTitle</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-sdk-test.gif" alt="" /></p>

<p>获取播放地址</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span>  <span class="kt">void</span> <span class="nf">getPlayInfo</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="c1">// 初始化客户端</span>
  <span class="nc">DefaultAcsClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">AliyunVodSDKUtils</span><span class="o">.</span><span class="na">initVodClient</span><span class="o">(</span><span class="n">access_key_id</span><span class="o">,</span><span class="n">access_key_secret</span><span class="o">);</span>
  <span class="c1">// 请求</span>
  <span class="nc">GetPlayInfoRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GetPlayInfoRequest</span><span class="o">();</span>
  <span class="c1">// 响应</span>
  <span class="nc">GetPlayInfoResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

  <span class="c1">// 设置请求参数，视频ID</span>
  <span class="n">request</span><span class="o">.</span><span class="na">setVideoId</span><span class="o">(</span><span class="s">"2126ddd619254837a7fe909ff6242cd6"</span><span class="o">);</span>
  <span class="c1">// 获取请求的响应</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getAcsResponse</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GetPlayInfoResponse</span><span class="o">.</span><span class="na">PlayInfo</span><span class="o">&gt;</span> <span class="n">playInfoList</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getPlayInfoList</span><span class="o">();</span>
  <span class="c1">//播放地址</span>
  <span class="k">for</span> <span class="o">(</span><span class="nc">GetPlayInfoResponse</span><span class="o">.</span><span class="na">PlayInfo</span> <span class="n">playInfo</span> <span class="o">:</span> <span class="n">playInfoList</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"PlayInfo.PlayURL = "</span> <span class="o">+</span> <span class="n">playInfo</span><span class="o">.</span><span class="na">getPlayURL</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">//Base信息</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"VideoBase.Title = "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">getVideoBase</span><span class="o">().</span><span class="na">getTitle</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/ali-vod/get-playinfo-test.gif" alt="" /></p>

<h2 id="4视频安全hls加密">4、视频安全(HLS加密)</h2>

<p><a href="https://help.aliyun.com/document_detail/68612.html?spm=5176.12672711.0.0.3eaf1fa3tKH06A">hls标准加密</a></p>

<p>转码模版组，勾选hls加密</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-transcode-hls.gif" alt="" /></p>

<p>要使用加密，必须绑定域名备案</p>

<h2 id="5视频上传">5、视频上传</h2>

<h3 id="sdk安装">SDK安装</h3>

<p>文档：<a href="https://help.aliyun.com/document_detail/53406.html?spm=a2c4g.11186623.2.20.57ff7bdc2K8gXK">https://help.aliyun.com/document_detail/53406.html?spm=a2c4g.11186623.2.20.57ff7bdc2K8gXK</a></p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-upload-sdk-doc.gif" alt="" /></p>

<p>点击<a href="https://help.aliyun.com/document_detail/51992.html?spm=a2c4g.11186623.2.25.318d3815dY9mfI">视频上传SDK下载</a></p>

<p>找到服务端SDK下载，下载Java上传1.4.2及示例代码</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-upload-java-sdk-demo.gif" alt="" /></p>

<p>解压后的lib目录就是所需要的jar包。</p>

<p>安装官方文档所说，除了aliyun-java-vod-upload-1.4.12.jar 其他依赖都可以通过maven安装依赖，因为它还没有开源，需要手动引入依赖到自己的项目中。</p>

<p>添加依赖的两种方式：</p>

<ul>
  <li>
    <p>直接添加到项目</p>

    <p>项目/resources文件夹下建立lib目录,add as library，jar包放在lib目录下。</p>
  </li>
  <li>
    <p>添加到本地maven仓库</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn <span class="nb">install</span>:install-file <span class="nt">-DgroupId</span><span class="o">=</span>com.aliyun <span class="nt">-DartifactId</span><span class="o">=</span>aliyun-java-vod-upload <span class="nt">-Dversion</span><span class="o">=</span>1.4.12 <span class="nt">-Dpackaging</span><span class="o">=</span>jar <span class="nt">-Dfile</span><span class="o">=</span>/Users/xjw/Downloads/VODUploadDemo-java-1.4.12/lib/aliyun-java-vod-upload-1.4.12.jar 
</code></pre></div>    </div>
  </li>
</ul>

<p>添加依赖</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.aliyun.oss<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aliyun-sdk-oss<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.aliyun<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aliyun-java-sdk-vod<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.15.2<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>fastjson<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.2.28<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.json<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>json<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>20170516<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- 将我们自己导入的以来放入，确定它进来了！ --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.aliyun<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>aliyun-java-vod-upload<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.4.12<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h3 id="后端使用java上传视频">后端使用java上传视频</h3>

<p>复制官方的示例代码，参数可自行调整开启</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-sdk-upload-test.gif" alt="" /></p>

<p>运行成功，获得视频ID</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-sdk-upload-test-sucees.gif" alt="" /></p>

<h3 id="前端使用js上传视频">前端使用js上传视频</h3>

<p>官方文档：<a href="https://help.aliyun.com/document_detail/52204.html">https://help.aliyun.com/document_detail/52204.html</a></p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-upload-js-sdk.gif" alt="" /></p>

<h2 id="6视频播放">6、视频播放</h2>

<p>官方文档：<a href="https://help.aliyun.com/document_detail/125548.html">https://help.aliyun.com/document_detail/125548.html</a></p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-player.gif" alt="" /></p>

<p>在线配置</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-player-online-setting.gif" alt="" /></p>

<blockquote>
  <p>开通视频功能集成到项目中步骤：</p>
</blockquote>

<p>1、开通阿里云点播服务</p>

<p>2、编写后端上传视频工具类，返回视频id</p>

<p>3、前端视频vue，自己写或者爬取好看的视频播放页面，将视频放上去播放即可</p>

<p>前端播放功能配置：弹幕、音量等，官方文档：<a href="https://help.aliyun.com/document_detail/125574.html">https://help.aliyun.com/document_detail/125574.html</a></p>

<h2 id="7视频微服务搭建">7、视频微服务搭建</h2>

<h3 id="后端上传api">后端上传API</h3>

<p>创建微服务模块edu-vod</p>

<p><img src="/assets/images/2020/icoding/ali-vod/edu-vod.gif" alt="" /></p>

<p>初始化加载accesskey</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 初始化加载</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConstantPropertiesUtils</span> <span class="kd">implements</span> <span class="nc">InitializingBean</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${aliyun.vod.file.accessKeyId}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">keyId</span><span class="o">;</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${aliyun.vod.file.accessKeySecret}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">keySecret</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">ACCESS_KEY_ID</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">ACCESS_KEY_SECRET</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterPropertiesSet</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="no">ACCESS_KEY_ID</span> <span class="o">=</span> <span class="n">keyId</span><span class="o">;</span>
        <span class="no">ACCESS_KEY_SECRET</span> <span class="o">=</span> <span class="n">keySecret</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>业务层接口VideoService</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">VideoService</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="nf">uploadVideo</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>接口实现类VideoServiceImpl</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VideoServiceImpl</span> <span class="kd">implements</span> <span class="nc">VideoService</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">uploadVideo</span><span class="o">(</span><span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 获取文件名称</span>
		<span class="nc">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="n">filename</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="s">"."</span><span class="o">));</span>
		<span class="nc">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>


		<span class="c1">// 封装上传</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">inputStream</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">JudeException</span><span class="o">(</span><span class="nc">ResultCodeEnum</span><span class="o">.</span><span class="na">VIDEO_UPLOAD_TOMCAT_ERROR</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="c1">// 流上传到阿里云</span>
		<span class="nc">UploadStreamRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UploadStreamRequest</span><span class="o">(</span><span class="nc">ConstantPropertiesUtils</span><span class="o">.</span><span class="na">ACCESS_KEY_ID</span><span class="o">,</span>
				<span class="nc">ConstantPropertiesUtils</span><span class="o">.</span><span class="na">ACCESS_KEY_SECRET</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span><span class="n">filename</span><span class="o">,</span><span class="n">inputStream</span><span class="o">);</span>
		<span class="nc">UploadVideoImpl</span> <span class="n">uploader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UploadVideoImpl</span><span class="o">();</span>
		<span class="nc">UploadStreamResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">uploader</span><span class="o">.</span><span class="na">uploadStream</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
		<span class="nc">String</span> <span class="n">vdieoId</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getVideoId</span><span class="o">();</span>

		<span class="k">if</span><span class="o">(!</span><span class="n">response</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">vdieoId</span><span class="o">)){</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">JudeException</span><span class="o">(</span><span class="nc">ResultCodeEnum</span><span class="o">.</span><span class="na">VIDEO_UPLOAD_ALIYUN_ERROR</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">vdieoId</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>web层接口的定义</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Api</span><span class="o">(</span><span class="n">description</span> <span class="o">=</span> <span class="s">"阿里云视频点播微服务"</span><span class="o">)</span>
<span class="nd">@CrossOrigin</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/admin/vod/video"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VideoAdminController</span> <span class="o">{</span>
	<span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="nc">VideoService</span> <span class="n">videoService</span><span class="o">;</span>

	<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"upload"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="no">R</span> <span class="nf">uploadVideo</span><span class="o">(</span>
			<span class="nd">@ApiParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"file"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"文件"</span><span class="o">,</span><span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
			<span class="nd">@RequestParam</span> <span class="nc">MultipartFile</span> <span class="n">file</span><span class="o">){</span>
		<span class="nc">String</span> <span class="n">videoId</span> <span class="o">=</span> <span class="n">videoService</span><span class="o">.</span><span class="na">uploadVideo</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
		<span class="k">return</span> <span class="no">R</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">message</span><span class="o">(</span><span class="s">"视频上传成功"</span><span class="o">).</span><span class="na">data</span><span class="o">(</span><span class="s">"videoId"</span><span class="o">,</span><span class="n">videoId</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>swagger2测试</p>

<p><img src="/assets/images/2020/icoding/ali-vod/vod-upload-swagger-test.gif" alt="" /></p>

<blockquote>
  <p>配置nginx</p>
</blockquote>

<p>location路由和允许上传的文件大小，否则会报413Request Entity Too large 异常</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">/vod/</span><span class="p">{</span>
  <span class="kn">proxy_pass</span> <span class="s">http://localhost:8160</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">http</span> <span class="p">{</span>
  <span class="kn">...</span>
  <span class="s">client_max_body_size</span> <span class="mi">1024m</span><span class="p">;</span>
  <span class="kn">...</span>
<span class="err">}</span>
</code></pre></div></div>

<blockquote>
  <p>删除视频</p>
</blockquote>

<p>点进com.aliyun.AcsRequest的源码，发现它是一个抽象类,查看它的实现类</p>

<p><img src="/assets/images/2020/icoding/ali-vod/asyncRequest.gif" alt="" /></p>

<p>找到DeleteVideoRequest类，通过这个请求删除阿里云上的视频</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeVideo</span><span class="o">(</span><span class="nc">String</span> <span class="n">videoId</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">DefaultAcsClient</span> <span class="n">client</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">client</span> <span class="o">=</span> <span class="nc">AliyunVodSDKUtils</span><span class="o">.</span><span class="na">initVodClient</span><span class="o">(</span><span class="nc">ConstantPropertiesUtils</span><span class="o">.</span><span class="na">ACCESS_KEY_ID</span><span class="o">,</span><span class="nc">ConstantPropertiesUtils</span><span class="o">.</span><span class="na">ACCESS_KEY_SECRET</span><span class="o">);</span>
    <span class="c1">// 删除请求</span>
    <span class="nc">DeleteVideoRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DeleteVideoRequest</span><span class="o">();</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setVideoIds</span><span class="o">(</span><span class="n">videoId</span><span class="o">);</span>
    <span class="nc">DeleteVideoResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getAcsResponse</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClientException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">JudeException</span><span class="o">(</span><span class="nc">ResultCodeEnum</span><span class="o">.</span><span class="na">VIDEO_DELETE_ALIYUM_ERROR</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="整合前端上传">整合前端上传</h3>

<p>前端模版</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;el-form-item</span> <span class="na">label=</span><span class="s">"上传视频"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;el-upload</span>
          <span class="na">drag</span>
          <span class="na">:file-list=</span><span class="s">"fileList"</span>
          <span class="na">:on-success=</span><span class="s">"handleVodUploadSuccess"</span>
          <span class="na">:on-error=</span><span class="s">"handleVodUploadError"</span>
          <span class="na">:on-exceed=</span><span class="s">"handleVodExceed"</span>
          <span class="na">:on-remove=</span><span class="s">"handleVodRemove"</span>
          <span class="na">:before-remove=</span><span class="s">"handleVodBeforeRemove"</span>
          <span class="na">:on-progress=</span><span class="s">"handleVodUploadProgress"</span>
          <span class="na">:limit=</span><span class="s">"1"</span>
          <span class="na">:action=</span><span class="s">"uploadUrl"</span>
          <span class="nt">&gt;</span>
          <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"el-icon-upload"</span><span class="nt">&gt;&lt;/i&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"el-upload__text"</span><span class="nt">&gt;</span>将文件拖到此处，或<span class="nt">&lt;em&gt;</span>点击上传<span class="nt">&lt;/em&gt;&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">slot=</span><span class="s">"tip"</span> <span class="na">class=</span><span class="s">"el-upload__tip"</span><span class="nt">&gt;</span>支持3GP、ASF、AVI、DAT、DV、FLV、F4V、GIF、M2T、M4V、MJ2、MJPEG、MKV、MOV、MP4、MPE、MPG、MPEG、MTS、OGG、QT、RM、RMVB、SWF、TS、VOB、WMV、WEBM 等视频格式上传<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/el-upload&gt;</span>
<span class="nt">&lt;/el-form-item&gt;</span>
</code></pre></div></div>

<p>Vod.js</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">request</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/utils/request</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">api_name</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/admin/vod/video</span><span class="dl">'</span>
 
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">removeById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">request</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">api_name</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">delete</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Method:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">vod</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/api/edu/vod</span><span class="dl">'</span>
<span class="p">...</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="na">method</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">...</span>
   	<span class="nx">handleVodUploadSuccess</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span><span class="nx">file</span><span class="p">,</span><span class="nx">fileList</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fileUoloadBtnText</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">上传到服务器</span><span class="dl">'</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">video</span><span class="p">.</span><span class="nx">videoSourceId</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">videoId</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">video</span><span class="p">.</span><span class="nx">videoOriginalName</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">handleVodUploadError</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">},</span>
    <span class="nx">handleVodUploadProgress</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">fileUoloadBtnText</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">正在上传</span><span class="dl">'</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">handleVodExceed</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$message</span><span class="p">({</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">文件数超出限制，请删除已有视频再上传</span><span class="dl">'</span>
        <span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">handleVodRemove</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//console.log(file)</span>
      <span class="nx">vod</span><span class="p">.</span><span class="nx">removeById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">video</span><span class="p">.</span><span class="nx">videoSourceId</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">video</span><span class="p">.</span><span class="nx">videoSourceId</span> <span class="o">=</span> <span class="dl">''</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">video</span><span class="p">.</span><span class="nx">videoOriginalName</span> <span class="o">=</span> <span class="dl">''</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$message</span><span class="p">({</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">message</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">message</span>
        <span class="p">})</span>
      <span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">handleVodBeforeRemove</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$confirm</span><span class="p">(</span><span class="s2">`确定移除</span><span class="p">${</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">?`</span><span class="p">)</span>
    <span class="p">}</span> 
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>测试：</p>

<p><img src="/assets/images/2020/icoding/ali-vod/course-upload-video.gif" alt="" /></p>

<p>后端上传视频的方式，无法看到视频在服务端tomcat到阿里云的文件上传进度，考虑使用javascript上传，文件由客户端直接上传到阿里云，不经过后端。</p>


            <div>
   <!-- <p align="center">
     	  
         <img src="/assets/images/keeppuresmile.jpg" >
         <br/>
         微信扫描二维码，关注一个有故事的程序员
        

   </p>
   <p align="center" style="margin-top: 15px; font-size: 11px;color: #cc0000;">
       <strong>（转载本站文章请注明作者和出处 <a href="http://www.ityouknow.com">纯洁的微笑-ityouknow</a>）</strong>
   </p>
   <p align="center" style="margin-top: 15px; font-size: 16px;color: #337ab7;">
       <strong><a href="http://www.justdojava.com/" target="_blank">点击了解 ：Java 技术人的网站</a></strong>
   </p> -->
</div>

            <!-- Comments -->
            <div class="comment">
             

  

  
        <div id="gitalk-container"></div>
        <script src="/assets/js/gitalk.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
        <script>
        var gitalk = new Gitalk({
            id: '/icoding-edu/2020/04/19/icoding-note-024.html',
            clientID: '6cd8ad4d1cf1d1e6ad95',
            clientSecret: 'c4ce22a25efe50bfd60da67c990b534bc99a6424',
            repo: 'aikomj.github.io',
            owner: 'aikomj',
            admin: ['aikomj'],
            labels: ['gitalk'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


            </div>
        </div>

        <div class="col-md-3">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>
     <!--<div class="asb-post-01">-->
        <!--<div class="mask"></div>-->
            <!--<div class="info">-->
                <!--<div>扫码关注公众号：<span style="color: #E9405A; font-weight: bold;">纯洁的微笑</span></div>-->
            <!--<div>-->
            <!--<span>发送 </span><span class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span>-->
            <!--<div>-->
                <!--即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章-->
            <!--</div>-->
            <!--<img class="code-img" style="width: 300px;display:unset" src="/assets/images/keeppuresmile.jpg">-->
        <!--</div>-->
    <!--</div>-->
</article>

        </div>

    
<footer class="container">
    <div class="site-footer">
       <!--  <div class="site-footer-icons">
            <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
               知乎
            </a>
            <a target="_blank" href="http://weibo.com/ityouknow">
               微博
            </a>
            <a target="_blank" href="https://github.com/ityouknow">
                GitHub
            </a>
        </div> -->
        <!-- <div class="card text-center">
            <ul class="list-inline" style="margin-left: 0;">
               <li>
                <a target="_blank" href="https://github.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa  fa-stack-1x fa-inverse">知</i>
                  </span>
                </a>
              </li>
                  <li>
                <a target="_blank" href="https://weibo.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          </ul>
        </div> -->
        <div class="site-footer-links mobile-hidden">
            
        </div>
        <div class="scrolltop">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>
        <div class="rss">
            <a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a>
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>
    </div>
    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>
    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>
    
    
     <!-- Cnzz Analytics -->
       <div style="display:none">
         <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260945749'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260945749' type='text/javascript'%3E%3C/script%3E"));</script>
       </div>
     <!-- Cnzz Analytics -->
</footer>


    </body>

</html>
