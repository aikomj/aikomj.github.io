<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <title> 飞天班第43节：Docker精通-1 - 大伟的博客 </title>
    <meta name="keywords" content="docker">
    <meta name="description"
          content="docker 为什么会出现，devops,安装docker，阿里云镜像加速，docker的底层原理，与vm的隔离比较，docker的帮助命令，镜像命令，容器命令，后台运行镜像，查看日志，进入容器，容器与宿主机拷贝文件，docker的全部命令思维导图，docker安装nginx,tomcat,es+kibana">

    <link rel="canonical" href="http://47.113.95.179/jk-blog/icoding-edu/2020/06/03/icoding-note-043.html">
    <link rel="alternate" type="application/rss+xml" title="大伟,专注Spring Boot,Spring Cloud,Docker,Java后端技术" href="http://47.113.95.179/jk-blog/feed.xml">

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/gitalk.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->

    

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">-->

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/lock.js"></script>
</head>


    <body>

    <header class="site-header">
    <div class="site-header-topbar">
        <div class="container">
            <div class="topbar-menu">
                
                <div class="item">
                    <a href="/archives.html"
                       target="_self"
                       title="Archives">
                        Archives
                    </a>
                </div>
                
                <div class="item">
                    <a href="/linux.html"
                       target="_self"
                       title="Linux">
                        Linux
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mysql.html"
                       target="_self"
                       title="Mysql">
                        Mysql
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mongodb.html"
                       target="_self"
                       title="MongoB">
                        MongoB
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mq.html"
                       target="_self"
                       title="MQ">
                        MQ
                    </a>
                </div>
                
                <div class="item">
                    <a href="/fastdfs.html"
                       target="_self"
                       title="FastDFS">
                        FastDFS
                    </a>
                </div>
                
                <div class="item">
                    <a href="/redis.html"
                       target="_self"
                       title="Redis">
                        Redis
                    </a>
                </div>
                
                <div class="item">
                    <a href="/elasticsearch.html"
                       target="_self"
                       title="ES">
                        ES
                    </a>
                </div>
                
                <div class="item">
                    <a href="/docker.html"
                       target="_self"
                       title="Docker">
                        Docker
                    </a>
                </div>
                
                <div class="item">
                    <a href="/k8s.html"
                       target="_self"
                       title="K8s">
                        K8s
                    </a>
                </div>
                
                <div class="item">
                    <a href="/architect.html"
                       target="_self"
                       title="架构师">
                        架构师
                    </a>
                </div>
                
                <div class="item">
                    <a href="/gitee.html"
                       target="_self"
                       title="开源项目">
                        开源项目
                    </a>
                </div>
                
                <div class="item">
                    <a href="/tool.html"
                       target="_self"
                       title="工具">
                        工具
                    </a>
                </div>
                
                <div class="item">
                    <a href="/life.html"
                       target="_self"
                       title="生活">
                        生活
                    </a>
                </div>
                
                <div class="item">
                    <a href="/say.html"
                       target="_self"
                       title="说说">
                        说说
                    </a>
                </div>
                
                <div class="item">
                    <a href="/link.html"
                       target="_self"
                       title="友链">
                        友链
                    </a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container">
        <a id="site-header-brand" href="/" title="大展宏兔">
            <!--<span class="octicon octicon-mark-github"></span>-->
            <img class="logo" src="/assets/images/favicon.jpeg">
            大展宏兔
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/"
                   target=""
                   title="Home">
                    Home
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Icoding">
                    Icoding
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/icoding-edu.html" 
                           target="_self"
                     >飞天班笔记</a></li>
                    
                    <li><a href="/icoding-gavin.html" 
                           target="_self"
                     >黄埔班笔记</a></li>
                    
                    <li><a href="/icoding-allen.html" 
                           target="_self"
                     >源码分析</a></li>
                    
                    <li><a href="https://www.icodingedu.com/" 
                           target="_blank"
                     >艾编程官网</a></li>
                    
                    <li><a href="https://leetcode-cn.com/problemset/all/" 
                           target="_blank"
                     >力扣刷题</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Java">
                    Java
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/java-base.html" 
                           target="_self"
                     >Java基础</a></li>
                    
                    <li><a href="/java-concurrent.html" 
                           target="_self"
                     >Java并发</a></li>
                    
                    <li><a href="/design-mode.html" 
                           target="_self"
                     >设计模式</a></li>
                    
                    <li><a href="http://www.justdojava.com" 
                           target="_blank"
                     >Java 极客技术</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring.html"
                   target="_self"
                   title="Spring">
                    Spring
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-boot.html"
                   target="_self"
                   title="Spring Boot">
                    Spring Boot
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-cloud.html"
                   target="_self"
                   title="Spring Cloud">
                    Spring Cloud
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Go全栈">
                    Go全栈
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/go-base.html" 
                           target="_self"
                     >Go语言基础</a></li>
                    
                    <li><a href="/go-web.html" 
                           target="_self"
                     >Web开发</a></li>
                    
                    <li><a href="/go-middleware.html" 
                           target="_self"
                     >中间件</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/front.html"
                   target="_self"
                   title="大前端">
                    大前端
                </a>
                
            </div>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="飞天班第43节：Docker精通-1">
    <div class="container">
        <div id="jumbotron-meta-info">        
            <h1>飞天班第43节：Docker精通-1</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2020/06/03
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container noneed" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h2 id="1docker概述">1、Docker概述</h2>

<p>为什么学习docker?</p>

<p>因为现在的技术越来越智能化，以前系统上线全部手动操作部署，过渡到现在的云原生一步到位完成部署。</p>

<h3 id="docker为什么会出现">docker为什么会出现？</h3>

<p><mark>开发和运维的协同</mark></p>

<ul>
  <li>开发说：这个代码在我这里没有问题！</li>
  <li>运维说：你的代码就是在服务器上跑不起来！</li>
</ul>

<p>一款产品从开发到上线： 操作系统，运行环境，应用配置，都可能不同，开发和运维协同很麻烦！</p>

<p>很麻烦，原生的东西十分的麻烦，横向扩展，重新配置服务器，费时费力。</p>

<p>我们的应用能不能带上我们环境一起发布！使用docker，解决这个问题</p>

<p><img src="/assets/images/2020/icoding/docker/docker-images.png" alt="" /></p>

<p>上面的图所示把程序应用和所依赖的环境一起涵盖到项目中作为一个整体（镜像）打包发布，避免了程序放到服务器上后需要重新配置环境。就好像前面学习的active mq服务，使用broker 把mq服务集成到应用中，就不需要服务器开启mq服务了，因为项目内嵌了一个mq服务，随项目启动而启动。docker跟这个思想非常相似，它使用的是镜像容器的概念。</p>

<p>如果存在这样一个技术，我们以后打包上线一个人搞定！</p>

<h3 id="开发运维---devops">开发/运维   DevOps</h3>

<p>公司中职责分明：开发和运维的界限是越来越不清楚了！Docker加速了这个过程！</p>

<p>Docker的Logo  : 一条鲸鱼载着很多个集装箱！</p>

<p><img src="/assets/images/2020/icoding/docker/docker-logo.png" alt="" /></p>

<p>鲸鱼就相当于宿主机，集装箱就相当于装着应用的一个个容器，<mark>隔离</mark>。</p>

<p>比如一艘船：水果，生化武器（正常情况不能同时运输）如果需要运输，装箱隔离！</p>

<p>Docker的核心理念就是如此！</p>

<p>系统：10个应用， mysql，tomcat，redis（可能会公用或者混用！）单独配置！  把应用和它依赖的环境一起装箱打包成镜像，10个应用就打包10个镜像。每个镜像运行后都会创建一个容器，容器里运行的就是一个应用和它依赖 的mqsql，tomcat，redis等环境。容器都是相互隔离的，如下图：</p>

<p><img src="/assets/images/2020/icoding/docker/docker-images-to-containers.png" alt="" /></p>

<p>虚拟机是这样隔离的，每个vm就相当于一个服务器（虚拟硬件）：</p>

<p><img src="/assets/images/2020/icoding/docker/vm.png" alt="" /></p>

<p>Docker 就是更加细粒度的隔离，不需要模拟硬件，只需要服务运行的环境即可！</p>

<p>Docker 是 基于 Go 语言实现的云开源项目！</p>

<font color="red">核心概念： 容器-镜像-仓库</font>

<h3 id="docker的基本组成">Docker的基本组成</h3>

<p>官网：<a href="https://www.docker.com/">https://www.docker.com/</a></p>

<p><img src="/assets/images/2020/icoding/docker/docker-com.gif" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/docker-hub.gif" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/client-dockerhost-registry.png" alt="" /></p>

<p>客户机 + docker程序(docker_host)+ 仓库（本地和远程）</p>

<h2 id="2docker安装">2、Docker安装</h2>

<p><img src="/assets/images/2020/icoding/docker/get-docker.gif" alt="" /></p>

<p>官方文档：<a href="https://docs.docker.com/">https://docs.docker.com/</a></p>

<p>Linux的文档：https://docs.docker.com/engine/install/</p>

<p>基于CentOS的安装：https://docs.docker.com/engine/install/centos/</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c"># 查看系统内核，3.10.0 以上才支持docker运行</span>
<span class="o">[</span>root@kuangshen ~]# <span class="nb">uname</span> <span class="nt">-r</span> 
3.10.0-1062.12.1.el7.x86_64
<span class="c"># 查看系统版本</span>
<span class="o">[</span>root@kuangshen ~]# <span class="nb">cat</span> /etc/os-release
<span class="nv">NAME</span><span class="o">=</span><span class="s2">"CentOS Linux"</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">"7 (Core)"</span>
<span class="nv">ID</span><span class="o">=</span><span class="s2">"centos"</span>
<span class="nv">ID_LIKE</span><span class="o">=</span><span class="s2">"rhel fedora"</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">"7"</span>
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">"CentOS Linux 7 (Core)"</span>
<span class="nv">ANSI_COLOR</span><span class="o">=</span><span class="s2">"0;31"</span>
<span class="nv">CPE_NAME</span><span class="o">=</span><span class="s2">"cpe:/o:centos:centos:7"</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">"https://www.centos.org/"</span>
<span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">"https://bugs.centos.org/"</span>

<span class="nv">CENTOS_MANTISBT_PROJECT</span><span class="o">=</span><span class="s2">"CentOS-7"</span>
<span class="nv">CENTOS_MANTISBT_PROJECT_VERSION</span><span class="o">=</span><span class="s2">"7"</span>
<span class="nv">REDHAT_SUPPORT_PRODUCT</span><span class="o">=</span><span class="s2">"centos"</span>
<span class="nv">REDHAT_SUPPORT_PRODUCT_VERSION</span><span class="o">=</span><span class="s2">"7"</span>
</code></pre></div></div>

<blockquote>
  <p>安装</p>
</blockquote>

<p>1、卸载旧的版本</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum remove docker <span class="se">\</span>
                  docker-client <span class="se">\</span>
                  docker-client-latest <span class="se">\</span>
                  docker-common <span class="se">\</span>
                  docker-latest <span class="se">\</span>
                  docker-latest-logrotate <span class="se">\</span>
                  docker-logrotate <span class="se">\</span>
                  docker-engine
</code></pre></div></div>

<p>2、环境需求，软件包，仓库</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># gcc 环境</span>
yum <span class="nb">install</span> <span class="nt">-y</span> gcc
yum <span class="nb">install</span> <span class="nt">-y</span> gcc-c++
<span class="c"># </span>
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> yum-utils
<span class="c"># 国外的镜像地址</span>
<span class="nv">$ </span><span class="nb">sudo </span>yum-config-manager <span class="nt">--add-repo</span> https://download.docker.com/linux/centos/docker-ce.repo

<span class="c"># 国外的镜像地址在国内很慢，我们一般配置阿里云的镜像地址</span>
yum-config-manager <span class="nt">--add-repo</span> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div></div>

<p>3、更新软件索引包 <code class="highlighter-rouge">yum makecache fast</code></p>

<p>4、安装docker引擎</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># docker-ce 社区版本， docker-ee 企业版本</span>
yum <span class="nb">install </span>docker-ce docker-ce-cli containerd.io
</code></pre></div></div>

<p>5、启动docker</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start docker

<span class="c"># 停止docker</span>
systemctl stop docker
</code></pre></div></div>

<p>6、运行helloworld镜像测试</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run hello-world
</code></pre></div></div>

<p>出现以下效果：代表安装成功！</p>

<p><img src="/assets/images/2020/icoding/docker/docker-run-helloworld.png" alt="" /></p>

<blockquote>
  <p>卸载docker</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1、卸载docker引擎</span>
<span class="o">[</span>root@kuangshen ~]# <span class="nb">sudo </span>yum remove docker-ce docker-ce-cli containerd.io

<span class="c"># 2、删除相关文件</span>
<span class="o">[</span>root@kuangshen ~]# <span class="nb">sudo rm</span> <span class="nt">-rf</span> /var/lib/docker

<span class="c"># docker的默认目录</span>
<span class="o">[</span>root@kuangshen ~]# <span class="nb">cd</span> /var/lib/docker
<span class="o">[</span>root@kuangshen docker]# <span class="nb">ls
</span>builder   containers  network   plugins   swarm  trust
buildkit  image       overlay2  runtimes  tmp    volumes
</code></pre></div></div>

<h2 id="3阿里云镜像加速">3、阿里云镜像加速</h2>

<p>登录阿里云，搜索容器镜像服务</p>

<p><img src="/assets/images/2020/icoding/docker/ali-docker-acr.gif" alt="" /></p>

<p>进入管理控制台：</p>

<p><img src="/assets/images/2020/icoding/docker/ali-images-containers-service.png" alt="" /></p>

<p>点击”镜像加速”，可以看到自己的镜像加速地址，选择Centos，修改配置/etc/docker/daemon.json来使用加速器</p>

<p><img src="/assets/images/2020/icoding/docker/ali-images-registry-pull-faster.png" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1、创建文件夹</span>
<span class="o">[</span>root@alibaba ~]# <span class="nb">mkdir</span> <span class="nt">-p</span> /etc/docker
<span class="c"># 2、配置自己的镜像加速地址</span>
<span class="o">[</span>root@alibaba ~]# <span class="nb">tee</span> /etc/docker/daemon.json <span class="o">&lt;&lt;-</span><span class="sh">'</span><span class="no">EOF</span><span class="sh">'
{
  "registry-mirrors": ["https://dyv68vb0.mirror.aliyuncs.com"]
}
</span><span class="no">EOF
</span><span class="c"># 3、重启daemon进程</span>
<span class="o">[</span>root@alibaba ~]# systemctl daemon-reload
<span class="c"># 4、重启docker</span>
<span class="o">[</span>root@alibaba ~]# systemctl restart docker
</code></pre></div></div>

<h2 id="4docker是如何工作的">4、Docker是如何工作的</h2>

<h3 id="运行镜像">运行镜像</h3>

<p>安装docker的时候我们运行了hello world镜像</p>

<p><img src="/assets/images/2020/icoding/docker/docker-run-helloworld.png" alt="" /></p>

<p><mark>docker run的原理</mark></p>

<p><img src="/assets/images/2020/icoding/docker/docker-run-flow.png" alt="" /></p>

<p>如果dockerhub上没有对应的镜像，会提示你登录自己的仓库获取镜像。</p>

<p><img src="/assets/images/2020/icoding/docker/docker-run-not-found-images.png" alt="" /></p>

<h3 id="底层原理">底层原理</h3>

<blockquote>
  <p>镜像</p>
</blockquote>

<p>Docker 中一个个的模板，Redis镜像（会包含这个服务需要的所有环境），一个镜像可以创建多个容器运行！</p>

<p>镜像就是一个模板而已，它包含服务本身和一套环境，比如</p>

<p>(shop.war + redis + mysql + tomcat) =&gt; myshop 镜像</p>

<blockquote>
  <p>容器</p>
</blockquote>

<p>Docker 通过镜像来创建一个个的容器实例（run，运行产生的）</p>

<p>容器就是我们正真的服务。</p>

<p>(shop.war + redis + mysql + tomcat) =&gt; myshop 镜像</p>

<p>docker run myshop == &gt;  容器 （暴露端口、数据需要同步到本地、配置网络）==&gt; 访问服务即可！</p>

<p>容器（最终运行的项目），操作：<font color="red">开启、停止、重启、删除。。。。</font></p>

<p>容器之间是相互隔离的！</p>

<blockquote>
  <p>仓库</p>
</blockquote>

<p>存放镜像的位置，DockerHub（最大的公有仓库）。</p>

<p>分为公有仓库、 私有仓库(比如自己在阿里云的镜像仓库)</p>

<p>大家可以先去DockerHub 注册一个账号，可以发布自己的镜像，就像github创建一个公有仓库，开源自己的项目一样。</p>

<blockquote>
  <p>底层原理</p>
</blockquote>

<p>Docker   C-S 结构！</p>

<p><img src="/assets/images/2020/icoding/docker/docker-cs-arch.png" alt="" /></p>

<h3 id="docker-和--vm的隔离比较">Docker 和  VM的隔离比较</h3>

<p>虚拟机：创建 guest os（虚拟的系统），和真实的一样，但比较耗资源，启动也慢，然后在guest os上运行我们的App应用程序</p>

<p><img src="/assets/images/2020/icoding/docker/vm-arch.jpg" alt="" /></p>

<p>Docker：不需要再去虚拟化硬件资源，通过DOCKER DAEMON  直接运行我们的APP应用程序，资源开销共用宿主机（安装了Docker服务的主机）。</p>

<p>思想：<mark>**没有什么是加一层解决不了的**，</mark>一个架构的思想。</p>

<p><img src="/assets/images/2020/icoding/docker/docker-arch.jpg" alt="" /></p>

<p>对比的优势：效率变高、速度变快、方便。</p>

<p><img src="/assets/images/2020/icoding/docker/docker-vm-compare.png" alt="" /></p>

<p><mark>所有的Docker镜像的基础环境都是linux的！</mark>,镜像是有多层组成的，第一层都是linux的系统内核。</p>

<h2 id="5docker基本使用">5、Docker基本使用</h2>

<h3 id="帮助命令">帮助命令</h3>

<p>学习方式：对比 redis-tab 看到redis的一切命令，docker –help就可以看到所有命令帮助！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker <span class="nt">--help</span>  <span class="c">#看docker所有的命令，就亿点点</span>
<span class="c"># 命令划分： 容器操作、镜像操作（crud）、系统命令：进入容器、创建、构建。。。。</span>
Commands:
  attach      Attach <span class="nb">local </span>standard input, output, and error streams to a running container
  build       Build an image from a Dockerfile
  commit      Create a new image from a container<span class="s1">'s changes
  cp          Copy files/folders between a container and the local filesystem
  create      Create a new container
  diff        Inspect changes to files or directories on a container'</span>s filesystem
  events      Get real <span class="nb">time </span>events from the server
  <span class="nb">exec        </span>Run a <span class="nb">command </span><span class="k">in </span>a running container
  <span class="nb">export      </span>Export a container<span class="s1">'s filesystem as a tar archive
  history     Show the history of an image
  images      List images
  import      Import the contents from a tarball to create a filesystem image
  info        Display system-wide information
  inspect     Return low-level information on Docker objects
  kill        Kill one or more running containers
  load        Load an image from a tar archive or STDIN
  login       Log in to a Docker registry
  logout      Log out from a Docker registry
  logs        Fetch the logs of a container
  pause       Pause all processes within one or more containers
  port        List port mappings or a specific mapping for the container
  ps          List containers
  pull        Pull an image or a repository from a registry
  push        Push an image or a repository to a registry
  rename      Rename a container
  restart     Restart one or more containers
  rm          Remove one or more containers
  rmi         Remove one or more images
  run         Run a command in a new container
  save        Save one or more images to a tar archive (streamed to STDOUT by default)
  search      Search the Docker Hub for images
  start       Start one or more stopped containers
  stats       Display a live stream of container(s) resource usage statistics
  stop        Stop one or more running containers
  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE
  top         Display the running processes of a container
  unpause     Unpause all processes within one or more containers
  update      Update configuration of one or more containers
  version     Show the Docker version information
  wait        Block until one or more containers stop, then print their exit codes

Run '</span>docker COMMAND <span class="nt">--help</span><span class="s1">' for more information on a command.

# 要查看任何命令帮助都可以这样使用
docker xxx --help
</span></code></pre></div></div>

<blockquote>
  <p>查看docker 版本信息</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker version
Client: Docker Engine - Community
 Version:           19.03.11
 API version:       1.40
 Go version:        go1.13.10
 Git commit:        42e35e61f3
 Built:             Mon Jun  1 09:13:48 2020
 OS/Arch:           linux/amd64
 Experimental:      <span class="nb">false

</span>Server: Docker Engine - Community
 Engine:
  Version:          19.03.11
  API version:      1.40 <span class="o">(</span>minimum version 1.12<span class="o">)</span>
  Go version:       go1.13.10
  Git commit:       42e35e61f3
  Built:            Mon Jun  1 09:12:26 2020
  OS/Arch:          linux/amd64
  Experimental:     <span class="nb">false
 </span>containerd:
  Version:          1.2.13
  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429
 runc:
  Version:          1.0.0-rc10
  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd
 docker-init:
  Version:          0.18.0
  GitCommit:        fec3683
</code></pre></div></div>

<blockquote>
  <p>查看docker 具体运行信息，包括容器(运行中、暂停、已停止) 和 镜像信息等等</p>
</blockquote>

<p><img src="/assets/images/2020/icoding/docker/docker-info.png" alt="" /></p>

<h3 id="镜像命令">镜像命令</h3>

<p><strong>docker  images</strong></p>

<p>1、列出镜像</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 列出镜像，通过镜像id运行镜像</span>
<span class="o">[</span>root@kuangshen ~]# docker images
<span class="c"># 仓库源              # 版本              # 镜像id唯一的        # 创建时间          # 大小</span>
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
composetest_web      latest              9a309fa36afa        2 weeks ago         104MB
&lt;none&gt;               &lt;none&gt;              e244bf2f7f2c        2 weeks ago         96MB
python               3.6-alpine          c937382ec98f        2 weeks ago         92.8MB
python               3.7-alpine          55312eb28831        2 weeks ago         96MB
redis                alpine              29c713657d31        2 weeks ago         31.6MB
tomcat               latest              1b6b1fe7261e        2 weeks ago         647MB
mysql                latest              94dff5fab37f        2 weeks ago         541MB
hello-world          latest              bf756fb1ae65        5 months ago        13.3kB
webcenter/activemq   latest              3af156432993        3 years ago         422MB
mysql                  5.7               a4s5d465aw4e        5 months ago        500mb

<span class="c"># 可选项,通过help查看</span>
<span class="o">[</span>root@kuangshen ~]# docker images <span class="nt">--help</span>
Options:
  <span class="nt">-a</span>, <span class="nt">--all</span>             <span class="c">#查看所有的镜像,docker images 默认带上该选项</span>
  <span class="nt">-f</span>, <span class="nt">--filter</span> filter   <span class="c"># 查询条件</span>
  <span class="nt">-q</span>, <span class="nt">--quiet</span>          <span class="c"># 只显示镜像id</span>
 
<span class="c"># 参数连起来使用 </span>
<span class="o">[</span>root@kuangshen ~]# docker images <span class="nt">-qa</span>
</code></pre></div></div>

<p>2、搜索镜像 docker search –help</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker search mysql
<span class="c"># 名字                           # 描述                                           # STARS</span>
NAME                              DESCRIPTION                                     STARS              
mysql                             MySQL is a widely used, open-source relation…   9578              
mariadb                           MariaDB is a community-developed fork of MyS…   3481       

<span class="c"># 可以增加搜索条件</span>
<span class="c"># 列出收藏不小于 5000 的镜像</span>
<span class="o">[</span>root@kuangshen ~]# docker search mysql <span class="nt">--filter</span><span class="o">=</span><span class="nv">stars</span><span class="o">=</span>5000

<span class="c"># 我们搜素镜像直接去dockerhub!</span>
<span class="c"># 我们搜素镜像直接去dockerhub!</span>
<span class="c"># 我们搜素镜像直接去dockerhub!</span>
</code></pre></div></div>

<p><a href="https://hub.docker.com/">https://hub.docker.com/</a></p>

<p><img src="/assets/images/2020/icoding/docker/docker-hup-search.gif" alt="" /></p>

<p>点击镜像详细页面，会告诉你怎么下载镜像和运行镜像</p>

<p>3、下载镜像 docker pull –help</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker pull <span class="nt">--help</span>
<span class="c"># 下载指定版本,不指定就是最新版本</span>
<span class="o">[</span>root@kuangshen ~]# docker pull mysql
<span class="o">[</span>root@kuangshen ~]# docker pull mysql:5.7
</code></pre></div></div>

<p>4、删除镜像</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker rmi <span class="nt">-f</span> 镜像id  <span class="c"># 强制删除</span>
<span class="o">[</span>root@kuangshen ~]# docker rmi <span class="nt">-f</span> 镜像id 镜像id  <span class="c"># 强制多个删除</span>
<span class="c"># 删除全部,使用组合命令</span>
docker images <span class="nt">-aq</span> <span class="c"># 获取全部镜像的id</span>
docker rmi <span class="nt">-f</span> <span class="si">$(</span>docker images <span class="nt">-aq</span><span class="si">)</span>  
</code></pre></div></div>

<p>5、查看镜像的全部信息</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker image inspect 镜像id
</code></pre></div></div>

<h3 id="容器命令">容器命令</h3>

<p>镜像一但运行就到容器了！</p>

<p><mark>有了镜像才能创建容器！</mark></p>

<p>1、新建并启动容器 docker run –help</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看run 帮助 </span>
docker run <span class="nt">--help</span>
<span class="c"># 常用参数</span>
<span class="nt">--name</span><span class="o">=</span><span class="s2">"MySQL"</span>   给容器指定一个名字
<span class="nt">-d</span>               后台运行
<span class="nt">-i</span>               交互模式运行，进入容器
<span class="nt">-t</span>               交互模式运行，打开一个新的终端，进入容器
<span class="nt">-P</span>               随机暴露端口
<span class="nt">-p</span>               指定暴露的端口
 <span class="nt">-p</span> 3306:3306    将容器内部的端口和内部端口做映射
 
<span class="c"># 这些镜像一般都是精简的！</span>
<span class="c"># 以交互模式进入容器，</span>
<span class="o">[</span>root@kuangshen ~]# docker run <span class="nt">--name</span><span class="o">=</span>mylinux <span class="nt">-it</span> centos:7.8.2003 /bin/bash   
<span class="o">[</span>root@8731ed2f08d1 /]# ll
bash: ll: <span class="nb">command </span>not found
<span class="o">[</span>root@8731ed2f08d1 /]# <span class="nb">ls
</span>bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var
dev  home  lib64  media       opt  root  sbin  sys  usr
<span class="o">[</span>root@8731ed2f08d1 /]# vim
bash: vim: <span class="nb">command </span>not found
<span class="o">[</span>root@8731ed2f08d1 /]# ifconfig
bash: ifconfig: <span class="nb">command </span>not found
<span class="o">[</span>root@8731ed2f08d1 /]# <span class="nb">exit</span>   <span class="c"># 退出容器</span>
<span class="nb">exit</span>
<span class="o">[</span>root@kuangshen ~]# ll
</code></pre></div></div>

<p>2、列出运行的容器</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看命令帮助</span>
<span class="o">[</span>root@kuangshen ~]# docker ps  <span class="nt">--help</span>
<span class="c"># 显示正在运行的容器</span>
<span class="o">[</span>root@kuangshen ~]# docker ps    
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS    
<span class="c"># 显示正在运行和历史运行的容器</span>
<span class="o">[</span>root@kuangshen ~]# docker ps <span class="nt">-a</span>    
<span class="c"># 容器id						# 创建容器的镜像																	# </span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS           
8731ed2f08d1        centos              <span class="s2">"/bin/bash"</span>              2 minutes ago       Exited <span class="o">(</span>127<span class="o">)</span> 
</code></pre></div></div>

<p>3、退出容器</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">exit</span>   <span class="c"># 容器停止退出</span>
Ctrl+P+Q  <span class="c"># 不停止容器，退出,查看正在运行的容器，status显示up</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/docker-run-centos.gif" alt="" /></p>

<p>4、容器的启动停止</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker start 容器id  <span class="c"># 启动</span>
docker restart 容器id  <span class="c"># 重启</span>

docker stop  容器id <span class="c"># 正常停止</span>
docker <span class="nb">kill  </span>容器id <span class="c"># 强制停止</span>
<span class="o">[</span>root@kuangshen ~]# docker stop a1e9f14fe46f
a1e9f14fe46f
</code></pre></div></div>

<p>5、删除容器</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 删除指定的</span>
docker <span class="nb">rm </span>容器id
<span class="c"># 强制删除指定的</span>
docker <span class="nb">rm</span> <span class="nt">-f</span> 容器id           
<span class="c"># 强制删除全部正在运行的容器</span>
docker <span class="nb">rm</span> <span class="nt">-f</span> <span class="si">$(</span>docker ps <span class="nt">-qa</span><span class="si">)</span>  
</code></pre></div></div>

<p>小结：</p>

<ul>
  <li>
    <p>docker  stop   rm  start  ps 对于容器的，容器是docker最小单元</p>
  </li>
  <li>
    <p>镜像的命令都带 i，如docker images , docker rmi</p>
  </li>
</ul>

<h3 id="其他命令重要">其他命令（重要）</h3>

<p><strong>后台启动容器</strong>  docker run –help</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># -d 后台运行容器</span>
<span class="o">[</span>root@kuangshen ~]# docker run <span class="nt">-d</span> centos
73c2b6182b79e07225f045be1fd5673b53b2953e0c02b7e0d47428eebaff4110
<span class="o">[</span>root@kuangshen ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

<span class="c"># 发现这个容器停止了，</span>
<span class="o">[</span>root@kuangshen ~]# docker ps <span class="nt">-a</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES
73c2b6182b79        centos              <span class="s2">"/bin/bash"</span>         19 seconds ago      Exited <span class="o">(</span>0<span class="o">)</span> 19 seconds ago                       practical_hodgkin

<span class="c"># 注意点：docker 容器使用后台方式运行，必须要有一个前台进行，比如我们这里的centos，啥都没干，这个时候它就会自动停止，docker会认为没有程序的。没有对外提供服务！最好的情况，就是核心应用使用前台方式启动运行。</span>
</code></pre></div></div>

<p><strong>日志查看</strong>  docker logs –help</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 参数</span>
<span class="nt">-f</span>  <span class="nt">-t</span>  <span class="nt">--tail</span> 行数
<span class="c"># 通过日志查看</span>
<span class="c"># -t  时间戳显示</span>
<span class="c"># -f  刷新最新的日志</span>
<span class="c"># --tail n 指定显示最后的多少行</span>

<span class="c"># 测试后台运行centos，写一个脚本让它有程序在运行，那样就不会停止了</span>
<span class="o">[</span>root@kuangshen ~]# docker run <span class="nt">-d</span> centos /bin/sh <span class="nt">-c</span> <span class="s2">"while true;do echo icoding;sleep 1;done"</span>
2b0b65a0733d8e801cb8788a68d84895676c6f626f2fab0e09ef990f317fa1ed
<span class="o">[</span>root@kuangshen ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
2b0b65a0733d        centos              <span class="s2">"/bin/sh -c 'while t…"</span>   4 seconds ago       Up 3 seconds                            beautiful_chaum
 
<span class="o">[</span>root@kuangshen ~]#  docker logs <span class="nt">-tf</span> <span class="nt">--tail</span> 10 2b0b65a0733d
2020-06-06T10:09:05.039165180Z icoding
2020-06-06T10:09:06.040633317Z icoding
2020-06-06T10:09:07.042213068Z icoding
2020-06-06T10:09:08.043662863Z icoding
2020-06-06T10:09:09.045180716Z icoding
</code></pre></div></div>

<p><strong>查看容器进程信息</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker top 2b0b65a0733d
UID                 PID                 PPID                C                   STIME              
root                6905                6889                0                   22:52   
<span class="c"># 查看容器的CPU，内存，IO 等使用信息</span>
<span class="c"># 不加容器名即查看所有</span>
<span class="o">[</span>root@localhost ~]# docker stats os1
CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
f9420cbbd2a9        os1                 45.94%              47.09MiB / 1GiB     4.60%               54.6MB / 352kB      0B / 21.1MB         3
</code></pre></div></div>

<p><strong>查看容器和镜像的信息（研究本质常用）</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker inspect 2b0b65a0733d
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/docker-inspect.png" alt="" /></p>

<p><strong>进入正在运行的容器</strong>    <mark>会启动新的终端</mark></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 常用的，进入正在运行的容器 </span>
<span class="c"># -it 创建一个新的端口，交互模式运行</span>
docker <span class="nb">exec</span>  <span class="nt">-it</span> 容器id  控制台
<span class="o">[</span>root@kuangshen ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> 2b0b65a0733d /bin/bash
<span class="o">[</span>root@2b0b65a0733d /]# <span class="nb">ls
</span>bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var
dev  home  lib64  media       opt  root  sbin  sys  usr
<span class="o">[</span>root@2b0b65a0733d /]# ll
bash: ll: <span class="nb">command </span>not found
</code></pre></div></div>

<p><strong>进入正在运行的容器</strong> 不会启动新的终端</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 进入正在执行的终端！</span>
docker attach 容器id
<span class="o">[</span>root@kuangshen ~]# docker attach 2b0b65a0733d
icoding
icoding
icoding
</code></pre></div></div>

<p><strong>拷贝文件，容器内的文件拷贝到容器外面（宿主机上）</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@iZwz ~]# docker  <span class="nb">cp</span> <span class="nt">--help</span>

Usage:  docker <span class="nb">cp</span> <span class="o">[</span>OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
        docker <span class="nb">cp</span> <span class="o">[</span>OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH
        
Copy files/folders between a container and the <span class="nb">local </span>filesystem

Options:
  <span class="nt">-a</span>, <span class="nt">--archive</span>       Archive mode <span class="o">(</span>copy all uid/gid information<span class="o">)</span>
  <span class="nt">-L</span>, <span class="nt">--follow-link</span>   Always follow symbol <span class="nb">link </span><span class="k">in </span>SRC_PATH
 
<span class="c"># 1、进入正在运行的容器</span>
<span class="o">[</span>root@iZwz99 ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> 8b41850cad8c /bin/bash 
<span class="o">[</span>root@8b41850cad8c /]# <span class="nb">cd </span>home
<span class="c"># 2、在容器内创建一个文件</span>
<span class="o">[</span>root@8b41850cad8c home]# <span class="nb">touch </span>f1
<span class="o">[</span>root@8b41850cad8c home]# <span class="nb">ls
</span>f1
<span class="c"># 3、退出容器，拷贝文件到宿主机</span>
<span class="o">[</span>root@iZwz996g ~]# docker <span class="nb">cp </span>8b41850cad8c:/home/f1 /home
<span class="o">[</span>root@iZwz996g ~]# <span class="nb">cd</span> /home
<span class="o">[</span>root@iZwz996g home]# <span class="nb">ls
</span>coding  esuser  f1

<span class="c"># 测试：拷贝宿主机的文件到容器中</span>
<span class="o">[</span>root@iZwz99 home]# <span class="nb">touch </span>f2
<span class="o">[</span>root@iZwz99 home]# docker <span class="nb">cp </span>f2 8b41850cad8c:/home
<span class="o">[</span>root@iZwz99 ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> 8b41850cad8c /bin/bash 
<span class="o">[</span>root@8b41850cad8c /]# <span class="nb">cd </span>home
<span class="o">[</span>root@8b41850cad8c home]# <span class="nb">ls
</span>f1  f2
</code></pre></div></div>

<p>docker基本使用ok！</p>

<p>1、下载镜像</p>

<p>2、运行镜像</p>

<h2 id="6docker全部的命令">6、Docker全部的命令</h2>

<p><img src="/assets/images/2020/icoding/docker/docker-commands-diagram.png" alt="" /></p>

<p>官方文档查看更多使用命令：<a href="https://docs.docker.com/engine/reference/">https://docs.docker.com/engine/reference/</a></p>

<p><img src="/assets/images/2020/icoding/docker/compand-line-reference.gif" alt="" /></p>

<h2 id="7作业">7、作业</h2>

<h3 id="docker-安装-nginx">Docker 安装 Nginx</h3>

<p>去docker hub搜索nginx</p>

<p><img src="/assets/images/2020/icoding/docker/search-nginx.gif" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker search nginx
docker pull nginx
docker run nginx  前面的两步可以不做，因为run的时候就会去docker hub搜索下载镜像 
<span class="c"># --name 容器名, -d 后台运行, -p 端口映射暴露端口(宿主机端口:容器内端口)</span>
<span class="c"># 防火墙，安全组一定要开放端口</span>
docker run <span class="nt">--name</span> mynginx <span class="nt">-d</span> <span class="nt">-p</span> 3500:80 nginx
</code></pre></div></div>

<p>访问测试</p>

<p><img src="/assets/images/2020/icoding/docker/welcome-nginx.png" alt="" /></p>

<p>我们访问nginx的流程是这样的： 外网访问阿里云服务器3500端口 -&gt; 服务器内的Docker容器80端口 （-p 端口映射）</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1、进入容器mynginx</span>
<span class="o">[</span>root@kuangshen ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> mynginx /bin/bash
<span class="c"># 2、</span>
root@4e6c81419f40:/# whereis nginx
nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
<span class="c"># 3、如何配置nginx 的反向代理路由，配置文件应该在/etc/nginx</span>
root@640e0bff04d3:/# <span class="nb">cd</span> /etc/nginx
root@640e0bff04d3:/etc/nginx# <span class="nb">ls
</span>conf.d  fastcgi_params  koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params  uwsgi_params  win-utf
<span class="c"># 不支持vim</span>
root@640e0bff04d3:/etc/nginx# vim
bash: vim: <span class="nb">command </span>not found
<span class="c"># 解决方案：运行容器时通过目录挂载的方式把/etc/nginx挂到宿主机外，实现文件共享的方式修改配置。</span>
docker run <span class="nt">-d</span> <span class="nt">-p</span> 3500:80 <span class="nt">-v</span> /etc/nginx:/etc/nginx <span class="nt">--name</span> mynginx nginx
</code></pre></div></div>

<h3 id="docker--安装-tomcat">Docker  安装 tomcat</h3>

<blockquote>
  <p>–rm</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># --rm 容器启动成功以后，然后退出，那么就自动移除容器（测试的时候使用！）</span>
<span class="c"># docker ps -a 也不会记录容器的运行痕迹</span>
docker run <span class="nt">-it</span> <span class="nt">--rm</span> tomcat:9.0
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/docker-tomcat-webapp.gif" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 运行tomcat</span>
<span class="o">[</span>root@alibaba ~]# docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:8080 <span class="nt">--name</span> tomcat9 tomcat:9.0
<span class="o">[</span>root@alibaba ~]# curl loalhost://8080
<span class="c"># 访问tomcat返回404，既然出现了404,说明服务启动成功！</span>
<span class="c"># 进入容器tomcat9</span>
<span class="o">[</span>root@kuangshen ~]# docker <span class="nb">exec</span> <span class="nt">-it</span> tomcat9 /bin/bash
<span class="c"># 默认的tomcat，官方下载的，webapps 是空的！</span>


<span class="c"># 我们每次假设要发布项目到 tomcat容器中，这个时候都需要进入容器！能不能可以直接在linux虚拟机上部署，就自动同步到容器中。</span>
<span class="c"># 可以，docker run的时候通过目录挂载 -v(宿主机目录:容器内目录)，把容器内/usr/local/tomcat/webapps目录挂载到宿主机外，实现文件数据同步，实现自动同步到容器中</span>
<span class="o">[</span>root@kuangshen ~]# docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:8080 <span class="nt">-v</span> /www/tomcat9/webapps:/usr/local/tomcat/webapps <span class="nt">--name</span> tomcat9 tomcat:9.0
</code></pre></div></div>

<h3 id="docker-安装-es--kibana">Docker 安装 ES + Kibana</h3>

<blockquote>
  <p>查看容器对cpu内存和网络资源的占用状况</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker stats 容器id
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/docker-stats.png" alt="" /></p>

<p>可以看出tomcat的cpu ，内存 占用都是比较小的，因为还没发布什么应用。</p>

<blockquote>
  <p>docker安装 es 需要解决的问题</p>
</blockquote>

<ol>
  <li>es占用资源很大，吃内存，修改es的config目录的jvm.options把内存改小，docker通过传环境参数的方式配置</li>
  <li>端口暴露： 9200/9300</li>
  <li>数据挂载问题！（docker容器内部！ 删除docker容器， 删除跑路！=&gt; 数据应该是持久化在本地的，不随容器销毁而消失）</li>
</ol>

<p><strong>docker hub搜索elasrticsearch</strong></p>

<p><img src="/assets/images/2020/icoding/docker/docker-run-elasticsearch.gif" alt="" /></p>

<p><strong>docker hub搜索kibana</strong></p>

<p><img src="/assets/images/2020/icoding/docker/docker-run-kibana.gif" alt="" /></p>

<blockquote>
  <p>docker run elasticsearch  访问</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看官网（docker hub搜索elasrticsearch）得知：</span>
<span class="c"># 1、运行 elasticsearch:7.7.1</span>
docker run <span class="nt">-d</span> <span class="nt">--name</span> elasticsearch <span class="nt">-p</span> 9200:9200 <span class="nt">-p</span> 9300:9300 <span class="nt">-e</span> <span class="s2">"discovery.type=single-node"</span> elasticsearch:7.7.1
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/docker-es-run.png" alt="image-20200606203312606" /></p>

<blockquote>
  <p>发现问题，占用运行内存大，调整变小</p>
</blockquote>

<p>问题：整个Linux开始卡顿了！通过stats查看状态，ES占用了71%的内存，十分消耗资源！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@kuangshen ~]# docker stats af80e6966f24
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/docker-stats2.png" alt="image-20200606203413919" /></p>

<p>docker es的更多配置 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.7/docker.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.7/docker.html</a></p>

<p><img src="/assets/images/2020/icoding/docker/docer-es-environment.gif" alt="" /></p>

<p>environment里配置的参数就是elasticsearch.yml配置文件里支持的参数，是一样的</p>

<p><img src="/assets/images/2020/icoding/docker/es-config.gif" alt="" /></p>

<p>而ES_JAVA_OPTS 就是Jim.options的参数，一般也就是修改内存，默认是占用1g</p>

<p><img src="/assets/images/2020/icoding/docker/es-jvm-options.gif" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 将es的运行内存变小！通过 -e 参数来改变环境配置！</span>
docker run <span class="nt">-d</span> <span class="nt">--name</span> elasticsearch <span class="nt">-p</span> 9200:9200 <span class="nt">-p</span> 9300:9300 <span class="nt">-e</span> <span class="s2">"discovery.type=single-node"</span> <span class="nt">-e</span> <span class="s2">"ES_JAVA_OPTS=-Xms64m -Xmx512m"</span> elasticsearch:7.7.1
</code></pre></div></div>

<p>通过stats查看状态，发现占用内存明显变小，MEM: 20%</p>

<p><img src="/assets/images/2020/icoding/docker/docker-stats3.png" alt="image-20200606204118950" /></p>

<blockquote>
  <p>问题：es + kibana？ 跨容器可以直接访问吗？！之后再Docker网络讲解！</p>
</blockquote>

<p><img src="/assets/images/2020/icoding/docker/docker-es-kibana.png" alt="image-20200606204559926" /></p>

<p>了解下一节的docker网络，你会发现可以把ElasticSearch、Kibana放在同一组网络里，可以互相通信</p>



            <div>
   <!-- <p align="center">
     	  
         <img src="/assets/images/keeppuresmile.jpg" >
         <br/>
         微信扫描二维码，关注一个有故事的程序员
        

   </p>
   <p align="center" style="margin-top: 15px; font-size: 11px;color: #cc0000;">
       <strong>（转载本站文章请注明作者和出处 <a href="http://www.ityouknow.com">纯洁的微笑-ityouknow</a>）</strong>
   </p>
   <p align="center" style="margin-top: 15px; font-size: 16px;color: #337ab7;">
       <strong><a href="http://www.justdojava.com/" target="_blank">点击了解 ：Java 技术人的网站</a></strong>
   </p> -->
</div>

            <!-- Comments -->
            <div class="comment">
             

  

  
        <div id="gitalk-container"></div>
        <script src="/assets/js/gitalk.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
        <script>
        var gitalk = new Gitalk({
            id: '/icoding-edu/2020/06/03/icoding-note-043.html',
            clientID: '6cd8ad4d1cf1d1e6ad95',
            clientSecret: 'c4ce22a25efe50bfd60da67c990b534bc99a6424',
            repo: 'aikomj.github.io',
            owner: 'aikomj',
            admin: ['aikomj'],
            labels: ['gitalk'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


            </div>
        </div>

        <div class="col-md-3">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>
     <!--<div class="asb-post-01">-->
        <!--<div class="mask"></div>-->
            <!--<div class="info">-->
                <!--<div>扫码关注公众号：<span style="color: #E9405A; font-weight: bold;">纯洁的微笑</span></div>-->
            <!--<div>-->
            <!--<span>发送 </span><span class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span>-->
            <!--<div>-->
                <!--即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章-->
            <!--</div>-->
            <!--<img class="code-img" style="width: 300px;display:unset" src="/assets/images/keeppuresmile.jpg">-->
        <!--</div>-->
    <!--</div>-->
</article>

        </div>

    
<footer class="container">
    <div class="site-footer">
       <!--  <div class="site-footer-icons">
            <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
               知乎
            </a>
            <a target="_blank" href="http://weibo.com/ityouknow">
               微博
            </a>
            <a target="_blank" href="https://github.com/ityouknow">
                GitHub
            </a>
        </div> -->
        <!-- <div class="card text-center">
            <ul class="list-inline" style="margin-left: 0;">
               <li>
                <a target="_blank" href="https://github.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa  fa-stack-1x fa-inverse">知</i>
                  </span>
                </a>
              </li>
                  <li>
                <a target="_blank" href="https://weibo.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          </ul>
        </div> -->
        <div class="site-footer-links mobile-hidden">
            
        </div>
        <div class="scrolltop">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>
        <div class="rss">
            <a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a>
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>
    </div>
    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>
    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>
    
    
     <!-- Cnzz Analytics -->
       <div style="display:none">
         <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260945749'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260945749' type='text/javascript'%3E%3C/script%3E"));</script>
       </div>
     <!-- Cnzz Analytics -->
</footer>


    </body>

</html>
