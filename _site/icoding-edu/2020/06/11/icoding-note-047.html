<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <title> 飞天班第47节：Docker精通-5 - 大伟的博客 </title>
    <meta name="keywords" content="docker">
    <meta name="description"
          content="什么是DevOps，如何落地实现DevOps，Gitlab的安装,Jenkins的安装使用，编写Pipeline，配置Gitlab的webhook,项目自动化部署实战">

    <link rel="canonical" href="http://47.113.95.179/jk-blog/icoding-edu/2020/06/11/icoding-note-047.html">
    <link rel="alternate" type="application/rss+xml" title="大伟,专注Spring Boot,Spring Cloud,Docker,Java后端技术" href="http://47.113.95.179/jk-blog/feed.xml">

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/gitalk.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->

    

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">-->

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/lock.js"></script>
</head>


    <body>

    <header class="site-header">
    <div class="site-header-topbar">
        <div class="container">
            <div class="topbar-menu">
                
                <div class="item">
                    <a href="/archives.html"
                       target="_self"
                       title="Archives">
                        Archives
                    </a>
                </div>
                
                <div class="item">
                    <a href="/linux.html"
                       target="_self"
                       title="Linux">
                        Linux
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mysql.html"
                       target="_self"
                       title="Mysql">
                        Mysql
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mongodb.html"
                       target="_self"
                       title="MongoB">
                        MongoB
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mq.html"
                       target="_self"
                       title="MQ">
                        MQ
                    </a>
                </div>
                
                <div class="item">
                    <a href="/fastdfs.html"
                       target="_self"
                       title="FastDFS">
                        FastDFS
                    </a>
                </div>
                
                <div class="item">
                    <a href="/redis.html"
                       target="_self"
                       title="Redis">
                        Redis
                    </a>
                </div>
                
                <div class="item">
                    <a href="/elasticsearch.html"
                       target="_self"
                       title="ES">
                        ES
                    </a>
                </div>
                
                <div class="item">
                    <a href="/docker.html"
                       target="_self"
                       title="Docker">
                        Docker
                    </a>
                </div>
                
                <div class="item">
                    <a href="/k8s.html"
                       target="_self"
                       title="K8s">
                        K8s
                    </a>
                </div>
                
                <div class="item">
                    <a href="/architect.html"
                       target="_self"
                       title="架构师">
                        架构师
                    </a>
                </div>
                
                <div class="item">
                    <a href="/gitee.html"
                       target="_self"
                       title="开源项目">
                        开源项目
                    </a>
                </div>
                
                <div class="item">
                    <a href="/tool.html"
                       target="_self"
                       title="工具">
                        工具
                    </a>
                </div>
                
                <div class="item">
                    <a href="/life.html"
                       target="_self"
                       title="生活">
                        生活
                    </a>
                </div>
                
                <div class="item">
                    <a href="/say.html"
                       target="_self"
                       title="说说">
                        说说
                    </a>
                </div>
                
                <div class="item">
                    <a href="/link.html"
                       target="_self"
                       title="友链">
                        友链
                    </a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container">
        <a id="site-header-brand" href="/" title="大展宏兔">
            <!--<span class="octicon octicon-mark-github"></span>-->
            <img class="logo" src="/assets/images/favicon.jpeg">
            大展宏兔
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/"
                   target=""
                   title="Home">
                    Home
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Icoding">
                    Icoding
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/icoding-edu.html" 
                           target="_self"
                     >飞天班笔记</a></li>
                    
                    <li><a href="/icoding-gavin.html" 
                           target="_self"
                     >黄埔班笔记</a></li>
                    
                    <li><a href="/icoding-allen.html" 
                           target="_self"
                     >源码分析</a></li>
                    
                    <li><a href="https://www.icodingedu.com/" 
                           target="_blank"
                     >艾编程官网</a></li>
                    
                    <li><a href="https://leetcode-cn.com/problemset/all/" 
                           target="_blank"
                     >力扣刷题</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Java">
                    Java
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/java-base.html" 
                           target="_self"
                     >Java基础</a></li>
                    
                    <li><a href="/java-concurrent.html" 
                           target="_self"
                     >Java并发</a></li>
                    
                    <li><a href="/design-mode.html" 
                           target="_self"
                     >设计模式</a></li>
                    
                    <li><a href="http://www.justdojava.com" 
                           target="_blank"
                     >Java 极客技术</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring.html"
                   target="_self"
                   title="Spring">
                    Spring
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-boot.html"
                   target="_self"
                   title="Spring Boot">
                    Spring Boot
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-cloud.html"
                   target="_self"
                   title="Spring Cloud">
                    Spring Cloud
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Go全栈">
                    Go全栈
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/go-base.html" 
                           target="_self"
                     >Go语言基础</a></li>
                    
                    <li><a href="/go-web.html" 
                           target="_self"
                     >Web开发</a></li>
                    
                    <li><a href="/go-middleware.html" 
                           target="_self"
                     >中间件</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/front.html"
                   target="_self"
                   title="大前端">
                    大前端
                </a>
                
            </div>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="飞天班第47节：Docker精通-5">
    <div class="container">
        <div id="jumbotron-meta-info">        
            <h1>飞天班第47节：Docker精通-5</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2020/06/11
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container noneed" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h2 id="1前言">1、前言</h2>

<h3 id="准备">准备</h3>

<p>问题：Devops适合于中小型团队吗？</p>

<p>我最近花了相当多的时间来思考 “DevOps” 的人员可扩展性，最终得出的结论是，虽然DevOps可以很好地适用于小型工程组织，但这种做法如果没有仔细考虑和管理的话，可以会导致相当大的人力、组织规模问题！ 流程很清楚，确实可以自动化完成！</p>

<p>无论 你的项目多小，如果能使用Devops确实能大大减少人力！</p>

<p><img src="/assets/images/2020/icoding/docker/devops-prepare.jpg" alt="" /></p>

<p><strong>本系列核心：</strong></p>

<p>1、深入了解DevOps的思想及落地</p>

<p>2、Jenkins 安装和流水线使用</p>

<p>3、自动化构建任务，实现CI/CD</p>

<p><img src="/assets/images/2020/cncf/cncf-arch.png" alt="" /></p>

<h3 id="持续集成">持续集成</h3>

<p><strong>传统的软件开发流程如下：</strong></p>

<p>1、项目经理分配模块给开发人员</p>

<p>2、每个模块的开发人员并行开发，并进行单元测试</p>

<p>3、开发完毕，将代码集成部署到测试服务器，测试人员进行测试</p>

<p>4、测试人员发现bug，提交bug，开发人员修改bug</p>

<p>5、bug修改完毕再次集成，测试。</p>

<p><strong>问题：</strong></p>

<p>1、模块之间依赖关系复杂，在集成时发现大量bug</p>

<p>2、测试人员等待测试时间过长</p>

<p>3、软件交付无法保障</p>

<p><strong>解决上述问题的思考：</strong></p>

<p>1、能否把集成测试时间提前？</p>

<p>2、能否使用自动化工具代替人工集成部署的过程？</p>

<p><strong>持续集成：</strong></p>

<p>持续集成，简称CI，持续集成的思想是：每天要多次将代码合并到主干，并进行集成，测试，这样就可以提早发现错误，进行修正。持续集成也属于DevOps。  小步快跑，快速迭代！=&gt; 将代码提交到gitlab！</p>

<p><strong>持续集成的好处：</strong></p>

<p><mark>1、自动化集成部署，提高了集成效率。</mark></p>

<p>2、更快的修复问题。</p>

<p>3、更快的进行交付。</p>

<p>4、提高了产品质量。</p>

<p><strong>持续集成的流程</strong>  <mark>开发完毕，直接提交代码，然后等几分钟，”最新项目“ 就上线了！</mark></p>

<p><img src="/assets/images/2020/icoding/docker/devops/cicd.png" alt="" /></p>

<p>项目演示！</p>

<h3 id="什么是devops">什么是DevOps？</h3>

<p>DevOps是一种思想或方法论，它涵盖开发、测试、运维的整个过程！</p>

<p>DevOps强调软件开发人员与软件测试、软件运维、质量保障（QA）部门之间有效的沟通与协作</p>

<p>强调通过自动化的方法管理软件变更，软件集成</p>

<p>使软件从构建到测试、发布更加快捷、可靠，最终按时交付软件。</p>

<p>公司到底需不需要运维！ 基础运维全部被自动替代！IDEA -&gt; Git-&gt;通知-&gt;平台Docker自动化构建</p>

<p><img src="/assets/images/2020/icoding/docker/devops/devops-life.png" alt="" /></p>

<p>公司项目开发大概的流程，看看是如何一步一步操作的：Backlog（任务清单）</p>

<p><img src="/assets/images/2020/icoding/docker/devops/devops-life2.png" alt="" /></p>

<p>问题：开发，测试，运维，沟通十分麻烦！（浪费了时间的地方！）</p>

<p>Product Backlog 源自于Scrum方法，是指产品待办事项的集合，其中事务有优先级判断，先处理优先级高的事项。</p>

<font color="red">未来的方向：AI编码+云原生应用</font>

<blockquote>
  <p>为什么当今大公司一定要使用DevOps？</p>
</blockquote>

<p><img src="/assets/images/2020/icoding/docker/devops/devops-life3.png" alt="" /></p>

<p>DevOps 这种软件开发方法，涉及到软件整个开发生命周期，这些活动只能在DevOps中实现，而不是敏捷或瀑布流。</p>

<p>DevOps 是在较短的开发周期内开发高质量软件的首选方法，同时可以提高客户满意度。</p>

<p>这就是为什么顶级互联网公司选择DevOps作为其业务目标的前进方向。</p>

<p>如果你是一名开发工程师：学习DevOps，让你成为更加优秀的IT工程师</p>

<p>如果你是一名运维工程师：应用DevOps必将，简化你的工作流程，提高你的工作效率</p>

<p>如果你是一名架构师：DevOps是你在实践中必须拥有的技术能力</p>

<p>如果你是一个跳槽者：了解DevOps必将有助于你找到高薪工作</p>

<h3 id="如何落地实现devops这种理念-4步">如何落地实现DevOps这种理念？ 4步</h3>

<p>DevOps 兴起于2009年，近年来由于云计算、互联网的发展，促进了DevOps的基础设施及工具链的发展，涌现了一大批优秀的工具，这些工具包括开发，测试，运维的各个领域，例如：GitHub，Git/svn，Docker、Jenkins，HudSon，Ant/Maven/Gradle,QUnit、JMeter等，看下图：</p>

<p>==自动化完成这些事情就好了！==</p>

<p><img src="/assets/images/2020/icoding/docker/devops/devops-life4.png" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops/devops-life5.png" alt="" /></p>

<p>使用Jenkins</p>

<p>官网: <a href="https://jenkins.io">https://jenkins.io</a></p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-1.png" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-2.png" alt="" /></p>

<p>环境要求：最低 4G 内存！40G硬盘！</p>

<p>1、编码 =&gt; 提交到我们GitHub/GitLab/Gitee</p>

<p>2、GitHub/GitLab =&gt; 发起一个通知 Jenkins （WebHook机制）</p>

<p>3、Jenkins  接收通知 =&gt; 执行流水线脚本 （一堆命令的集合！）</p>

<p>4、服务就可以自动访问了！</p>

<h2 id="2docker回顾安装">2、Docker回顾安装</h2>

<p><img src="/assets/images/2020/icoding/docker/devops/docker-logo.png" alt="" /></p>

<p>Docker 是一个开源的应用容器引擎</p>

<p>诞生于2013年年初，基于Go语言实现，dotCloud公司出品（后改名为 Docker Inc）</p>

<p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的Linux机器上。</p>

<p>容器是完全使用沙箱机制，相互隔离</p>

<p>容器性能开销极低</p>

<p>Docker 从17.03 版本之后分为 CE（Community Edition：社区版） 和 EE（Enterprise Edition：企业版） 版本</p>

<p><img src="/assets/images/2020/icoding/docker/devops/docker-image-container-repo.png" alt="" /></p>

<p><strong>准备：</strong></p>

<p>1、安装运行Docker</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1、卸载旧的版本</span>
yum remove docker <span class="se">\</span>
                  docker-client <span class="se">\</span>
                  docker-client-latest <span class="se">\</span>
                  docker-common <span class="se">\</span>
                  docker-latest <span class="se">\</span>
                  docker-latest-logrotate <span class="se">\</span>
                  docker-logrotate <span class="se">\</span>
                  docker-engine

<span class="c"># 2、环境需求，软件包，仓库</span>
yum <span class="nb">install</span> <span class="nt">-y</span> gcc
yum <span class="nb">install</span> <span class="nt">-y</span> gcc-c++

yum <span class="nb">install</span> <span class="nt">-y</span> yum-utils

<span class="c"># 3、配置镜像地址</span>
yum-config-manager <span class="nt">--add-repo</span> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

<span class="c"># 4、更新软件索引包 </span>
yum makecache fast

<span class="c"># 5、安装docker引擎</span>
yum <span class="nb">install</span> <span class="nt">-y</span> docker-ce docker-ce-cli containerd.io

<span class="c"># 6、启动docker</span>
systemctl <span class="nb">enable </span>docker
systemctl start docker

<span class="c"># 7、运行helloworld镜像测试</span>
docker run hello-world
</code></pre></div></div>

<p>2、配置镜像加速器</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1、登录阿里云（容器镜像服务）</span>
<span class="c"># 2、参考配置加速</span>
<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/docker

<span class="nb">sudo tee</span> /etc/docker/daemon.json <span class="o">&lt;&lt;-</span><span class="sh">'</span><span class="no">EOF</span><span class="sh">'
{
  "registry-mirrors": ["https://qiyb9988.mirror.aliyuncs.com"]
}
</span><span class="no">EOF

</span><span class="nb">sudo </span>systemctl daemon-reload

<span class="nb">sudo </span>systemctl restart docker
</code></pre></div></div>

<p>3、关闭防火墙 systemctl stop firewalld.service ，云服务器应该是开通端口安全组</p>

<p>执行流程（架构！脚本的编写，原来全部自己编写的流程，现在全部自动化完成！）</p>

<p>前端和后端应用都可以使用Jenkins自动化部署！</p>

<p>看官方文档学习：<a href="https://www.jenkins.io/zh/doc/">https://www.jenkins.io/zh/doc/</a></p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-zh-doc.jpg" alt="" /></p>

<h2 id="3gitlab安装">3、GitLab安装</h2>

<p>github、码云、gitlab！核心是git！</p>

<p>本地的离线存储：不需要网络！私人代码仓库！</p>

<blockquote>
  <p>Linux上安装gitlab</p>
</blockquote>

<p>1、拉取镜像</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull gitlab/gitlab-ce
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-image.jpg" alt="" /></p>

<p>2、数据目录绑定</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># etc</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /home/gitlab/etc
<span class="c"># data</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /home/gitlab/data
<span class="c"># logs</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /home/gitlab/logs
</code></pre></div></div>

<p>3、启动容器（挂载数据）</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 暴露https 443和http 80端口</span>
<span class="c"># 挂载配置文件、数据、日志目录</span>
docker run <span class="nt">--name</span><span class="o">=</span><span class="s1">'gitlab'</span> <span class="nt">-d</span> <span class="nt">-p</span> 4443:443 <span class="nt">-p</span> 8888:80 <span class="se">\</span>
<span class="nt">-v</span> /home/gitlab/etc:/etc/gitlab <span class="se">\</span>
<span class="nt">-v</span> /home/gitlab/data:/var/opt/gitlab <span class="se">\</span>
<span class="nt">-v</span> /home/gitlab/logs:/var/log/gitlab <span class="se">\</span>
gitlab/gitlab-ce:latest

<span class="c"># 第1次构建会比较慢，查看gitlab构建过程</span>
docker logs <span class="nt">-f</span> gitlab
</code></pre></div></div>

<p>访问ip:8888,出现以下界面，就可以走下一步，进行克隆地址配置后再创建初始密码</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-2.jpg" alt="" /></p>

<p>4、先别创建初始密码,先配置git项目访问路径    git clone!</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@helloworld ~]# docker ps
CONTAINER ID        IMAGE                     COMMAND                  CREATED             STATUS                    PORTS                                                 NAMES
993e11f205ad        gitlab/gitlab-ce:latest   <span class="s2">"/assets/wrapper"</span>        17 minutes ago      Up 17 minutes <span class="o">(</span>healthy<span class="o">)</span>   22/tcp, 0.0.0.0:8888-&gt;80/tcp, 0.0.0.0:4443-&gt;443/tcp   gitlab
</code></pre></div></div>

<font color="red">第1步</font>
<p>进入挂载的配置目录修改gitlab.rb，配置http协议的访问地址，默认是80！如下：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@helloworld ~]#  <span class="nb">cd</span> /home/gitlab/etc
<span class="o">[</span>root@helloworld etc]# vim gitlab.rb
external_url <span class="s1">'http://192.168.56.103'</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops/gitlab-install-config-external-url.png" alt="" /></p>

<font color="red">第2步</font>
<p>到进入挂在的data目录，配置git项目拉取的地址，默认是容器名</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /home/gitlab/data/gitlab-rails/etc/gitlab.yml  </span>
<span class="o">[</span>root@helloworld data]# <span class="nb">cd</span> /home/gitlab/data
<span class="o">[</span>root@helloworld data]# <span class="nb">cd </span>gitlab-rails/
<span class="o">[</span>root@helloworld gitlab-rails]# <span class="nb">cd </span>etc/
<span class="o">[</span>root@helloworld etc]# vim gitlab.yml 
看下面https:false,是使用80端口http协议，如果是true，就是使用443端口https协议，那么上面的gitlab.rb中的external_url
要修改为“ https://192.168.56.103 ”
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops/gitlab-install-config-web-server-setting.png" alt="" /></p>

<p><mark>修改完上面的配置，记得重启容器</mark></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@helloworld etc]# docker restart gitlab
<span class="c"># 启动过程中查看日志</span>
<span class="o">[</span>root@helloworld etc]# docker logs <span class="nt">-f</span> gitlab
</code></pre></div></div>

<p>重新访问ip:8888，进入创建初始密码界面，ip和端口根据自己的服务器修改</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-3.jpg" alt="" /></p>

<p>5、登录gitlab，默认用户是root，然后测试创建拉取项目！</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-4.jpg" alt="" /></p>

<p>点击Sign in</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-5.jpg" alt="" /></p>

<p>点击Create a project</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-6.jpg" alt="" /></p>

<p>6、如果能够成功拉取到本地就没有问题！</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-7.jpg" alt="" /></p>

<p>注意我们是使用8888端口映射容器的80端口的，所以克隆地址要加上8888端口，尝试在本地是否能把项目克隆下来</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-8.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops/gtilab-git-clone-password.png" alt="" /></p>

<blockquote>
  <p>Mac上安装gitlab</p>
</blockquote>

<p>先安装Docker,再安装gitlab是一样的套路</p>

<h2 id="4jenkins的安装使用">4、Jenkins的安装使用</h2>

<h3 id="jenkins-是什么">Jenkins 是什么?</h3>

<p>官网: <a href="">https://jenkins.io</a></p>

<p>Jenkins是一款开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。</p>

<p>Jenkins 支持各种运行方式，可通过系统包、Docker 或者通过一个独立的 Java 程序。</p>

<p>1、系统包  war ` /usr/share/jenkins/jenkins.war`</p>

<p>2、Docker （推荐选择）,如果docker连不到网络，重启docker</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart docker
</code></pre></div></div>

<h3 id="安装jenkins">安装jenkins</h3>

<p>官网：https://www.jenkins.io/zh/doc/book/installing/</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-zh-doc-2.jpg" alt="" /></p>

<p>1、准备</p>

<p>jenkins 是一个独立的应用！</p>

<p>磁盘要求</p>

<ul>
  <li>256MB可用内存</li>
  <li>1GB可用磁盘空间(作为一个<a href="https://www.jenkins.io/zh/doc/book/installing/#docker">Docker</a>容器运行jenkins的话推荐10GB)</li>
  <li>为小团队推荐的硬件配置 :
    <ul>
      <li>4GB+可用内存</li>
      <li>50 GB+ 可用磁盘空间</li>
    </ul>
  </li>
</ul>

<font color="red">官方建议</font>

<p>建议使用的Docker映像是<a href="https://hub.docker.com/r/jenkinsci/blueocean/"><code class="highlighter-rouge">jenkinsci/blueocean</code> image</a>(来自 the <a href="https://hub.docker.com/">Docker Hub repository</a>)。 该镜像包含当前的<a href="https://www.jenkins.io/download">长期支持 (LTS) 的Jenkins版本</a> （可以投入使用） ，捆绑了所有Blue Ocean插件和功能。这意味着你不需要单独安装Blue Ocean插件。</p>

<p>默认的 jenkins镜像两年前就不维护了！下面这个不要安装</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jenkins/jenkins     latest              6328c71fe374        2 days ago          659MB 
</code></pre></div></div>

<p><mark>Blue Ocean 是一个可视化插件，更加好看和智能！</mark></p>

<p>2、安装jenkins</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1、挂载目录和docker容器内同步！</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /var/jenkins_home
<span class="nb">chmod </span>777 /var/jenkins_home

<span class="c"># 2、run</span>
docker run <span class="se">\</span>
  <span class="nt">-u</span> root <span class="se">\</span>
  <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">-p</span> 8080:8080 <span class="se">\</span>
  <span class="nt">-p</span> 50000:50000 <span class="se">\</span>
  <span class="nt">-v</span> /var/jenkins_home:/var/jenkins_home <span class="se">\</span>
  <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
  <span class="nt">--name</span> jenkins <span class="se">\</span>
  jenkinsci/blueocean
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-container.jpg" alt="" /></p>

<p>3、等待启动成功，访问 Ip:8080 ！</p>

<p>需要登录密码（1、logs 日志，2、默认配置文件中查看密码）</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看容器的日志</span>
docker logs <span class="nt">-f</span> jenkins
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-setup-password.png" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-setup-password2.png" alt="" /></p>

<p>输入密码，点击“继续”，进入到安装插件页面，先设置国内加速地址后再安装插件</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-install-3.jpg" alt="" /></p>

<p>4、Jenkins是有众多的插件组装而成，安装插件，默认是从国外下载！！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 插件下载慢，配置updates加速地址</span>
<span class="nb">cd</span> /var/jenkins_home/updates
<span class="c"># 执行脚本如下</span>
<span class="c">#把 “ www.google.com ”  改成  “ http://www.baidu.com/ ”</span>
<span class="c">#全局搜索 “ updates.jenkins-ci.org/download ” 替换成 mirrors.tuna.tsinghua.edu.cn/jenkins</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g'</span> default.json <span class="o">&amp;&amp;</span> <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/http:\/\/www.google.com/https:\/\/www.baidu.com/g'</span> default.json

<span class="c"># 注意：不用重启jenkins</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-install-2.jpg" alt="" /></p>

<p>5、如果你手多重启了，重启之后会发现，登录页面没了，插件页面没了，这个时候，我们就需要重装一下！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@helloworld updates]# docker <span class="nb">rm</span> <span class="nt">-f</span> <span class="nt">-v</span>  jenkins
<span class="c"># 删除挂载的目录</span>
<span class="o">[</span>root@helloworld var]# <span class="nb">rm</span> <span class="nt">-rf</span> jenkins_home/
</code></pre></div></div>

<font color="red">结论：上面的那一步修改完后加速地址不用重启jenkins</font>

<p>6、配置完加速地址后，新手选择“安装推荐插件”，老手选择“选择插件安装”</p>

<p>等待安装的过程发现安装的特别慢，超过2分钟第一行还没绿，直接重装，清除数据，重新配置 updates加速地址！</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-install-4.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-plugin-install.png" alt="" /></p>

<p>7、安装成功，创建管理账号，然后就成功了！</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-install-5.jpg" alt="" /></p>

<p>点击保存并完成就行，然后就是重启jenkins让部分插件生效</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-install-6.jpg" alt="" /></p>

<h3 id="页面相关知识">页面相关知识</h3>

<p>url重启Jenkins：ip:8080/restart</p>

<p>登录界面，中文支持，配置项！</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-login.png" alt="" /></p>

<p>1、用户列表</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pages-1.jpg" alt="" /></p>

<p>2、构建历史</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pages-2.jpg" alt="" /></p>

<p>3、系统管理，最重要的页面</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pages-3.jpg" alt="" /></p>

<ul>
  <li>
    <p>系统管理-&gt;插件管理-&gt;设置 -&gt;插件地址（经常用）
安装可视化插件blue ocean</p>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-plugin-blue-ocean.png" alt="" /></p>

    <p>安装插件Gitee 码云</p>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-plugin-gitee.png" alt="" /></p>

    <p>安装插件Gitlab</p>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-plugin-gitlab.png" alt="" /></p>
  </li>
</ul>

<p>​		选择直接安装</p>

<ul>
  <li>
    <p>系统管理-&gt;系统信息</p>

    <p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pages-4.jpg" alt="" /></p>
  </li>
</ul>

<p>4、成员视图配置，新建视图</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-initial-team-member-config.png" alt="" /></p>

<p>5、我们之后使用 blue ocean 界面！下载对应插件即可！</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-blue-ocean.png" alt="" /></p>

<h2 id="5pipeline">5、Pipeline</h2>

<h3 id="51-hello-jenkins">5.1 hello-jenkins</h3>

<p>什么 Pipeline ？ 流水线！ 编码=&gt; 推送到远程=&gt; 测试=&gt; 环境部署=&gt; 打包上线……（一些列流程的集合！shell）</p>

<p>就是落地实现Devops的第3步：Jenkins  接收gitlab通知 =&gt; 执行流水线脚本 （一堆命令的集合！）</p>

<p>1、创建一个流水线任务</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-pipeline-1.png" alt="" /></p>

<p>2、编写脚本</p>

<p><code class="highlighter-rouge">Jenkinsfile</code>，定义流水线的脚本文件！参考官网<a href="https://www.jenkins.io/zh/doc/pipeline/tour/hello-world/">https://www.jenkins.io/zh/doc/pipeline/tour/hello-world/</a>创建你的第一个pipeline</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-1.jpg" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pipeline 中的步骤，jenkins会帮我们自动完成！@</span>
pipeline  <span class="o">{</span>
    agent <span class="o">{</span> docker <span class="s1">'maven:3.3.3'</span> <span class="o">}</span>  <span class="c"># 环境</span>
    stages <span class="o">{</span> <span class="c"># 具体的构建</span>
        stage<span class="o">(</span><span class="s1">'build'</span><span class="o">)</span> <span class="o">{</span> <span class="c"># 大步骤：开发、测试、部署</span>
            steps <span class="o">{</span> <span class="c"># 小步骤：每一个命令！</span>
                sh <span class="s1">'mvn --version'</span>
            <span class="o">}</span>
            <span class="c"># 之后我们需要编写的步骤，都在这里编写即可！</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-2.jpg" alt="" /></p>

<p>3、点击应用，保存！返回工作台，看到任务hello-jenkins</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-3.jpg" alt="" /></p>

<p>你可以点击“立即构建”，或者点击“打开Blue Ocean”进入Blue Ocean 界面后点击“运行” ，是一样的效果，经典界面与Blue Ocean界面，</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-hello-jenkins.png" alt="image-20200709150539676" /></p>

<p>点击绿色的 打勾，看到更详细的运行过程</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-hello-jenkins-2.jpg" alt="" /></p>

<p>上面相当于在linux执行脚本</p>

<p>需要修改pipeline 脚本，下拉菜单中点击“配置”</p>

<h3 id="52-多步骤的程序如何构建">5.2 多步骤的程序如何构建</h3>

<p>官网例子：<a href="https://www.jenkins.io/zh/doc/pipeline/tour/running-multiple-steps/">https://www.jenkins.io/zh/doc/pipeline/tour/running-multiple-steps/</a></p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-4.jpg" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent any  <span class="c"># 任何环境！</span>
    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'构建'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'echo "Hello World"'</span>
                <span class="c"># 输入多个语句执行，shell脚本</span>
                sh <span class="s1">'''
                    echo "Multiline shell steps works too"   # 第一个语句
                    ls -lah																		# 第二个语句
                '''</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>点击“配置”修改pipeline脚本，点击“应用”-》“保存”</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-5.jpg" alt="" /></p>

<p>回到blue ocean 界面点击“运行”即可</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-6.jpg" alt="" /></p>

<p>运行成功</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-7.jpg" alt="" /></p>

<h3 id="53-定义执行环境">5.3 定义执行环境</h3>

<p>每个示例中的 <code class="highlighter-rouge">agent</code> 指令。 <code class="highlighter-rouge">agent</code> 指令告诉Jenkins在哪里以及如何执行Pipeline或者Pipeline子集。 正如您所预料的，所有的Pipeline都需要 <code class="highlighter-rouge">agent</code> 指令。</p>

<p>在执行引擎中，<code class="highlighter-rouge">agent</code> 指令会引起以下操作的执行：</p>

<ul>
  <li>
    <p>所有在块block中的步骤steps会被Jenkins保存在一个执行队列中。 一旦一个执行器 <a href="https://www.jenkins.io/zh/doc/pipeline/tour/agents/#../../book/glossary/#executor">executor</a> 是可以利用的，这些步骤将会开始执行。</p>
  </li>
  <li>
    <p>一个工作空间 <a href="https://www.jenkins.io/zh/doc/pipeline/tour/agents/#../../book/glossary/#workspace">workspace</a> 将会被分配， 工作空间中会包含来自远程仓库的文件和一些用于Pipeline的工作文件</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 进入挂载目录jenkins_home,</span>
<span class="o">[</span>root@helloworld ~]# <span class="nb">cd</span> /var/jenkins_home/workspace/
<span class="o">[</span>root@helloworld workspace]# <span class="nb">ls
</span>hello-jenkins  hello-jenkins@tmp
</code></pre></div>    </div>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-home-workspace.png" alt="" /></p>

    <p>小技巧：如果未来项目报错了，来workspace目录找对应的项目文件</p>
  </li>
</ul>

<p>规则参考：https://www.jenkins.io/doc/book/pipeline/syntax/#agent</p>

<p><code class="highlighter-rouge">agent</code> 指令更多选项和相关信息，可以查看 <a href="https://www.jenkins.io/doc/book/pipeline/syntax#agent">语法参考</a> 。</p>

<p><strong>any</strong> （常用）</p>

<p><strong>none</strong></p>

<p><strong>label</strong></p>

<p><strong>node</strong></p>

<p><strong>docker</strong> （常用）</p>

<p><strong>dockerfile</strong></p>

<p><strong>kubernetes</strong></p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-agent-1.jpg" alt="" /></p>

<p>环境和步骤，我们可以搞定了！</p>

<h3 id="54-环境变量">5.4 环境变量</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent any
	<span class="c"># 如果要定义自己的环境变量，我们可以在这里配置，自动部署的，环境的部署！</span>
    environment <span class="o">{</span>
    	JAVA_HOME <span class="o">=</span> <span class="s1">'/usr/local/java'</span>
        DISABLE_AUTH <span class="o">=</span> <span class="s1">'true'</span>
        DB_ENGINE    <span class="o">=</span> <span class="s1">'sqlite'</span>
    <span class="o">}</span>

    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'Build'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'printenv'</span> <span class="c"># 打印所有的环境变量</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-8.jpg" alt="" /></p>

<p>运行</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-9.jpg" alt="" /></p>

<h3 id="55-善后记录测试和构建结果">5.5 善后(记录测试和构建结果)</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent any
    stages <span class="o">{</span>
         stage<span class="o">(</span><span class="s1">'No-op'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'ls'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c"># 结束之后执行什么！在整个构建过程中，做一些事情！</span>
    post <span class="o">{</span>
        <span class="c"># 总是执行,构建后都会执行</span>
        always <span class="o">{</span>
            <span class="nb">echo</span> <span class="s1">'One way or another, I have finished'</span>
            deleteDir<span class="o">()</span> /<span class="k">*</span> clean up our workspace <span class="k">*</span>/
        <span class="o">}</span>
        <span class="c"># 成功之后执行</span>
        success <span class="o">{</span>
            <span class="nb">echo</span> <span class="s1">'I succeeeded!'</span>
            mail to: <span class="s1">'747463168@qq.com'</span>,
               subject: <span class="s2">"构建成功: </span><span class="k">${</span><span class="nv">currentBuild</span><span class="p">.fullDisplayName</span><span class="k">}</span><span class="s2">"</span>,
               body: <span class="s2">"hello-jenkins运行成功了 </span><span class="k">${</span><span class="nv">env</span><span class="p">.BUILD_URL</span><span class="k">}</span><span class="s2">"</span>
        <span class="o">}</span>
        <span class="c"># 不稳定的状态</span>
        unstable <span class="o">{</span>
            <span class="nb">echo</span> <span class="s1">'I am unstable :/'</span>
        <span class="o">}</span>
        <span class="c"># 失败，部署！失败进行清理文件数据等</span>
        failure <span class="o">{</span>
            <span class="nb">echo</span> <span class="s1">'I failed :('</span>
        <span class="o">}</span>
        <span class="c"># 改变</span>
        changed <span class="o">{</span>
            <span class="nb">echo</span> <span class="s1">'Things were different before...'</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>运行该脚本</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-pipeline-10.jpg" alt="" /></p>

<h3 id="55-发送邮件">5.5 发送邮件</h3>

<p>官方文档:<a href="https://www.jenkins.io/zh/doc/pipeline/tour/post/">https://www.jenkins.io/zh/doc/pipeline/tour/post/</a></p>

<p>前提是Jenkins已安装email插件</p>

<p><img src="/assets/images/2020/icoding/docker/devops-jenkins-plugins-email.jpg" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent any
    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'Test'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'./gradlew check'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    post <span class="o">{</span>
      failure <span class="o">{</span>
          mail to: <span class="s1">'team@example.com'</span>,
               subject: <span class="s2">"Failed Pipeline: </span><span class="k">${</span><span class="nv">currentBuild</span><span class="p">.fullDisplayName</span><span class="k">}</span><span class="s2">"</span>,
               body: <span class="s2">"Something is wrong with </span><span class="k">${</span><span class="nv">env</span><span class="p">.BUILD_URL</span><span class="k">}</span><span class="s2">"</span>
      <span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>    
</code></pre></div></div>

<p>如果指令失败，或者网络问题，那么我们结束构建！后置处理，放在post标签的failure 进行处理</p>

<h3 id="56-部署流程">5.6 部署流程</h3>

<p>官方文档：<a href="https://www.jenkins.io/zh/doc/pipeline/tour/deployment/">https://www.jenkins.io/zh/doc/pipeline/tour/deployment/</a></p>

<p>大多数最基本的持续交付 Pipeline 至少会有三个阶段：构建、测试和部署</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent any
    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'Build'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                <span class="nb">echo</span> <span class="s1">'Building'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'Test'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                <span class="nb">echo</span> <span class="s1">'Testing'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'Deploy'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                <span class="nb">echo</span> <span class="s1">'Deploying'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>点击“运行”，流程是这个样子</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-pipeline-run.png" alt="" /></p>

<h3 id="57-人工确认">5.7 人工确认</h3>

<p>官方文档：[https://www.jenkins.io/zh/doc/pipeline/tour/deployment/](</p>

<p>通常在阶段之间，特别是不同环境阶段之间，您可能需要人工确认是否可以继续运行。 例如，判断应用程序是否在一个足够好的状态可以进入到生产环境阶段。 这可以使用 <code class="highlighter-rouge">input</code> 步骤完成。 在下面的例子中，“Sanity check” 阶段会等待人工确认，并且在没有人工确认的情况下不会继续执行。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent any
    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'Deploy - Staging'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                <span class="nb">echo</span> <span class="s1">'Building'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'Sanity check'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                input <span class="s2">"Does the staging environment look ok?"</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'Deploy - Production'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                <span class="nb">echo</span> <span class="s1">'Building'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-pipeline-run-2.png" alt="" /></p>

<p>效果，如果用户点击ok，那么我们执行，否则不执行，跳过！</p>

<h2 id="6webhooks">6、WebHooks</h2>

<p>无论是码云。还是github、还是gitlab。都有webhook？</p>

<p>什么是 webhook？ 我们提交代码或者更新了仓库中的内容，可以触发一个事件，接收到这个事件！</p>

<h3 id="码云的webhooks">码云的webhooks</h3>

<p>登录码云，打开一个仓库，点击管理，会看到webhooks，点击“添加”，POST地址是公网的</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-gitee-webhooks.png" alt="" /></p>

<h3 id="github的webhooks">Github的webhooks</h3>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-github-webhooks.png" alt="" /></p>

<h3 id="gitlab的webhooks">Gitlab的webhooks</h3>

<p>进入项目</p>

<p><img src="/assets/images/2020/icoding/docker/devops-gitlab-webhooks.jpg" alt="" /></p>

<p>点击“Settings”,找到Webhooks</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-gitlab-project-webhooks.png" alt="" /></p>

<h3 id="测试webhook通知机制">测试webhook通知机制！</h3>

<p>目的： git仓库发现变化，自动通知jenkins来执行！</p>

<p>登录自己的gitlab仓库</p>

<p>1、创建项目hello-jenkins ，确定gitlab仓库可用</p>

<p>2、jenkins配置触发器（核心！）</p>

<p>进入任务 hello-jenkins，点击配置，找到“构建触发器”</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-1.jpg" alt="" /></p>

<p>构建触发器，有多种选择</p>

<ul>
  <li>
    <p>其他工程构建后触发</p>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-pipeline-trigger-1.png" alt="" /></p>
  </li>
  <li>
    <p>定时构建，写cron表达式</p>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-pipeline-trigger-2.png" alt="" /></p>
  </li>
  <li>
    <p>Gitlab webhook</p>

    <p><img src="/assets/images/2020/icoding/docker/devops/jenkins-pipeline-trigger-3.png" alt="" /></p>
  </li>
  <li>
    <p>我们通常和github、gitlab来绑定！</p>

    <p>如果你这里没有对应的插件，那么就会找不到，然后需要去插件管理中下载！</p>

    <p>安装gitlab的所有插件</p>

    <p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-plugin-gitlab.jpg" alt="" /></p>
  </li>
</ul>

<p>3、构建触发器，我们使用Gitlab webhook的方式 ,得到jenkins hook地址和生成的授权密钥，填写到Gitlab的Webhooks上</p>

<p><strong>第1步：配置Gitlab的Webhook</strong></p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-2.jpg" alt="" /></p>

<p>jenkins配置 点击“应用”</p>

<p>GitLab上点击“Add Webhook”</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-3.jpg" alt="" /></p>

<p>如果出现了下面的报错接不上</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-webhooks-network-allowed-error.png" alt="" /></p>

<p>GitLab需要配置允许所有网络访问，记得点击 “Save Change ”</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-webhooks-network-allowed-error2.png" alt="" /></p>

<p>配置生效后</p>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-webhook-add-success.png" alt="" /></p>

<p><strong>第2步：测试触发</strong></p>

<p>在项目上添加一个文件</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-gitlab-2.jpg" alt="" /></p>

<p>在GitLab的webhooks，点击“Push event”</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-gitlab-1.jpg" alt="" /></p>

<p>push 成功，会提示“Hook executed successfully: HTTP 200”</p>

<p>回到Jenkins，查看任务hello-jenkins，发现已自动构建，仓库发生变化就会触发Jenkins自动构建</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-4.jpg" alt="" /></p>

<p><mark>结论：</mark> 如果Gitlab触发成功，Jenkins收到事件，那么就会自动构建！之后，只要我们的仓库，有动静，那么Jenkins就会自动构建！</p>

<p><mark>注意：</mark> <strong>失败，hook连接不上，网络配置！  阿里云+github/gitee，只要保证端口开放即可！</strong></p>

<h2 id="7流水线实战">7、流水线实战</h2>

<p>Docker + Dockerfile + DockerCompose（Docker Swarm架构，使用docker stack 命令上线）</p>

<blockquote>
  <p>补充：课后练习，集群的时候可以使用 docker stack  deploy部署项目！</p>
</blockquote>

<p>DockerCompose.yml  =&gt; docker-compose up 上线，可以构建镜像</p>

<p>DockerCompose.yml  =&gt; docker stack  deploy -f DockerCompose.yml  集群上线！只能使用现成的镜像！</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.8"</span>
<span class="na">services</span><span class="pi">:</span>   <span class="c1"># 每个服务，可以动态扩容</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:alpine</span>
    <span class="na">deploy</span><span class="pi">:</span> <span class="c1"># 集群  docker stack  deploy 才会生效，集群！</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="m">6</span> <span class="c1"># 副本数！</span>
      <span class="na">update_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="m">2</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
</code></pre></div></div>

<h3 id="项目push到gitlab">项目push到gitlab</h3>

<blockquote>
  <p>计数器 springboot + redis</p>
</blockquote>

<p>1、创建Springboot项目</p>

<p>增加阿里云仓库配置文件setting.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;settings</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/SETTINGS/1.0.0"</span>
          <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
          <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;mirrors&gt;</span>
      <span class="nt">&lt;mirror&gt;</span>
          <span class="nt">&lt;id&gt;</span>nexus-aliyun<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;mirrorOf&gt;</span>central<span class="nt">&lt;/mirrorOf&gt;</span>
          <span class="nt">&lt;name&gt;</span>Nexus aliyun<span class="nt">&lt;/name&gt;</span>
          <span class="nt">&lt;url&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central<span class="nt">&lt;/url&gt;</span>
      <span class="nt">&lt;/mirror&gt;</span>
  <span class="nt">&lt;/mirrors&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></div></div>

<p>编写项目流水线文件Jenkinsfile</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipeline <span class="o">{</span>
    agent <span class="o">{</span>
        docker <span class="o">{</span>
            image <span class="s1">'maven:3-jdk-11'</span>   <span class="c"># 不要使用 apl 压缩的，很多动态链接库不包含</span>
            args <span class="s1">'-v /root/.m2:/root/.m2'</span>
        <span class="o">}</span>
    <span class="o">}</span>
    stages <span class="o">{</span>
        stage<span class="o">(</span><span class="s1">'打包项目'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'mvn -B -gs settings.xml -DskipTests clean package'</span>   <span class="c"># 指定maven仓库为aliyun</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'环境安装'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose'</span>
                sh <span class="s1">'chmod 777 /usr/local/bin/docker-compose'</span>
                sh <span class="s1">'docker-compose version'</span>
                sh <span class="s1">'docker-compose down'</span>   <span class="c"># 先把项目下线</span>
            <span class="o">}</span>
        <span class="o">}</span>
        stage<span class="o">(</span><span class="s1">'部署上线'</span><span class="o">)</span> <span class="o">{</span>
            steps <span class="o">{</span>
                sh <span class="s1">'docker-compose up --build'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-1.jpg" alt="" /></p>

<p>2、Gitlab创建仓库项目New project</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-2.jpg" alt="" /></p>

<p>3、得到仓库地址</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone http://139.199.13.139:8888/root/compose-web.git
<span class="nb">cd </span>compose-web
<span class="nb">touch </span>README.md
git add README.md
git commit <span class="nt">-m</span> <span class="s2">"add README"</span>
git push <span class="nt">-u</span> origin master
</code></pre></div></div>

<p>克隆gitlab项目仓库，将.git文件放到项目根目录下，将代码push上去，小技巧：可以在新目录下git clone，然后直接将.git文件移动到项目的根目录下</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-3.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-5.jpg" alt="" /></p>

<p>推送代码，左上角的commit, push</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-6.jpg" alt="" /></p>

<p>登录Gitlab，查看代码</p>

<p><img src="/assets/images/2020/icoding/docker/devops-webhooks-jenkins-7.jpg" alt="" /></p>

<p>项目构建完毕，下面配置自动化流程！</p>

<h3 id="配置jenkins">配置Jenkins</h3>

<p>登录Jenkins</p>

<p><strong>1、新建一个任务</strong></p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-4.jpg" alt="" /></p>

<p><strong>2、代码和流水线文件来自git！</strong></p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-5.jpg" alt="" /></p>

<p>选择Jenkins</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-6.jpg" alt="" /></p>

<p>选择凭据，填写Jenkinsfile的脚本路径</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-7.jpg" alt="" /></p>

<p><strong>3、构建触发器</strong></p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-8.png" alt="image-20200710111140064" /></p>

<p>点击“应用”，然后到Gitlab上添加webhook 触发构建任务</p>

<p><strong>4、Gitlab上添加webhook</strong></p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-9.jpg" alt="" /></p>

<font color="red">同一个项目下可以有多个webhook，也就是说可以触发多个Jenkins下的自动构建任务</font>

<h3 id="测试">测试</h3>

<p>先手动自己运行构建任务，看是否成功，后期再通过提交代码到gitlab，webhook触发自动构建</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-10.jpg" alt="" /></p>

<p>部署上线失败</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-12.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-13.jpg" alt="" /></p>

<p>解决：</p>

<p>修改Dockerfile</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM java:8

COPY target/<span class="k">*</span>.jar /app.jar

CMD <span class="o">[</span><span class="s2">"--server.port=8080"</span><span class="o">]</span>

EXPOSE 8080

ENTRYPOINT <span class="o">[</span><span class="s2">"java"</span>,<span class="s2">"-jar"</span>,<span class="s2">"/app.jar"</span><span class="o">]</span>
</code></pre></div></div>

<p>修改docker-compose.yml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">compose-web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">compose-web"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8090:8080"</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis:alpine"</span>
</code></pre></div></div>

<p>commit and push 代码，gitlab通过webhook机制通知jenkins自动构建部署项目。</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-15.jpg" alt="" /></p>

<p>访问请求</p>

<p><img src="/assets/images/2020/icoding/docker/devops-compose-web-16.jpg" alt="" /></p>

<p>持久化的数据，数据库，redis，maven依赖，尽量挂载同步到我们的本地！</p>

<p>这里就是我们最开始演示的步骤了！</p>

<p>如果是网络问题，参考我们今天开始的时候演示的时候的解决办法！</p>

<p>问题：容器内断网了！</p>

<p>解决：重启docker，重启容器！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 停掉所有容器</span>
docker stop <span class="si">$(</span>docker ps <span class="nt">-qa</span><span class="si">)</span>

<span class="c"># 重启docker</span>
systemctl restart docker
</code></pre></div></div>

<p>假设出现了问题，文件丢失，不正确，你就可以来这个 workspace查看！</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@helloworld ~]# <span class="nb">cd</span> /var/jenkins_home/workspace/
<span class="o">[</span>root@helloworld workspace]# <span class="nb">ls
</span>compose-web  compose-web@tmp  hello-jenkins@tmp
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/docker/devops/jenkins-home-workspace-2.png" alt="" /></p>

<p><strong>总结</strong></p>

<p>1、docker 集群使用swarm的话，那么jenkins应该安装在一个manager节点上，执行脚本从代码仓库拉取代码重新构造镜像后，使用docker service 命令灰度发布服务。</p>

<h2 id="作业">作业</h2>

<p>1、自己尝试自动构建3个以上的项目 Jenkinsfile  （shell学起来！）</p>

<p>shell菜鸟教程<a href="https://www.runoob.com/linux/linux-shell.html">https://www.runoob.com/linux/linux-shell.html</a></p>

<p><img src="/assets/images/2020/icoding/docker/shell-study.jpg" alt="" /></p>



            <div>
   <!-- <p align="center">
     	  
         <img src="/assets/images/keeppuresmile.jpg" >
         <br/>
         微信扫描二维码，关注一个有故事的程序员
        

   </p>
   <p align="center" style="margin-top: 15px; font-size: 11px;color: #cc0000;">
       <strong>（转载本站文章请注明作者和出处 <a href="http://www.ityouknow.com">纯洁的微笑-ityouknow</a>）</strong>
   </p>
   <p align="center" style="margin-top: 15px; font-size: 16px;color: #337ab7;">
       <strong><a href="http://www.justdojava.com/" target="_blank">点击了解 ：Java 技术人的网站</a></strong>
   </p> -->
</div>

            <!-- Comments -->
            <div class="comment">
             

  

  
        <div id="gitalk-container"></div>
        <script src="/assets/js/gitalk.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
        <script>
        var gitalk = new Gitalk({
            id: '/icoding-edu/2020/06/11/icoding-note-047.html',
            clientID: '6cd8ad4d1cf1d1e6ad95',
            clientSecret: 'c4ce22a25efe50bfd60da67c990b534bc99a6424',
            repo: 'aikomj.github.io',
            owner: 'aikomj',
            admin: ['aikomj'],
            labels: ['gitalk'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


            </div>
        </div>

        <div class="col-md-3">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>
     <!--<div class="asb-post-01">-->
        <!--<div class="mask"></div>-->
            <!--<div class="info">-->
                <!--<div>扫码关注公众号：<span style="color: #E9405A; font-weight: bold;">纯洁的微笑</span></div>-->
            <!--<div>-->
            <!--<span>发送 </span><span class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span>-->
            <!--<div>-->
                <!--即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章-->
            <!--</div>-->
            <!--<img class="code-img" style="width: 300px;display:unset" src="/assets/images/keeppuresmile.jpg">-->
        <!--</div>-->
    <!--</div>-->
</article>

        </div>

    
<footer class="container">
    <div class="site-footer">
       <!--  <div class="site-footer-icons">
            <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
               知乎
            </a>
            <a target="_blank" href="http://weibo.com/ityouknow">
               微博
            </a>
            <a target="_blank" href="https://github.com/ityouknow">
                GitHub
            </a>
        </div> -->
        <!-- <div class="card text-center">
            <ul class="list-inline" style="margin-left: 0;">
               <li>
                <a target="_blank" href="https://github.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa  fa-stack-1x fa-inverse">知</i>
                  </span>
                </a>
              </li>
                  <li>
                <a target="_blank" href="https://weibo.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          </ul>
        </div> -->
        <div class="site-footer-links mobile-hidden">
            
        </div>
        <div class="scrolltop">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>
        <div class="rss">
            <a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a>
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>
    </div>
    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>
    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>
    
    
     <!-- Cnzz Analytics -->
       <div style="display:none">
         <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260945749'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260945749' type='text/javascript'%3E%3C/script%3E"));</script>
       </div>
     <!-- Cnzz Analytics -->
</footer>


    </body>

</html>
