<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <title> 飞天班第11节：SpringBoot开发单体应用（中） - 大伟的博客 </title>
    <meta name="keywords" content="springboot">
    <meta name="description"
          content="页面国际化配置，后端国际化错误信息返回,登录拦截器，前端Thymeleaf页面的CRUD操作，error页面处理，快速扒前端页面">

    <link rel="canonical" href="http://47.113.95.179/jk-blog/icoding-edu/2020/03/21/icoding-note-011.html">
    <link rel="alternate" type="application/rss+xml" title="大伟,专注Spring Boot,Spring Cloud,Docker,Java后端技术" href="http://47.113.95.179/jk-blog/feed.xml">

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/gitalk.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->

    

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">-->

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/lock.js"></script>
</head>


    <body>

    <header class="site-header">
    <div class="site-header-topbar">
        <div class="container">
            <div class="topbar-menu">
                
                <div class="item">
                    <a href="/archives.html"
                       target="_self"
                       title="Archives">
                        Archives
                    </a>
                </div>
                
                <div class="item">
                    <a href="/linux.html"
                       target="_self"
                       title="Linux">
                        Linux
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mysql.html"
                       target="_self"
                       title="Mysql">
                        Mysql
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mongodb.html"
                       target="_self"
                       title="MongoB">
                        MongoB
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mq.html"
                       target="_self"
                       title="MQ">
                        MQ
                    </a>
                </div>
                
                <div class="item">
                    <a href="/fastdfs.html"
                       target="_self"
                       title="FastDFS">
                        FastDFS
                    </a>
                </div>
                
                <div class="item">
                    <a href="/redis.html"
                       target="_self"
                       title="Redis">
                        Redis
                    </a>
                </div>
                
                <div class="item">
                    <a href="/elasticsearch.html"
                       target="_self"
                       title="ES">
                        ES
                    </a>
                </div>
                
                <div class="item">
                    <a href="/docker.html"
                       target="_self"
                       title="Docker">
                        Docker
                    </a>
                </div>
                
                <div class="item">
                    <a href="/k8s.html"
                       target="_self"
                       title="K8s">
                        K8s
                    </a>
                </div>
                
                <div class="item">
                    <a href="/architect.html"
                       target="_self"
                       title="架构师">
                        架构师
                    </a>
                </div>
                
                <div class="item">
                    <a href="/gitee.html"
                       target="_self"
                       title="开源项目">
                        开源项目
                    </a>
                </div>
                
                <div class="item">
                    <a href="/tool.html"
                       target="_self"
                       title="工具">
                        工具
                    </a>
                </div>
                
                <div class="item">
                    <a href="/life.html"
                       target="_self"
                       title="生活">
                        生活
                    </a>
                </div>
                
                <div class="item">
                    <a href="/say.html"
                       target="_self"
                       title="说说">
                        说说
                    </a>
                </div>
                
                <div class="item">
                    <a href="/link.html"
                       target="_self"
                       title="友链">
                        友链
                    </a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container">
        <a id="site-header-brand" href="/" title="大展宏兔">
            <!--<span class="octicon octicon-mark-github"></span>-->
            <img class="logo" src="/assets/images/favicon.jpeg">
            大展宏兔
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/"
                   target=""
                   title="Home">
                    Home
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Icoding">
                    Icoding
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/icoding-edu.html" 
                           target="_self"
                     >飞天班笔记</a></li>
                    
                    <li><a href="/icoding-gavin.html" 
                           target="_self"
                     >黄埔班笔记</a></li>
                    
                    <li><a href="/icoding-allen.html" 
                           target="_self"
                     >源码分析</a></li>
                    
                    <li><a href="https://www.icodingedu.com/" 
                           target="_blank"
                     >艾编程官网</a></li>
                    
                    <li><a href="https://leetcode-cn.com/problemset/all/" 
                           target="_blank"
                     >力扣刷题</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Java">
                    Java
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/java-base.html" 
                           target="_self"
                     >Java基础</a></li>
                    
                    <li><a href="/java-concurrent.html" 
                           target="_self"
                     >Java并发</a></li>
                    
                    <li><a href="/design-mode.html" 
                           target="_self"
                     >设计模式</a></li>
                    
                    <li><a href="http://www.justdojava.com" 
                           target="_blank"
                     >Java 极客技术</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring.html"
                   target="_self"
                   title="Spring">
                    Spring
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-boot.html"
                   target="_self"
                   title="Spring Boot">
                    Spring Boot
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-cloud.html"
                   target="_self"
                   title="Spring Cloud">
                    Spring Cloud
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Go全栈">
                    Go全栈
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/go-base.html" 
                           target="_self"
                     >Go语言基础</a></li>
                    
                    <li><a href="/go-web.html" 
                           target="_self"
                     >Web开发</a></li>
                    
                    <li><a href="/go-middleware.html" 
                           target="_self"
                     >中间件</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/front.html"
                   target="_self"
                   title="大前端">
                    大前端
                </a>
                
            </div>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="飞天班第11节：SpringBoot开发单体应用（中）">
    <div class="container">
        <div id="jumbotron-meta-info">        
            <h1>飞天班第11节：SpringBoot开发单体应用（中）</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2020/03/21
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container noneed" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h2 id="1页面国际化">1、页面国际化</h2>

<h3 id="新增国际化配置文件">新增国际化配置文件</h3>

<p>idea首先要保证文件编码是UTF8</p>

<p><img src="/assets/images/2020/icoding/springboot/file-encode-utf8.jpg" alt="" /></p>

<p>K8s(kubernetes) 中间有8个字母</p>

<p>i18n(internationalization 国际化) 中间有18个字母 ，在项目中建一个i18n文件夹，表示国际化配置</p>

<p>在resource目录下建一个i18n文件夹，并在该文件下建一个login.properties文件</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-properties.jpg" alt="" /></p>

<p>再建一个中文的配置文件login_zh_CN.properties</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-properties-2.jpg" alt="" /></p>

<p><mark>注意文件夹的变化，IDEA自动帮我们识别了国际化配置文件</mark></p>

<p>这时候我们就可以快速的配置其他语言的配置文件了，如下图右键</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-properties-3.jpg" alt="" /></p>

<p>弹框中，点击加号</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-properties-4.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-properties-5.jpg" alt="" /></p>

<p>这时候我们发现已经添加类en_US 英文配置文件</p>

<h3 id="配置键值对">配置键值对</h3>

<p>我们给这三个配置文件加一个属性，点击下图中添加按钮，然后再点击<code class="highlighter-rouge">Resource Bundle</code>视图</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-1.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-2.jpg" alt="" /></p>

<p>继续配置其他属性，最终完成的效果：</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-3.jpg" alt="" /></p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-4.jpg" alt="" /></p>

<p><strong>如果是一整个完整的页面，文章量十分大的时候，没必要做这些细节的国际化操作</strong>，直接路由到两个不同语言的页面就好。</p>

<blockquote>
  <p>1、Thymeleaf配置国际化</p>
</blockquote>

<p>看官方文档，我们知道使用#来获取国际化的配置变量值</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Message Expressions: <span class="c">#{…} 国际化内容获取！</span>
</code></pre></div></div>

<blockquote>
  <p>2、还需要让项目识别我们的国际化配置</p>
</blockquote>

<p>首先我们全局搜索<code class="highlighter-rouge">MessageSourceAutoConfiguration</code> 分析源码，它是国际化消息读取的自动配置类</p>

<p>每一个AutoConfiguration都会绑定一个Properties，Properties绑定到我们的application.properties配置文件，所以我们可以在application.properties修改配置属性</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-messageSourceAutoconfiguration.jpg" alt="" /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">MessageSource</span> <span class="nf">messageSource</span><span class="o">(</span><span class="nc">MessageSourceProperties</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">ResourceBundleMessageSource</span> <span class="n">messageSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ResourceBundleMessageSource</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getBasename</span><span class="o">()))</span> <span class="o">{</span>
    <span class="n">messageSource</span><span class="o">.</span><span class="na">setBasenames</span><span class="o">(</span><span class="nc">StringUtils</span>
                               <span class="o">.</span><span class="na">commaDelimitedListToStringArray</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">trimAllWhitespace</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getBasename</span><span class="o">())));</span>
  <span class="o">}</span>
  <span class="c1">// 获取properties的编码信息</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">messageSource</span><span class="o">.</span><span class="na">setDefaultEncoding</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getEncoding</span><span class="o">().</span><span class="na">name</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">messageSource</span><span class="o">.</span><span class="na">setFallbackToSystemLocale</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">isFallbackToSystemLocale</span><span class="o">());</span>
  <span class="nc">Duration</span> <span class="n">cacheDuration</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">getCacheDuration</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">cacheDuration</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">messageSource</span><span class="o">.</span><span class="na">setCacheMillis</span><span class="o">(</span><span class="n">cacheDuration</span><span class="o">.</span><span class="na">toMillis</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">messageSource</span><span class="o">.</span><span class="na">setAlwaysUseMessageFormat</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">isAlwaysUseMessageFormat</span><span class="o">());</span>
  <span class="n">messageSource</span><span class="o">.</span><span class="na">setUseCodeAsDefaultMessage</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">isUseCodeAsDefaultMessage</span><span class="o">());</span>
  <span class="k">return</span> <span class="n">messageSource</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>这里我们需要在application.properties配置<code class="highlighter-rouge">MessageSourceProperties</code>的basename属性</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 配置绑定国际化的login路径,不加classpath,默认从根路径resource下读取
</span><span class="py">spring.messages.basename</span><span class="p">=</span><span class="s">i18n.login</span>
</code></pre></div></div>

<p>配置完后，可以在我们的前端页面看到提示，如我们这里的login.html显示了前面配置的国际化信息</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-5.jpg" alt="" /></p>

<p>把前端内容填写完毕，重新启动项目，刷新页面，</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-6.jpg" alt="" /></p>

<p>原理，请求头带有语言信息 Accept-Language</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-login-7.jpg" alt="" /></p>

<h3 id="动态切换">动态切换</h3>

<p>理想效果，可以通过点击按钮实现动态切换</p>

<p>以Duubo官网为例</p>

<p>中文：<a href="https://dubbo.apache.org/zh/">https://dubbo.apache.org/zh/</a></p>

<p>英文：<a href="https://dubbo.apache.org/en">https://dubbo.apache.org/en/</a></p>

<p>可以发现是通过不同链接来实现国际化映射的！</p>

<p>在Spring中，有一个国际化对象Locale，它是Java的一个原生对象！我们在<code class="highlighter-rouge">WebMvcAutoConfiguration</code>自动配置类中，搜索locale</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-locale-resolver.jpg" alt="" /></p>

<p>发现Springboot  帮我们自动注入了国际化的组件 localResolver</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@ConditionalOnMissingBean</span> <span class="c1">// 不存在这个bean才生效</span>
<span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"spring.mvc"</span><span class="o">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"locale"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">LocaleResolver</span> <span class="nf">localeResolver</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// 如果用户没配置国际化解析对象，就使用默认的</span>
  <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mvcProperties</span><span class="o">.</span><span class="na">getLocaleResolver</span><span class="o">()</span> <span class="o">==</span> <span class="nc">WebMvcProperties</span><span class="o">.</span><span class="na">LocaleResolver</span><span class="o">.</span><span class="na">FIXED</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">FixedLocaleResolver</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mvcProperties</span><span class="o">.</span><span class="na">getLocale</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="c1">// 否则，使用接受请求头关于国际化的对象</span>
  <span class="nc">AcceptHeaderLocaleResolver</span> <span class="n">localeResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AcceptHeaderLocaleResolver</span><span class="o">();</span>
  <span class="n">localeResolver</span><span class="o">.</span><span class="na">setDefaultLocale</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">mvcProperties</span><span class="o">.</span><span class="na">getLocale</span><span class="o">());</span>
  <span class="k">return</span> <span class="n">localeResolver</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>重点在<code class="highlighter-rouge">AcceptHeaderLocaleResolver</code>，点击它的源码</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-locale-resolver-2.jpg" alt="" /></p>

<p>它实现了<code class="highlighter-rouge">LocalResolver</code>接口，我们找到它重写的方法（看一个类的3个主要地方：构造函数、init方法、重写方法）</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Locale</span> <span class="n">defaultLocale</span> <span class="o">=</span> <span class="n">getDefaultLocale</span><span class="o">();</span>
  <span class="c1">// 从request请求中获取Accept-Language的语言信息</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">defaultLocale</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Accept-Language"</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">defaultLocale</span><span class="o">;</span> <span class="c1">// 返回默认的国际化对象</span>
  <span class="o">}</span>
  <span class="nc">Locale</span> <span class="n">requestLocale</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getLocale</span><span class="o">();</span> <span class="c1">// 得到请求中的国际化信息</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Locale</span><span class="o">&gt;</span> <span class="n">supportedLocales</span> <span class="o">=</span> <span class="n">getSupportedLocales</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">supportedLocales</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">||</span> <span class="n">supportedLocales</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">requestLocale</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">requestLocale</span><span class="o">;</span> <span class="c1">// 返回请求的国际化对象</span>
  <span class="o">}</span>
  <span class="nc">Locale</span> <span class="n">supportedLocale</span> <span class="o">=</span> <span class="n">findSupportedLocale</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">supportedLocales</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">supportedLocale</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">supportedLocale</span><span class="o">;</span> <span class="c1">// 返回支持的国际化对象，具体看源码中的findSupportedLocale方法</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">defaultLocale</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">defaultLocale</span> <span class="o">:</span> <span class="n">requestLocale</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>我们要定义一个国际化请求解析器，让Spring使用我们请求的国际化解析器</p>

<p>1、修改前端页面的点击链接</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- localhost:8080/index?l=zh_CN thymeleaf中传递参数不用使用? 使用（）--&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-sm"</span> <span class="na">th:href=</span><span class="s">"@{/index(l='zh_CN')}"</span><span class="nt">&gt;</span>中文<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-sm"</span> <span class="na">th:href=</span><span class="s">"@{/index(l='en_US')}"</span><span class="nt">&gt;</span>English<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>2、实现<code class="highlighter-rouge">LocalResolver</code>接口</p>

<p>点击<code class="highlighter-rouge">Locale</code>，看源码里有很多已经定义的国家和语言</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-locale-1.jpg" alt="" /></p>

<p>看构造函数</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">Locale</span><span class="o">(</span><span class="nc">String</span> <span class="n">language</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">this</span><span class="o">(</span><span class="n">language</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="nf">Locale</span><span class="o">(</span><span class="nc">String</span> <span class="n">language</span><span class="o">,</span> <span class="nc">String</span> <span class="n">country</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">this</span><span class="o">(</span><span class="n">language</span><span class="o">,</span> <span class="n">country</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
<span class="o">}</span>
<span class="cm">/**
     * This method must be called only for creating the Locale.*
     * constants due to making shortcuts.
     */</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="nc">Locale</span> <span class="nf">createConstant</span><span class="o">(</span><span class="nc">String</span> <span class="n">lang</span><span class="o">,</span> <span class="nc">String</span> <span class="n">country</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">BaseLocale</span> <span class="n">base</span> <span class="o">=</span> <span class="nc">BaseLocale</span><span class="o">.</span><span class="na">createInstance</span><span class="o">(</span><span class="n">lang</span><span class="o">,</span> <span class="n">country</span><span class="o">);</span>
  <span class="k">return</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">base</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>自定义国家化处理器</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLocaleResolver</span> <span class="kd">implements</span> <span class="nc">LocaleResolver</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="nc">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">language</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"l"</span><span class="o">);</span>
		<span class="nc">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="nc">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span> <span class="c1">// 如果我们没有配置，就使用默认的</span>
		<span class="k">if</span><span class="o">(!</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">language</span><span class="o">)){</span>
			<span class="nc">String</span><span class="o">[]</span> <span class="n">split</span> <span class="o">=</span> <span class="n">language</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"_"</span><span class="o">);</span>
			<span class="n">locale</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Locale</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span><span class="n">split</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span> <span class="c1">// 创建国际化对象</span>
		<span class="o">}</span>

		<span class="k">return</span> <span class="n">locale</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>

	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>3、注册到spring容器中</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMvcConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="nc">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// 视图跳转的控制！</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/index"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"login2"</span><span class="o">);</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"login2"</span><span class="o">);</span>
		<span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/index.html"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"login2"</span><span class="o">);</span>
	<span class="o">}</span>

  <span class="c1">// 注意bean的id 只能为localeResolver，因为Springboot会去扫描并识别</span>
	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="nc">LocaleResolver</span> <span class="nf">localeResolver</span><span class="o">(){</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">MyLocaleResolver</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>重启项目，点击测试</p>

<p><img src="/assets/images/2020/icoding/springboot/i18n-locale-2.jpg" alt="" /></p>

<h3 id="后端国际化信息返回">后端国际化信息返回</h3>

<p>正常配置国际化信息文件/resource/i18n/fsc_message</p>

<p><img src="\assets\images\2021\spring\i18n-back.png" alt="" /></p>

<p>创建枚举类RccErrorEnum，统一错误信息</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">RccErrorEnum</span> <span class="kd">implements</span> <span class="nc">ErrorInterface</span><span class="o">,</span> <span class="nc">EnumInterface</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;,</span> <span class="nc">BaseEnum</span> <span class="o">{</span>
    <span class="no">OK</span><span class="o">(</span><span class="s">"000000"</span><span class="o">,</span> <span class="s">"操作成功"</span><span class="o">),</span>
    <span class="no">FAIL</span><span class="o">(</span><span class="s">"999999"</span><span class="o">,</span> <span class="s">"操作失败"</span><span class="o">),</span>
    <span class="no">ID_NOT_NULL</span><span class="o">(</span><span class="s">"PRT002"</span><span class="o">,</span> <span class="s">"主键id不能为空"</span><span class="o">),</span>
    <span class="no">FOREIGN_KEY_NOT_NULL</span><span class="o">(</span><span class="s">"PRT003"</span><span class="o">,</span> <span class="s">"外键不能为空"</span><span class="o">),</span>
    <span class="no">HEAD_TABLE_ID_NOT_NULL</span><span class="o">(</span><span class="s">"PRT004"</span><span class="o">,</span> <span class="s">"头表id不能为空"</span><span class="o">),</span>
    <span class="no">ERROR_MESSAGE</span><span class="o">(</span><span class="s">"errorMessage"</span><span class="o">,</span> <span class="s">"errorMessage"</span><span class="o">),</span>
    <span class="no">ERROR_PERIOD_FORMAT</span><span class="o">(</span><span class="s">"ERROR_PERIOD_FORMAT"</span><span class="o">,</span><span class="s">"账期格式错误"</span><span class="o">),</span>
    <span class="no">ERROR_PERIOD_PARAM</span><span class="o">(</span><span class="s">"ERROR_PERIOD_PARAM"</span><span class="o">,</span><span class="s">"账期不能为空"</span><span class="o">),</span>
    <span class="no">ERROR_PAGE_PARAM</span><span class="o">(</span><span class="s">"ERROR_PAGE_PARAM"</span><span class="o">,</span><span class="s">"分页参数不正确"</span><span class="o">),</span>
    <span class="no">ERROR_NO_DETAILS</span><span class="o">(</span><span class="s">"ERROR_NO_DETAILS"</span><span class="o">,</span><span class="s">"没有未汇总的明细"</span><span class="o">),</span>
    <span class="no">ERROR_ON_SUM</span><span class="o">(</span><span class="s">"ERROR_ON_SUM"</span><span class="o">,</span><span class="s">"汇总处理失败,批次号{0}"</span><span class="o">)</span>
    <span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="nc">RccErrorEnum</span><span class="o">(</span><span class="nc">String</span> <span class="n">code</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
  
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">MessageUtils</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="nc">LanguageConstants</span><span class="o">.</span><span class="na">LANGUAGE_ENUM_MAP</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">InitConfig</span><span class="o">.</span><span class="na">MODULE_LANGUAGE</span><span class="o">).</span><span class="na">getLocale</span><span class="o">(),</span>
                                   <span class="s">"i18n/fsc_message"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">code</span><span class="o">);</span>
  <span class="o">}</span>
  
      <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">(</span><span class="nc">Object</span><span class="o">...</span> <span class="n">msgParams</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="nc">MessageUtils</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="nc">LanguageConstants</span><span class="o">.</span><span class="na">LANGUAGE_ENUM_MAP</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">InitConfig</span><span class="o">.</span><span class="na">MODULE_LANGUAGE</span><span class="o">).</span><span class="na">getLocale</span><span class="o">(),</span>
                <span class="s">"i18n/fsc_message"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">code</span><span class="o">,</span> <span class="n">msgParams</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">substring</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="s">"系统错误"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">substring</span><span class="o">)){</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span> 
</code></pre></div></div>

<p>使用</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SaleReceiptRecFacade</span> <span class="o">{</span>
      <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assertParam</span><span class="o">(</span><span class="nc">CommonRequest</span><span class="o">&lt;</span><span class="nc">CreateSrDetailReqDTO</span><span class="o">&gt;</span> <span class="n">request</span><span class="o">){</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getHeadParams</span><span class="o">().</span><span class="na">getTenantCode</span><span class="o">()),</span> <span class="nc">RccErrorEnum</span><span class="o">.</span><span class="na">ERROR_TENANT_PARAM</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRestParams</span><span class="o">().</span><span class="na">getMerchantCode</span><span class="o">()),</span> <span class="nc">RccErrorEnum</span><span class="o">.</span><span class="na">ERROR_MERCHANT_CODE_PARAM</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRestParams</span><span class="o">().</span><span class="na">getMerchantName</span><span class="o">()),</span> <span class="nc">RccErrorEnum</span><span class="o">.</span><span class="na">ERROR_MERCHANT_NAME_PARAM</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">isTrue</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNotBlank</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRestParams</span><span class="o">().</span><span class="na">getPeriod</span><span class="o">()),</span> <span class="nc">RccErrorEnum</span><span class="o">.</span><span class="na">ERROR_PERIOD_PARAM</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>自定义异常使用</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">String</span> <span class="nf">getPeriodEnd</span><span class="o">(</span><span class="nc">String</span> <span class="n">period</span><span class="o">){</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="nc">Date</span> <span class="n">dateStart</span> <span class="o">=</span> <span class="nc">DateUtil</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">period</span> <span class="o">+</span> <span class="s">"-01"</span><span class="o">,</span> <span class="s">"yyyy-MM-dd"</span><span class="o">).</span><span class="na">toJdkDate</span><span class="o">();</span>
    <span class="nc">DateTime</span> <span class="n">dateTime</span> <span class="o">=</span> <span class="nc">DateUtil</span><span class="o">.</span><span class="na">endOfMonth</span><span class="o">(</span><span class="n">dateStart</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">dateTime</span><span class="o">.</span><span class="na">toDateStr</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">LogFactory</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">error</span><span class="o">(</span><span class="s">"账期格式错误"</span><span class="o">,</span><span class="n">e</span><span class="o">);</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">BussinessException</span><span class="o">(</span><span class="nc">RccErrorEnum</span><span class="o">.</span><span class="na">ERROR_PERIOD_FORMAT</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>BussinessException的构造方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">BussinessException</span><span class="o">(</span><span class="nc">ErrorInterface</span> <span class="n">errorEnum</span><span class="o">,</span> <span class="nc">Object</span><span class="o">...</span> <span class="n">msgParam</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">this</span><span class="o">(</span><span class="n">errorEnum</span><span class="o">,</span> <span class="n">errorEnum</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="n">msgParam</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nf">BussinessException</span><span class="o">(</span><span class="nc">ErrorInterface</span> <span class="n">errorEnum</span><span class="o">,</span> <span class="nc">String</span> <span class="n">errorMsg</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">super</span><span class="o">(</span><span class="n">errorMsg</span><span class="o">);</span>
  <span class="k">this</span><span class="o">.</span><span class="na">printLog</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="k">this</span><span class="o">.</span><span class="na">rootCauseMsgList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
  <span class="k">this</span><span class="o">.</span><span class="na">errorCode</span> <span class="o">=</span> <span class="n">errorEnum</span><span class="o">.</span><span class="na">getMsgKey</span><span class="o">();</span>
  <span class="k">this</span><span class="o">.</span><span class="na">errorMsg</span> <span class="o">=</span> <span class="n">errorMsg</span><span class="o">;</span>
  <span class="k">this</span><span class="o">.</span><span class="na">appendRootCauseMsg</span><span class="o">(</span><span class="n">errorEnum</span><span class="o">,</span> <span class="n">errorMsg</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="2拦截登录">2、拦截登录</h2>

<p>在开发的过程把thymeleaf的页面缓存禁用，避免修改页面重启项目</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.thymeleaf.cache</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<p>修改了页面后，重新编译html页面</p>

<p><img src="/assets/images/2020/icoding/springboot/recomplile-html.jpg" alt="" /></p>

<p>登录方面，我整合了springSecurity框架，配置了除首页和登录页面放开，其他页面都要登录后才能访问</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
	<span class="c1">// 授权规则</span>
	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="c1">// htpp的方法基本分为4个类别：过滤器，登录注销规则，安全配置，OAuth2配置</span>
		<span class="c1">// 一般我们只配置规则即可</span>
		<span class="c1">// 首页允许所有人访问</span>
		<span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span><span class="s">"/toLogin"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
				<span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/level1/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"vip1"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/level2/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"vip2"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/level3/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"vip3"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/*"</span><span class="o">).</span><span class="na">authenticated</span><span class="o">();</span>

<span class="c1">//		表单登录用户和密码的默认参数名是username和password</span>
		<span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
				<span class="c1">//.defaultSuccessUrl("/dashboard") // 设置默认登录成功后跳转的页面</span>
				<span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">"/login"</span><span class="o">)</span> <span class="c1">// 登陆表单提交请求,默认的提交登录请求是/login(Post请求),认证失败默认会跳转到/login?error(Get请求)</span>
				<span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/toLogin"</span><span class="o">);</span> <span class="c1">// 默认的登录页请求是/login(Get请求)</span>

		<span class="c1">// 注销,默认开启的注销功能</span>
		<span class="n">http</span><span class="o">.</span><span class="na">logout</span><span class="o">().</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>    <span class="c1">// 注销成功跳转到首页</span>

		<span class="c1">// 自定义的登录页需要配置 rememberMe 的参数名,就可以绑定到我们前端的！</span>
		<span class="c1">// 记住我功能</span>
		<span class="n">http</span><span class="o">.</span><span class="na">rememberMe</span><span class="o">().</span><span class="na">rememberMeParameter</span><span class="o">(</span><span class="s">"remember"</span><span class="o">);</span>
	<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>拦截器实现</p>
</blockquote>

<p>没有整合安全框架，我们通过实现接口<code class="highlighter-rouge">HandlerInterceptor</code>的方式，去拦截登录，要用户登录了才能访问页面。</p>

<p>登录请求</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/user/login"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"username"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span>
                    <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"password"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span>
                    <span class="nc">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nc">HttpSession</span> <span class="n">session</span><span class="o">){</span>

  <span class="c1">// 真实的操作应该去数据库中获取数据</span>
  <span class="k">if</span> <span class="o">(!</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">"123456"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">password</span><span class="o">)){</span>
    <span class="c1">// 登录成功，放入Session</span>
    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">,</span><span class="n">username</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"LoginUser"</span><span class="o">));</span>
    <span class="k">return</span> <span class="s">"redirect:/main.html"</span><span class="o">;</span> <span class="c1">// 转发和重定向！</span>
  <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"msg"</span><span class="o">,</span> <span class="s">"用户名和密码输入错误"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"login"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>1、编写拦截器</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginInterceptor</span> <span class="kd">implements</span> <span class="nc">HandlerInterceptor</span> <span class="o">{</span>
  <span class="c1">// false  拦截</span>
  <span class="c1">// true 通过放行</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

    <span class="nc">String</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"=====LoginInterceptor====="</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span> <span class="c1">// 未登录，不放行，并且跳转到登录页！</span>
      <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"msg"</span><span class="o">,</span><span class="s">"未登录，请先登录！"</span><span class="o">);</span>
      <span class="c1">// response.sendRedirect("/") ; 重定向</span>
      <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/index.html"</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span> <span class="c1">// 转发</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
      <span class="c1">// 放行</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>2、注册拦截器</p>

<p>前面说过SpringBoot会对MVC自动配置，看官方文档知道，我们可以实现<code class="highlighter-rouge">WebMvcConfigurer</code>接口来添加自己的一些自定义配置，然后重写它的方法就可以了，如常用的静态资源映射、拦截、路由控制</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="c1">//@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMvcConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="nc">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 视图跳转的控制！</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/index"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/index.html"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/toLogin"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"login2"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// 注册拦截器</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="nc">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 拦截器需要放行第一次登录的请求，否则就用户为null 了</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoginInterceptor</span><span class="o">())</span>
      <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">"/**"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="s">"/index.html"</span><span class="o">,</span><span class="s">"/"</span><span class="o">,</span><span class="s">"index"</span><span class="o">,</span><span class="s">"/asserts/**"</span><span class="o">,</span><span class="s">"/toLogin"</span><span class="o">,</span><span class="s">"/user/login"</span><span class="o">);</span>
    <span class="c1">// 放开首页、登录页、登录请求的拦截</span>
  <span class="o">}</span>

  <span class="c1">// 注册我们的国际化组件</span>
  <span class="c1">// id localeResolver只能为这个，因为SpringBoot会去扫描并识别</span>
  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">LocaleResolver</span> <span class="nf">localeResolver</span><span class="o">(){</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MyLocaleResolver</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="3thymeleaf页面">3、Thymeleaf页面</h2>

<h3 id="员工列表">员工列表</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># restFul风格api请求</span>
/emp/get、post、delete、put
</code></pre></div></div>

<blockquote>
  <p>抽取公共部分</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 声明模版 --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span> 
	<span class="nt">&lt;html</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;body&gt;</span> 
      <span class="nt">&lt;div</span> <span class="na">th:fragment=</span><span class="s">"copy"</span><span class="nt">&gt;</span>
        <span class="ni">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery 				
      <span class="nt">&lt;/div&gt;</span> 
    <span class="nt">&lt;/body&gt;</span> 
<span class="nt">&lt;/html&gt;</span>

<span class="c">&lt;!-- 引用 --&gt;</span>
<span class="nt">&lt;body&gt;</span> ... 
  <span class="nt">&lt;div</span> <span class="na">th:insert=</span><span class="s">"~{footer :: copy}"</span><span class="nt">&gt;&lt;/div&gt;</span> 
<span class="nt">&lt;/body&gt;</span>
<span class="c">&lt;!-- 或者 --&gt;</span>
<span class="nt">&lt;body&gt;</span> ... 
  <span class="nt">&lt;div</span> <span class="na">th:insert=</span><span class="s">"footer :: copy"</span><span class="nt">&gt;&lt;/div&gt;</span> 
<span class="nt">&lt;/body&gt;</span>

<span class="c">&lt;!-- 区别 --&gt;</span>
<span class="nt">&lt;body&gt;</span> ... 
  <span class="nt">&lt;div</span> <span class="na">th:insert=</span><span class="s">"footer :: copy"</span><span class="nt">&gt;&lt;/div&gt;</span> 
  <span class="nt">&lt;div</span> <span class="na">th:replace=</span><span class="s">"footer :: copy"</span><span class="nt">&gt;&lt;/div&gt;</span> 
  <span class="nt">&lt;div</span> <span class="na">th:include=</span><span class="s">"footer :: copy"</span><span class="nt">&gt;&lt;/div&gt;</span> 
<span class="nt">&lt;/body&gt;</span>

<span class="c">&lt;!-- 比较结果 --&gt;</span>
<span class="nt">&lt;body&gt;</span> ... 
  <span class="nt">&lt;div&gt;</span> 
    <span class="nt">&lt;footer&gt;</span> <span class="ni">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery <span class="nt">&lt;/footer&gt;</span> 
  <span class="nt">&lt;/div&gt;</span> 
  
  <span class="nt">&lt;footer&gt;</span> <span class="ni">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery <span class="nt">&lt;/footer&gt;</span> 
  
  <span class="nt">&lt;div&gt;</span> <span class="ni">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery <span class="nt">&lt;/div&gt;</span> 
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>抽取头部与侧边栏公共部分bar.html，放到common目录下</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-th-fragment.jpg" alt="" /></p>

<p>前端页面复用模块</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-th-replace.jpg" alt="" /></p>

<p>传递参数：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">th:replace=</span><span class="s">"::frag (onevar=${value1},twovar=${value2})"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>遍历后端传递的数据</p>
</blockquote>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-striped table-sm"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>id<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>lastName<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>email<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>gender<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>department<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>birth<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>操作<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;tr</span> <span class="na">th:each=</span><span class="s">"emp:${employeeList}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${emp.id}"</span><span class="nt">&gt;&lt;/td&gt;</span>
      <span class="c">&lt;!--/* inline模式 */--&gt;</span>
      <span class="nt">&lt;td&gt;</span>[[${emp.lastName}]]<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${emp.email}"</span><span class="nt">&gt;&lt;/td&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${emp.gender == 0?'女':'男'}"</span><span class="nt">&gt;&lt;/td&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${emp.getEDepartment().departmentName}"</span><span class="nt">&gt;&lt;/td&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${#dates.format(emp.birth,'yyyy-MM-dd HH:mm')}"</span><span class="nt">&gt;&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>
        <span class="c">&lt;!--/* 编辑或者删除某个用户,这里是IDEA不识别，不是错误！*/--&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/employee/} + ${emp.id}"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary"</span><span class="nt">&gt;</span>编辑<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/employee/delete/} + ${emp.id}"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-danger"</span><span class="nt">&gt;</span>删除<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>

  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<p>最终效果</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-th-each.jpg" alt="" /></p>

<h3 id="添加员工">添加员工</h3>

<p>跳转到前端页面</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 跳转到员工新增页面</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/add"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">addEmployee</span><span class="o">(</span><span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
  <span class="c1">// 应该要携带部门的数据信息</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Department</span><span class="o">&gt;</span> <span class="n">departmentList</span> <span class="o">=</span> <span class="n">departmentMapper</span><span class="o">.</span><span class="na">listDepartment</span><span class="o">();</span>
  <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"departmentList"</span><span class="o">,</span><span class="n">departmentList</span><span class="o">);</span>
  <span class="k">return</span> <span class="s">"emp/add"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>前端页面</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/employee/add}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>LastName<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"lastName"</span> <span class="na">placeholder=</span><span class="s">"jacob"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"747463168@qq.com"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Gender<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-inline"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-check form-check-inline"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-check-input"</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">id=</span><span class="s">"gender1"</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-check-label"</span> <span class="na">for=</span><span class="s">"gender1"</span><span class="nt">&gt;</span>男<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-check form-check-inline"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-check-input"</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">id=</span><span class="s">"gender2"</span> <span class="na">value=</span><span class="s">"0"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-check-label"</span> <span class="na">for=</span><span class="s">"gender1"</span><span class="nt">&gt;</span>女<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Department<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"department"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">th:each=</span><span class="s">"department:${departmentList}"</span>
              <span class="na">th:text=</span><span class="s">"${department.departmentName}"</span>
              <span class="na">th:value=</span><span class="s">"${department.id}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Birth<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"birth"</span> <span class="na">placeholder=</span><span class="s">"2020/03/21"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>处理请求</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/save"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Employee</span> <span class="n">employee</span><span class="o">){</span>
  <span class="n">employeeMapper</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
  <span class="c1">// 添加完毕后应该返回首页，重定向url会变化，请求转发url不会变化</span>
  <span class="k">return</span> <span class="s">"redirect:/employee/list"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>注意：提交时间格式的问题！如果我们把日期字段birth改为 2020-03-21，提交后会报400错误</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-dateformat.jpg" alt="" /></p>

<p>后端Spring会拒绝该值</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-dateformat-2.jpg" alt="" /></p>

<p>我们打开<code class="highlighter-rouge">WebMvcAutoConfiguration</code>源码里它默认解析的时间日期格式是<code class="highlighter-rouge">yyyy/MM/dd</code>，所以我们要修改springmvc解析的日期格式</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 前端提交的日期格式问题，和前端提交的格式对应即可
</span><span class="py">spring.mvc.date-format</span><span class="p">=</span><span class="s">yyyy-MM-dd</span>
</code></pre></div></div>

<h3 id="修改员工">修改员工</h3>

<p>按钮</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;td&gt;</span>
  <span class="c">&lt;!--/* 编辑或者删除某个用户,这里是IDEA不识别，不是错误！*/--&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/employee/} + ${emp.id}"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-primary"</span><span class="nt">&gt;</span>编辑<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/employee/delete/} + ${emp.id}"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-danger"</span><span class="nt">&gt;</span>删除<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/td&gt;</span>
</code></pre></div></div>

<p>跳转到前端页面</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 跳转到员工修改页面</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">toUpdateEmp</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">,</span><span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
  <span class="c1">// 回显出用户的信息</span>
  <span class="nc">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employeeMapper</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"employee"</span><span class="o">,</span><span class="n">employee</span><span class="o">);</span>
  <span class="c1">// 应该要携带部门的数据信息</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">departmentMapper</span><span class="o">.</span><span class="na">listDepartment</span><span class="o">();</span>
  <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"departments"</span><span class="o">,</span> <span class="n">departments</span><span class="o">);</span>
  <span class="k">return</span> <span class="s">"emp/update"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>前端页面</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">th:action=</span><span class="s">"@{/employee/update}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">th:value=</span><span class="s">"${employee.id}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>LastName<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"lastName"</span> <span class="na">th:value=</span><span class="s">"${employee.lastName}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">th:value=</span><span class="s">"${employee.email}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Gender<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-inline"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-check form-check-inline"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-check-input"</span> <span class="na">th:checked=</span><span class="s">"${employee.gender==1}"</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">id=</span><span class="s">"gender1"</span> <span class="na">value=</span><span class="s">"1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-check-label"</span> <span class="na">for=</span><span class="s">"gender1"</span><span class="nt">&gt;</span>男<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-check form-check-inline"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-check-input"</span> <span class="na">th:checked=</span><span class="s">"${employee.gender==0}"</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"gender"</span> <span class="na">id=</span><span class="s">"gender2"</span> <span class="na">value=</span><span class="s">"0"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-check-label"</span> <span class="na">for=</span><span class="s">"gender1"</span><span class="nt">&gt;</span>女<span class="nt">&lt;/label&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Department<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"department"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">th:each=</span><span class="s">"department:${departmentList}"</span>
              <span class="na">th:text=</span><span class="s">"${department.departmentName}"</span>
              <span class="na">th:value=</span><span class="s">"${department.id}"</span>
              <span class="na">th:selected=</span><span class="s">"${employee.department == department.id}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>Birth<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"birth"</span> <span class="na">th:value=</span><span class="s">"${#dates.format(employee.birth,'yyyy-MM-dd HH:mm:ss')}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>修改<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-employee-1.jpg" alt="" /></p>

<p>返回前端的日期格式不对，我们需要转换一下，依然使用Thymeleaf的工具对象#dates进行格式化显示</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"birth"</span> <span class="na">th:value=</span><span class="s">"${#dates.format(employee.birth,'yyyy-MM-dd HH:mm:ss')}"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>处理请求</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 提交修改员工</span>
<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"update"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Employee</span> <span class="n">employee</span><span class="o">){</span>
  <span class="n">employeeMapper</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
  <span class="k">return</span> <span class="s">"redirect:/employee/list"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="删除员工">删除员工</h3>

<p>前端处理</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{/employee/delete/} + ${emp.id}"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-sm btn-danger"</span><span class="nt">&gt;</span>删除<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>处理请求</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 提交删除</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/delete/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
  <span class="n">employeeMapper</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="k">return</span> <span class="s">"redirect:/employee/list"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="基本的错误处理方式">基本的错误处理方式</h3>

<p>在template目录下建一个error文件夹，在里面放入对应的请求页面就可以了，</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-error.jpg" alt="" /></p>

<p>启动项目，随便访问一个连接，跳动404页面</p>

<p><img src="/assets/images/2020/icoding/springboot/thymeleaf-error-2.jpg" alt="" /></p>

<p>为什么错误会自动路由对应的页面？</p>

<p>错误处理的自动配置类<code class="highlighter-rouge">ErrorMvcAutoConfiguration</code>，里面注册了如下的bean</p>

<ul>
  <li>DefaultErrorAttributes</li>
  <li>BasicErrorController</li>
  <li>ErrorPageCustomizer</li>
  <li>DefaultErrorViewResolver</li>
</ul>

<p>如果系统一旦出现了404、500错误，就会被<code class="highlighter-rouge">ErrorPageCustomizer</code>进行处理，就会跳转到/error请求进行处理。</p>

<p>这个请求被<code class="highlighter-rouge">BasicErrorController</code>处理，如果是网页端请求就会返回页面，如果是api调用就会返回JSON数据。</p>

<p>点进BasicErrorController源码</p>

<p><img src="/assets/images/2020/icoding/springboot/basic-error-controller.jpg" alt="" /></p>

<h2 id="4快速扒前端">4、快速扒前端</h2>

<p>以艾编程官网为例，打开网站后，f12打开开发者模式</p>

<p><img src="/assets/images/2020/icoding/springboot/doc-elements.jpg" alt="" /></p>

<p>删除不必要的element元素，小技巧，删除后，网页不受影响的说明这个元素是不必要的，可以删除的。</p>

<p>第二步，删除完元素后，右键复制-&gt;内部HTML，新建一个html页面，粘贴内容</p>

<p>第三步，下载对应的css样式文件，修改link路径</p>

<p><img src="/assets/images/2020/icoding/springboot/web-demo-1.jpg" alt="" /></p>

<p>第四步，我们通过浏览器直接访问html页面</p>

<p><img src="/assets/images/2020/icoding/springboot/web-demo-2.jpg" alt="" /></p>

<p>页面样式，基本存在，只是缺少了图片，接下来下载，修改图片路径</p>

<p><img src="/assets/images/2020/icoding/springboot/web-demo-3.jpg" alt="" /></p>

<p>接下来就是对css样式的微调了，一个基本网站就是这么扒下来的</p>

<p>源码：<a href="https://gitee.com/jacobmj/study-demo/tree/master/jacob-single-app">https://gitee.com/jacobmj/study-demo/tree/master/jacob-single-app</a></p>


            <div>
   <!-- <p align="center">
     	  
         <img src="/assets/images/keeppuresmile.jpg" >
         <br/>
         微信扫描二维码，关注一个有故事的程序员
        

   </p>
   <p align="center" style="margin-top: 15px; font-size: 11px;color: #cc0000;">
       <strong>（转载本站文章请注明作者和出处 <a href="http://www.ityouknow.com">纯洁的微笑-ityouknow</a>）</strong>
   </p>
   <p align="center" style="margin-top: 15px; font-size: 16px;color: #337ab7;">
       <strong><a href="http://www.justdojava.com/" target="_blank">点击了解 ：Java 技术人的网站</a></strong>
   </p> -->
</div>

            <!-- Comments -->
            <div class="comment">
             

  

  
        <div id="gitalk-container"></div>
        <script src="/assets/js/gitalk.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
        <script>
        var gitalk = new Gitalk({
            id: '/icoding-edu/2020/03/21/icoding-note-011.html',
            clientID: '6cd8ad4d1cf1d1e6ad95',
            clientSecret: 'c4ce22a25efe50bfd60da67c990b534bc99a6424',
            repo: 'aikomj.github.io',
            owner: 'aikomj',
            admin: ['aikomj'],
            labels: ['gitalk'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


            </div>
        </div>

        <div class="col-md-3">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>
     <!--<div class="asb-post-01">-->
        <!--<div class="mask"></div>-->
            <!--<div class="info">-->
                <!--<div>扫码关注公众号：<span style="color: #E9405A; font-weight: bold;">纯洁的微笑</span></div>-->
            <!--<div>-->
            <!--<span>发送 </span><span class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span>-->
            <!--<div>-->
                <!--即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章-->
            <!--</div>-->
            <!--<img class="code-img" style="width: 300px;display:unset" src="/assets/images/keeppuresmile.jpg">-->
        <!--</div>-->
    <!--</div>-->
</article>

        </div>

    
<footer class="container">
    <div class="site-footer">
       <!--  <div class="site-footer-icons">
            <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
               知乎
            </a>
            <a target="_blank" href="http://weibo.com/ityouknow">
               微博
            </a>
            <a target="_blank" href="https://github.com/ityouknow">
                GitHub
            </a>
        </div> -->
        <!-- <div class="card text-center">
            <ul class="list-inline" style="margin-left: 0;">
               <li>
                <a target="_blank" href="https://github.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa  fa-stack-1x fa-inverse">知</i>
                  </span>
                </a>
              </li>
                  <li>
                <a target="_blank" href="https://weibo.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          </ul>
        </div> -->
        <div class="site-footer-links mobile-hidden">
            
        </div>
        <div class="scrolltop">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>
        <div class="rss">
            <a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a>
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>
    </div>
    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>
    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>
    
    
     <!-- Cnzz Analytics -->
       <div style="display:none">
         <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260945749'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260945749' type='text/javascript'%3E%3C/script%3E"));</script>
       </div>
     <!-- Cnzz Analytics -->
</footer>


    </body>

</html>
