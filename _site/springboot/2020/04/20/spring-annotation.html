<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.ico">

    <title> 40个Spring常用注解 - 大伟的博客 </title>
    <meta name="keywords" content="springboot">
    <meta name="description"
          content="链式编程注解，跨域注解，@Mapper和@Repository的区别，@PostConstruct服务启动后执行一些初始操作，本地事务管理，@Autowired与@Resource装配bean的两种方式，@Slf4打印日志注解，@RequestMapping的post、put、get、delete请求，@Aspect切面编程，@JsonFormat与前端对接日期格式化">

    <link rel="canonical" href="http://47.113.95.179/jk-blog/springboot/2020/04/20/spring-annotation.html">
    <link rel="alternate" type="application/rss+xml" title="大伟,专注Spring Boot,Spring Cloud,Docker,Java后端技术" href="http://47.113.95.179/jk-blog/feed.xml">

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bower_components/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="/bower_components/hover/css/hover-min.css">
    <link rel="stylesheet" href="/bower_components/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/gitalk.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->

    

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">-->

    <script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/lock.js"></script>
</head>


    <body>

    <header class="site-header">
    <div class="site-header-topbar">
        <div class="container">
            <div class="topbar-menu">
                
                <div class="item">
                    <a href="/archives.html"
                       target="_self"
                       title="Archives">
                        Archives
                    </a>
                </div>
                
                <div class="item">
                    <a href="/linux.html"
                       target="_self"
                       title="Linux">
                        Linux
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mysql.html"
                       target="_self"
                       title="Mysql">
                        Mysql
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mongodb.html"
                       target="_self"
                       title="MongoB">
                        MongoB
                    </a>
                </div>
                
                <div class="item">
                    <a href="/mq.html"
                       target="_self"
                       title="MQ">
                        MQ
                    </a>
                </div>
                
                <div class="item">
                    <a href="/fastdfs.html"
                       target="_self"
                       title="FastDFS">
                        FastDFS
                    </a>
                </div>
                
                <div class="item">
                    <a href="/redis.html"
                       target="_self"
                       title="Redis">
                        Redis
                    </a>
                </div>
                
                <div class="item">
                    <a href="/elasticsearch.html"
                       target="_self"
                       title="ES">
                        ES
                    </a>
                </div>
                
                <div class="item">
                    <a href="/docker.html"
                       target="_self"
                       title="Docker">
                        Docker
                    </a>
                </div>
                
                <div class="item">
                    <a href="/k8s.html"
                       target="_self"
                       title="K8s">
                        K8s
                    </a>
                </div>
                
                <div class="item">
                    <a href="/architect.html"
                       target="_self"
                       title="架构师">
                        架构师
                    </a>
                </div>
                
                <div class="item">
                    <a href="/gitee.html"
                       target="_self"
                       title="开源项目">
                        开源项目
                    </a>
                </div>
                
                <div class="item">
                    <a href="/tool.html"
                       target="_self"
                       title="工具">
                        工具
                    </a>
                </div>
                
                <div class="item">
                    <a href="/life.html"
                       target="_self"
                       title="生活">
                        生活
                    </a>
                </div>
                
                <div class="item">
                    <a href="/say.html"
                       target="_self"
                       title="说说">
                        说说
                    </a>
                </div>
                
                <div class="item">
                    <a href="/link.html"
                       target="_self"
                       title="友链">
                        友链
                    </a>
                </div>
                
            </div>
        </div>
    </div>
    <div class="container">
        <a id="site-header-brand" href="/" title="大展宏兔">
            <!--<span class="octicon octicon-mark-github"></span>-->
            <img class="logo" src="/assets/images/favicon.jpeg">
            大展宏兔
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/"
                   target=""
                   title="Home">
                    Home
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Icoding">
                    Icoding
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/icoding-edu.html" 
                           target="_self"
                     >飞天班笔记</a></li>
                    
                    <li><a href="/icoding-gavin.html" 
                           target="_self"
                     >黄埔班笔记</a></li>
                    
                    <li><a href="/icoding-allen.html" 
                           target="_self"
                     >源码分析</a></li>
                    
                    <li><a href="https://www.icodingedu.com/" 
                           target="_blank"
                     >艾编程官网</a></li>
                    
                    <li><a href="https://leetcode-cn.com/problemset/all/" 
                           target="_blank"
                     >力扣刷题</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Java">
                    Java
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/java-base.html" 
                           target="_self"
                     >Java基础</a></li>
                    
                    <li><a href="/java-concurrent.html" 
                           target="_self"
                     >Java并发</a></li>
                    
                    <li><a href="/design-mode.html" 
                           target="_self"
                     >设计模式</a></li>
                    
                    <li><a href="http://www.justdojava.com" 
                           target="_blank"
                     >Java 极客技术</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring.html"
                   target="_self"
                   title="Spring">
                    Spring
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-boot.html"
                   target="_self"
                   title="Spring Boot">
                    Spring Boot
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/spring-cloud.html"
                   target="_self"
                   title="Spring Cloud">
                    Spring Cloud
                </a>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href=""
                   target=""
                   title="Go全栈">
                    Go全栈
                </a>
                
                <ul class="submenu">
                    
                    <li><a href="/go-base.html" 
                           target="_self"
                     >Go语言基础</a></li>
                    
                    <li><a href="/go-web.html" 
                           target="_self"
                     >Web开发</a></li>
                    
                    <li><a href="/go-middleware.html" 
                           target="_self"
                     >中间件</a></li>
                    
                </ul>
                
            </div>
            
            <div class=" site-header-nav-item hvr-underline-from-center">
                <a href="/front.html"
                   target="_self"
                   title="大前端">
                    大前端
                </a>
                
            </div>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="40个Spring常用注解">
    <div class="container">
        <div id="jumbotron-meta-info">        
            <h1>40个Spring常用注解</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2020/04/20
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container noneed" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h2 id="1lombok的accessors支持链式编程">1、lombok的@Accessors支持链式编程</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.experimental.Accessors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="nd">@Accessors</span><span class="o">(</span><span class="n">chain</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Article</span>  <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">2330084508567540133L</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">author</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="2crossorigin-允许跨域">2、@CrossOrigin 允许跨域</h2>

<p>添加注解的方式</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@CrossOrigin</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringBootDataStudyXjwApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">SpringBootDataStudyXjwApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>添加配置类的方式</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CorsConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="nc">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/**"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="s">"*"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="s">"GET"</span><span class="o">,</span> <span class="s">"POST"</span><span class="o">,</span> <span class="s">"PUT"</span><span class="o">,</span> <span class="s">"DELETE"</span><span class="o">,</span> <span class="s">"OPTIONS"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="mi">3600</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>跨域的解决方案参考自己写的文章</p>

<h2 id="3mapper和repository的区别">3、@Mapper和@Repository的区别</h2>

<p>@Mapper和@Repository是常用的两个注解，<strong>两者都是用在dao上</strong>，两者功能差不多</p>

<blockquote>
  <p>区别</p>
</blockquote>

<ul>
  <li>
    <p>@Repository<font color="red">需要在Spring中配置扫描地址</font>，然后生成Dao层的Bean才能被注入到Service层中。</p>

    <p>在启动类中配置扫描地址：</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>   <span class="c1">//添加启动类注解</span>
<span class="nd">@MapperScan</span><span class="o">(</span><span class="s">"com.anson.dao"</span><span class="o">)</span>  <span class="c1">//配置mapper扫描地址</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">application</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span>   <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>@Mapper <font color="red">不需要配置扫描地址</font>，通过xml里面的namespace里面的接口地址，生成了Bean后注入到Service层中。</p>

    <p>结合Mybatis-Plus,在dao类只需加上@mapper注解就可以了。</p>
  </li>
</ul>

<h2 id="4postconstruct和predestroy修饰方法">4、@PostConstruct和@PreDestroy修饰方法</h2>

<p>值得注意的是，这两个注解不属于Spring,它们是源于JSR-250中的两个注解，位于common-annotations.jar中。@PostConstruct注解用于标注在Bean被Spring初始化之前需要执行的方法。@PreDestroy注解用于标注Bean被销毁前需要执行的方法。下面是具体的示例代码：</p>

<p><img src="/assets/images/2021/spring/annotation-postconstruct.jpg" alt="" /></p>

<p>从JDK5开始，servlet增加了两个影响生命周期的注解</p>

<ul>
  <li>
    <p><mark>@PostConstruct</mark></p>

    <p>被@PostConstruct修饰的方法会在服务器加载Servlet的时候运行，并且只会被服务器调用一次，类似于Servlet的init()方法。被@PostConstruct修饰的方法会在构造函数之后，init()方法之前运行。</p>
  </li>
  <li>
    <p><mark>@PreDestroy</mark></p>

    <p>被@PreDestroy修饰的方法会在服务器卸载Servlet的时候运行，并且只会被服务器调用一次，类似于Servlet的destroy()方法。被@PreDestroy修饰的方法会在destroy()方法之后运行，在Servlet被彻底卸载之前</p>
  </li>
</ul>

<blockquote>
  <p>项目经历</p>
</blockquote>

<p>renren-fast的框架就用到@PostConstruct注解在项目启动时加载定时任务，放在业务层实现类，代码如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
	 * 项目启动时，初始化定时器
	 */</span>
<span class="nd">@PostConstruct</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(){</span>
  <span class="c1">// 定时任务列表</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ScheduleJobEntity</span><span class="o">&gt;</span> <span class="n">scheduleJobList</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
  <span class="k">for</span><span class="o">(</span><span class="nc">ScheduleJobEntity</span> <span class="n">scheduleJob</span> <span class="o">:</span> <span class="n">scheduleJobList</span><span class="o">){</span>
    <span class="nc">CronTrigger</span> <span class="n">cronTrigger</span> <span class="o">=</span> <span class="nc">ScheduleUtils</span><span class="o">.</span><span class="na">getCronTrigger</span><span class="o">(</span><span class="n">scheduler</span><span class="o">,</span> <span class="n">scheduleJob</span><span class="o">.</span><span class="na">getJobId</span><span class="o">());</span>
    <span class="c1">//如果不存在，则创建</span>
    <span class="k">if</span><span class="o">(</span><span class="n">cronTrigger</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">ScheduleUtils</span><span class="o">.</span><span class="na">createScheduleJob</span><span class="o">(</span><span class="n">scheduler</span><span class="o">,</span> <span class="n">scheduleJob</span><span class="o">);</span>
    <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
      <span class="nc">ScheduleUtils</span><span class="o">.</span><span class="na">updateScheduleJob</span><span class="o">(</span><span class="n">scheduler</span><span class="o">,</span> <span class="n">scheduleJob</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>照猫画虎，我就在框架中加了分布式流水号的初始化</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span><span class="o">(</span><span class="s">"serialNumberService"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SerialNumberServiceImpl</span> <span class="kd">implements</span> <span class="nc">SerialNumberService</span> <span class="o">{</span>
	<span class="nd">@Autowired</span>
	<span class="nc">RedisUtils</span> <span class="n">redisUtils</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="nc">ProjectService</span> <span class="n">projectService</span><span class="o">;</span>

	<span class="nd">@Autowired</span>
	<span class="nc">EngineeringService</span> <span class="n">engineeringService</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">CURRENT_MAX_PROJECT_NO</span> <span class="o">=</span> <span class="s">"currentMaxProjectNo"</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">CURRENT_MAX_ENG_NO</span> <span class="o">=</span> <span class="s">"currentMaxEngNo"</span><span class="o">;</span>

	<span class="cm">/**
	 * 初始化项目的流水号
	 */</span>
	<span class="nd">@PostConstruct</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">initProjectNo</span><span class="o">(){</span>
		<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">projectService</span><span class="o">.</span><span class="na">getMap</span><span class="o">(</span><span class="k">new</span> <span class="nc">QueryWrapper</span><span class="o">&lt;</span><span class="nc">ProjectEntity</span><span class="o">&gt;().</span><span class="na">select</span><span class="o">(</span><span class="s">"max(project_no) maxProjectNo"</span><span class="o">));</span>
		<span class="k">if</span><span class="o">(</span><span class="n">map</span> <span class="o">==</span><span class="kc">null</span> <span class="o">||</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">,</span><span class="s">"P20190517000000"</span><span class="o">,</span><span class="nc">RedisUtils</span><span class="o">.</span><span class="na">NOT_EXPIRE</span><span class="o">);</span>
		<span class="o">}</span><span class="k">else</span><span class="o">{</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"maxProjectNo"</span><span class="o">).</span><span class="na">toString</span><span class="o">(),</span><span class="nc">RedisUtils</span><span class="o">.</span><span class="na">NOT_EXPIRE</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * 初始化工程的流水号
	 */</span>
	<span class="nd">@PostConstruct</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">initEngNo</span><span class="o">(){</span>
		<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">engineeringService</span><span class="o">.</span><span class="na">getMap</span><span class="o">(</span><span class="k">new</span> <span class="nc">QueryWrapper</span><span class="o">&lt;</span><span class="nc">EngineeringEntity</span><span class="o">&gt;().</span><span class="na">select</span><span class="o">(</span><span class="s">"max(eng_no) maxEngNo"</span><span class="o">));</span>
		<span class="k">if</span><span class="o">(</span><span class="n">map</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">,</span><span class="s">"E20190517000000"</span><span class="o">,</span><span class="nc">RedisUtils</span><span class="o">.</span><span class="na">NOT_EXPIRE</span><span class="o">);</span>
		<span class="o">}</span><span class="k">else</span><span class="o">{</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"maxEngNo"</span><span class="o">).</span><span class="na">toString</span><span class="o">(),</span><span class="nc">RedisUtils</span><span class="o">.</span><span class="na">NOT_EXPIRE</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * @Description 采用synchronized+redis分布式锁 形式共同完成
	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kd">synchronized</span> <span class="nc">String</span> <span class="nf">getProjectNo</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">newMaxValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">redisUtils</span><span class="o">.</span><span class="na">lock</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">)){</span>
			<span class="c1">// 1.获取当前最大项目编号</span>
			<span class="nc">String</span> <span class="n">currentMaxValue</span> <span class="o">=</span> <span class="n">redisUtils</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">currentMaxValue</span><span class="o">)){</span>
				<span class="c1">// 重新初始化</span>
				<span class="n">initProjectNo</span><span class="o">();</span>
				<span class="n">currentMaxValue</span> <span class="o">=</span> <span class="n">redisUtils</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">);</span>
			<span class="o">}</span>

			<span class="c1">// 2.最大值加1，格式 P+yyyyMMdd+6位数字</span>
			<span class="kt">int</span> <span class="n">currentMaxNum</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">currentMaxValue</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">9</span><span class="o">));</span>
			<span class="n">newMaxValue</span> <span class="o">=</span> <span class="s">"P"</span><span class="o">+</span> <span class="nc">DateUtils</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">(),</span><span class="s">"yyyyMMdd"</span><span class="o">)</span> <span class="o">+</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%06d"</span><span class="o">,</span><span class="n">currentMaxNum</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>

			<span class="c1">// 3.新的最大值保存到redis缓存</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">,</span><span class="n">newMaxValue</span><span class="o">,</span><span class="nc">RedisUtils</span><span class="o">.</span><span class="na">NOT_EXPIRE</span><span class="o">);</span>

			<span class="c1">// 4.释放锁</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">unlock</span><span class="o">(</span><span class="no">CURRENT_MAX_PROJECT_NO</span><span class="o">);</span>

		<span class="o">}</span>
		<span class="k">if</span><span class="o">(</span><span class="n">newMaxValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RRException</span><span class="o">(</span><span class="s">"获取项目编号失败"</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">STATUS_FAIL</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">newMaxValue</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kd">synchronized</span> <span class="nc">String</span> <span class="nf">getEngNo</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">newMaxValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">redisUtils</span><span class="o">.</span><span class="na">lock</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">)){</span>
			<span class="c1">// 1.获取当前最大工程编号</span>
			<span class="nc">String</span> <span class="n">currentMaxValue</span> <span class="o">=</span> <span class="n">redisUtils</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">currentMaxValue</span><span class="o">)){</span>
				<span class="c1">// 重新初始化</span>
				<span class="n">initEngNo</span><span class="o">();</span>
				<span class="n">currentMaxValue</span> <span class="o">=</span> <span class="n">redisUtils</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">);</span>
			<span class="o">}</span>

			<span class="c1">// 2.最大值加1，格式E+yyyyMMdd+6位数字</span>
			<span class="kt">int</span> <span class="n">currentMaxNum</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">currentMaxValue</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">9</span><span class="o">));</span>
			<span class="n">newMaxValue</span> <span class="o">=</span> <span class="s">"E"</span><span class="o">+</span> <span class="nc">DateUtils</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">(),</span><span class="s">"yyyyMMdd"</span><span class="o">)</span> <span class="o">+</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%06d"</span><span class="o">,</span><span class="n">currentMaxNum</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>

			<span class="c1">// 3.新的最大值保存到redis缓存</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">,</span><span class="n">newMaxValue</span><span class="o">,</span><span class="nc">RedisUtils</span><span class="o">.</span><span class="na">NOT_EXPIRE</span><span class="o">);</span>

			<span class="c1">// 4.释放锁</span>
			<span class="n">redisUtils</span><span class="o">.</span><span class="na">unlock</span><span class="o">(</span><span class="no">CURRENT_MAX_ENG_NO</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span><span class="o">(</span><span class="n">newMaxValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nf">RRException</span><span class="o">(</span><span class="s">"获取工程编号失败"</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">STATUS_FAIL</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">newMaxValue</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h2 id="5transcactional本地事务">5、@Transcactional本地事务</h2>

<p>Spring 使用 @Transcactional注解管理事务，我们一起来看看它的源码：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Inherited</span>
<span class="nd">@Documented</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Transactional</span> <span class="o">{</span>
  <span class="nd">@AliasFor</span><span class="o">(</span><span class="s">"transactionManager"</span><span class="o">)</span>
  <span class="nc">String</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>

  <span class="nd">@AliasFor</span><span class="o">(</span><span class="s">"value"</span><span class="o">)</span>
  <span class="nc">String</span> <span class="nf">transactionManager</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>

  <span class="c1">// 事务传播</span>
  <span class="nc">Propagation</span> <span class="nf">propagation</span><span class="o">()</span> <span class="k">default</span> <span class="nc">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">;</span>

  <span class="c1">// 隔离</span>
  <span class="nc">Isolation</span> <span class="nf">isolation</span><span class="o">()</span> <span class="k">default</span> <span class="nc">Isolation</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">;</span>

  <span class="c1">// 事务的超时时间，设置事务在强制回滚之前可以占用的时间，默认为-1，不超时，单位为s（测试为单位s）</span>
  <span class="kt">int</span> <span class="nf">timeout</span><span class="o">()</span> <span class="k">default</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>

  <span class="cm">/* 
  true: 只读，只能对数据库进行读取操作，不能有修改的操作，如果需要确保当前事务只有读取操作，就有必要设置为只读，可以帮助数据库，	引擎优化事务；
  false: 非只读，不仅会读取数据还会有修改操作*/</span>
  <span class="kt">boolean</span> <span class="nf">readOnly</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>

  <span class="c1">// 剩下的四个属性：事务的回滚与不回滚   默认情况下， Spring会对所有的运行时异常进行事务回滚，指定异常的类名，或者类型</span>
  <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Throwable</span><span class="o">&gt;[]</span> <span class="nf">rollbackFor</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>

  <span class="nc">String</span><span class="o">[]</span> <span class="nf">rollbackForClassName</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>

  <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Throwable</span><span class="o">&gt;[]</span> <span class="nf">noRollbackFor</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>

  <span class="nc">String</span><span class="o">[]</span> <span class="nf">noRollbackForClassName</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
<span class="o">}</span>
</code></pre></div></div>

<p>1、propagation 属性如何处理事务，点进Propagation的源码</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Propagation</span> <span class="o">{</span>
  <span class="cm">/**支持当前事务，如果当前没有事务，就新建一个事务。这是最常见的选择，也是 Spring 默认的事务的传播。*/</span>
  <span class="no">REQUIRED</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_REQUIRED</span><span class="o">),</span>
  
  <span class="cm">/**支持当前事务，如果当前没有事务，就以非事务方式执行*/</span>
  <span class="no">SUPPORTS</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_SUPPORTS</span><span class="o">),</span>
  
  <span class="cm">/**支持当前事务，如果当前没有事务，就抛出异常*/</span>
  <span class="no">MANDATORY</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_MANDATORY</span><span class="o">),</span>
  
  <span class="cm">/**新建事务，如果当前存在事务，把当前事务挂起*/</span>
  <span class="no">REQUIRES_NEW</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_REQUIRES_NEW</span><span class="o">),</span>
  
  <span class="cm">/**-以非事务方式执行操作，如果当前存在事务，就把当前事务挂起*/</span>
  <span class="no">NOT_SUPPORTED</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_NOT_SUPPORTED</span><span class="o">),</span>
  
  <span class="cm">/**以非事务方式执行，如果当前存在事务，则抛出异常*/</span>
  <span class="no">NEVER</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_NEVER</span><span class="o">),</span>
  
  <span class="cm">/**如果一个活动的事务存在，则运行在一个嵌套的事务中。如果没有活动事务，则按REQUIRED属性执行。
     * 它使用了一个单独的事务，这个事务拥有多个可以回滚的保存点。
     * 内部事务的回滚不会对外部事务造成影响。
     * 它只对DataSourceTransactionManager事务管理器起效
    */</span>
  <span class="no">NESTED</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">PROPAGATION_NESTED</span><span class="o">);</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">value</span><span class="o">;</span>

  <span class="nc">Propagation</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>2、isolation 属性，事务的隔离级别，点进Isolation的源码</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Isolation</span> <span class="o">{</span>
 
	<span class="cm">/**数据库的默认级别*/</span>
	<span class="no">DEFAULT</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">ISOLATION_DEFAULT</span><span class="o">),</span>
 
	<span class="cm">/**读未提交      脏读*/</span>
	<span class="no">READ_UNCOMMITTED</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">ISOLATION_READ_UNCOMMITTED</span><span class="o">),</span>
 
	<span class="cm">/**读已提交  不可重复读（update）*/</span>
	<span class="no">READ_COMMITTED</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">ISOLATION_READ_COMMITTED</span><span class="o">),</span>
 
	<span class="cm">/**可重复读      幻读（插入操作）*/</span>
	<span class="no">REPEATABLE_READ</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">ISOLATION_REPEATABLE_READ</span><span class="o">),</span>
 
	<span class="cm">/** 串行化         效率低*/</span>
	<span class="no">SERIALIZABLE</span><span class="o">(</span><span class="nc">TransactionDefinition</span><span class="o">.</span><span class="na">ISOLATION_SERIALIZABLE</span><span class="o">);</span>
 
	<span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">value</span><span class="o">;</span>
 
	<span class="nc">Isolation</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
 
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">value</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">;</span> <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Spring Boot 使用注解 @EnableTransactionManagement 开启事务支持后，然后在访问数据库的Service方法上添加注解 @Transactional 便可， @Transactional放在Service类上，代表每一方法都是一个事务。例如使用mybatis，在mybatis的配置类上添加@EnableTransactionManagement注解</p>

<p><img src="/assets/images/2020/annotation/enable-transaction-management.gif" alt="" /></p>

<p><img src="/assets/images/2020/annotation/transaction-on-service.gif" alt="" /></p>

<blockquote>
  <p>事务失效</p>
</blockquote>

<p>1、只在public方法上生效</p>

<p>2、数据库引擎本身不支持事务，比如说MySQL数据库中的<strong>myisam</strong>，本身就不支持事务</p>

<p>3、Spring只会对<strong>unchecked</strong>异常进行事务回滚；如果是<strong>checked</strong>异常则不回滚</p>

<ul>
  <li>unchecked异常：派生于Error或者RuntimeException的异常</li>
  <li>checked异常：所有其他的异常</li>
</ul>

<p>编程式事务：<a href="/springboot/2021/02/24/spring-skill-002.html">/springboot/2021/02/24/spring-skill-002.html</a></p>

<blockquote>
  <p>@EnableTransactionManagement 源码分析</p>
</blockquote>

<p>@Transactional是如何选择事务控制器的，还有编程式事务TransactionTemplate是如何获取事务控制器，为什么多数据源的情况下需要指定事务控制器，否则spring事务失效</p>

<h2 id="6autowired与resource的区别">6、@Autowired与@Resource的区别</h2>

<p>如UserService、UserService2是UserService的两个实现类</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span><span class="o">(</span><span class="s">"userService1"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span>  <span class="kd">implements</span> <span class="nc">UserService</span> <span class="o">{}</span>

<span class="nd">@Service</span><span class="o">(</span><span class="s">"userService2"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService2</span> <span class="kd">implements</span> <span class="nc">UserService</span> <span class="o">{}</span>
</code></pre></div></div>

<p>spring的@Service注解默认会将类名的第一个字母转换成小写，作为bean的名称，如上面的<code class="highlighter-rouge">userService</code>，当然我们也可以自定义bean名称，就像上面的写法</p>

<p>那么在方法中使用接口UserService，使用@Autowired来标注时，需要加上@Qualifier区分注入具体的实现类。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"userService2"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">IuserService</span> <span class="n">userService</span><span class="o">;</span>

<span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"loginService"</span><span class="o">)</span> 
<span class="kd">private</span> <span class="nc">LoginService</span> <span class="n">loginService</span><span class="o">;</span>

<span class="nd">@Autowired</span><span class="o">(</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"loginService"</span><span class="o">)</span> 
<span class="kd">private</span> <span class="nc">LoginService</span> <span class="n">loginService</span><span class="o">;</span>
</code></pre></div></div>

<ol>
  <li>
    <p>@Autowired 与@Resource都可以用来装配bean，写在字段上或者setter方法上;</p>
  </li>
  <li>
    <font color="red">@Autowired 默认按类型装配</font>
    <p>，就是bytype方式</p>

    <p>默认情况下依赖对象必须存在，如果要允许null值，可以设置它的required属性为false，就不会自动装配了</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span><span class="o">(</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <font color="red">@Resource(这个注解属于J2EE的)默认按名称装配</font>

    <p>通过name属性指定，如果没有指定name属性，就字段名装配；如果注解写在setter方法上，默认按属性名进行装配，当找不到匹配的bean时才按照类型进行装配。注意：如果name属性一旦指定，就只会按照名称进行装配。</p>
  </li>
</ol>

<p>下面展开@Autowired深入说明</p>

<blockquote>
  <p>@Qualifier</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestService1</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestService2</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">TestService1</span> <span class="n">testService1</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"test1"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">TestService1</span> <span class="nf">test1</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TestService1</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"test2"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">TestService1</span> <span class="nf">test2</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TestService1</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>启动会报错</p>

<p><img src="/assets/images/2021/spring/autowired-two-beans.jpg" alt="" /></p>

<p>提示testService1是单例的，根据类型匹配找到两个对象，需要加上@Qualifier区分注入具体的实现类,相当于byName的方式，Qualifier意思是合格者，一般跟Autowired配合使用，需要指定一个bean的名称，通过bean名称就能找到需要装配的bean。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"test1"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">TestService1</span> <span class="n">testService1</span><span class="o">;</span>
</code></pre></div></div>

<blockquote>
  <p>@Primary</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUser</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">say</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User1</span> <span class="kd">implements</span> <span class="nc">IUser</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">say</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User2</span> <span class="kd">implements</span> <span class="nc">IUser</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">say</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>启动同样因为找到两个同类型的bean对象报错，可以加<code class="highlighter-rouge">@Primary</code>注解解决</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Primary</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User1</span> <span class="kd">implements</span> <span class="nc">IUser</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">say</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>当我们使用自动配置的方式装配Bean时，如果这个Bean有多个候选者，假如其中一个候选者具有@Primary注解修饰，该候选者会被选中，作为自动配置的值。</p>

<blockquote>
  <p>@Autowired的使用范围</p>
</blockquote>

<p>看源码</p>

<p><img src="/assets/images/2021/spring/autowired-source.png" alt="" /></p>

<p>看元注解<code class="highlighter-rouge">@Target</code>我们知道autowired的作用范围</p>

<p><img src="/assets/images/2021/spring/autowired-target.jpg" alt="" /></p>

<p>下面逐一说明</p>

<ul>
  <li>
    <p><strong>成员变量</strong></p>

    <p>这种方式我们平时用的最多</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>构造器</strong></p>

    <p>在构造器上使用Autowired注解：</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
  
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">UserService</span><span class="o">(</span><span class="nc">IUser</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"user:"</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>其实是自动装配了IUser类的bean对象</p>
  </li>
  <li>
    <p><strong>方法</strong></p>

    <p>在普通方法上加Autowired注解：</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">IUser</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">user</span><span class="o">.</span><span class="na">say</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>spring会在项目启动的过程中，自动调用一次加了@Autowired注解的方法，我们可以在该方法做一些初始化的工作。</p>
  </li>
  <li>
    <p><strong>参数</strong></p>

    <p>可以在构造器的入参上加Autowired注解</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
  
    <span class="kd">public</span> <span class="nf">UserService</span><span class="o">(</span><span class="nd">@Autowired</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"user:"</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
  
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nd">@Autowired</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">user</span><span class="o">.</span><span class="na">say</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p>@Autowired的高端玩法</p>
</blockquote>

<p>将UserService方法调整一下，用一个List集合接收IUser类型的参数：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">IUser</span><span class="o">&gt;</span> <span class="n">userList</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">IUser</span><span class="o">&gt;</span> <span class="n">userSet</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">IUser</span><span class="o">&gt;</span> <span class="n">userMap</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"userList:"</span> <span class="o">+</span> <span class="n">userList</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"userSet:"</span> <span class="o">+</span> <span class="n">userSet</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"userMap:"</span> <span class="o">+</span> <span class="n">userMap</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>增加一个controller</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/u"</span><span class="o">)</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/test"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">test</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/assets/images/2021/spring/autowired-more-beans.jpg" alt="" /></p>

<p>从上图中看出：userList、userSet和userMap都打印出了两个元素，说明@Autowired会自动把相同类型的IUser对象收集到集合中。</p>

<blockquote>
  <p>@Autowired自动装配失败</p>
</blockquote>

<ul>
  <li>
    <p><strong>没有加@Service注解</strong></p>

    <p>在类上面忘了加@Controller、@Service、@Component、@Repository等注解，spring就无法完成自动装配的功能，例如</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">user</span><span class="o">.</span><span class="na">say</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>注入Filter或Listener</strong></p>

    <p>web应用启动的顺序是：<code class="highlighter-rouge">listener</code>-&gt;<code class="highlighter-rouge">filter</code>-&gt;<code class="highlighter-rouge">servlet</code></p>

    <p>接下来，看看这个案例</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="n">user</span><span class="o">.</span><span class="na">say</span><span class="o">();</span>
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
  
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">FilterRegistrationBean</span> <span class="nf">filterRegistrationBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">FilterRegistrationBean</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilterRegistrationBean</span><span class="o">();</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="nc">UserFilter</span><span class="o">());</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">"/*"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>程序启动会报错：</p>

    <p><img src="/assets/images/2021/spring/autowired-error.jpg" alt="" /></p>

    <p>tomcat无法正常启动。</p>

    <p>什么原因呢？</p>

    <p>众所周知，springmvc的启动是在DisptachServlet里面做的，而它是在listener和filter之后执行。如果我们想在listener和filter里面@Autowired某个bean，肯定是不行的，因为filter初始化的时候，此时bean还没有初始化，无法自动装配。</p>

    <p>如果工作当中真的需要这样做，我们该如何解决这个问题呢？</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserFilter</span>  <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">IUser</span> <span class="n">user</span><span class="o">;</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">ApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="nc">WebApplicationContextUtils</span><span class="o">.</span><span class="na">getWebApplicationContext</span><span class="o">(</span><span class="n">filterConfig</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">());</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="o">((</span><span class="nc">IUser</span><span class="o">)(</span><span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"user1"</span><span class="o">)));</span>
        <span class="n">user</span><span class="o">.</span><span class="na">say</span><span class="o">();</span>
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
  
    <span class="o">}</span>
  
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>答案是使用WebApplicationContextUtils.getWebApplicationContext获取当前的ApplicationContext，再通过它获取到bean实例。</p>
  </li>
  <li>
    <p><strong>注解未被@ComponentScan扫描</strong></p>

    <p>通常情况下，@Controller、@Service、@Component、@Repository、@Configuration等注解，是需要通过@ComponentScan注解扫描，收集元数据的。</p>

    <p>但是，如果没有加@ComponentScan注解，或者@ComponentScan注解扫描的路径不对，或者路径范围太小，会导致有些注解无法收集，到后面无法使用@Autowired完成自动装配的功能。</p>

    <p>有个好消息是，在springboot项目中，如果使用了<code class="highlighter-rouge">@SpringBootApplication</code>注解，它里面内置了@ComponentScan注解的功能，启动类会默认扫描同package及子package的路径，自动装配的功能</p>
  </li>
  <li>
    <p><strong>循环依赖问题</strong></p>

    <p>spring的bean默认是单例的，如果单例bean使用@Autowired装配，大多数情况，能解决循环依赖问题。</p>
  </li>
</ul>

<blockquote>
  <p>@Autowired和@Resource的区别</p>
</blockquote>

<p>@Autowired功能虽说非常强大，但是也有些不足之处。比如：比如它跟spring强耦合了，如果换成了JFinal等其他框架，功能就会失效。而@Resource是JSR-250提供的，它是Java标准，绝大部分框架都支持。有些场景使用@Autowired无法满足的要求，改成@Resource却能解决问题。</p>

<ul>
  <li>@Autowired默认按byType自动装配，而@Resource默认byName自动装配。</li>
  <li>@Autowired只包含一个参数：required，表示是否开启自动准入，默认是true。而@Resource包含七个参数，其中最重要的两个参数是：name 和 type。</li>
  <li>@Autowired如果要使用byName，需要使用@Qualifier一起配合。而@Resource如果指定了name，则用byName自动装配，如果指定了type，则用byType自动装配。</li>
  <li>@Autowired能够用在：构造器、方法、参数、成员变量和注解上，而@Resource能用在：类、成员变量和方法上。</li>
  <li>@Autowired是spring定义的注解，而@Resource是JSR-250定义的注解。</li>
</ul>

<p>他们的装配顺序不同</p>

<p><strong>@Autowired的装配顺序如下</strong></p>

<p><img src="/assets/images/2021/spring/autowired-works-2.jpg" alt="" /></p>

<p><strong>@Resource的装配顺序如下</strong></p>

<ol>
  <li>
    <p>如果同时指定了name和type：</p>

    <p><img src="/assets/images/2021/spring/resource-autowired-1.jpg" alt="" /></p>
  </li>
  <li>
    <p>如果指定了name：</p>

    <p><img src="/assets/images/2021/spring/resource-autowired-2.jpg" alt="" /></p>
  </li>
  <li>
    <p>如果指定了type：</p>

    <p><img src="/assets/images/2021/spring/resource-autowired-3.jpg" alt="" /></p>
  </li>
  <li>
    <p>如果既没有指定name，也没有指定type</p>

    <p><img src="/assets/images/2021/spring/resource-autowired-4.jpg" alt="" /></p>
  </li>
</ol>

<p>@Autowired<strong>是</strong>Spring<strong>提供的，它是</strong>特定IoC提供的特定注解<strong>，这就导致了应用与框架的</strong>强绑定<strong>，一旦换用了其他的IoC框架，是</strong>不能够支持注入的。</p>

<p>而 <strong>@Resource</strong>是<strong>JSR-250</strong>提供的，它是<strong>Java标准</strong>，我们使用的IoC容器应当去兼容它，这样即使更换容器，也可以正常工作。</p>

<p>基于这个原因，我们推荐使用@Resource注解，不使用@Autowired注解</p>

<h2 id="7slf4j">7、@Slf4j</h2>

<p>这个是lombok的扩展注解，import lombok.extern.slf4j.Slf4j;</p>

<p>如果每次不想写上</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span>  <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="err">当前类名</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>可以用注解@Slf4j 来打印日志。</p>

<p>1、首先idea需要安装lombok插件</p>

<p>2、你的springboot项目引入依赖</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>  可选依赖，如果间接依赖要显示声明该依赖
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>3、在任意类上添加注解@Slf4j，就可以在本类中任意方法内打印日志了</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Slf4j</span>
<span class="nd">@RestController</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/test"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/testPrint"</span><span class="o">,</span><span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">testPrint</span><span class="o">(){</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"可以直接调用log打印日志了"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"testPrint"</span><span class="o">;</span>
    <span class="o">}</span>   
<span class="o">}</span>
</code></pre></div></div>

<h2 id="8requestmapping的4大请求方法">8、@RequestMapping的4大请求方法</h2>

<p>@RequestMapping注解的主要用途是将Web请求与请求处理类中的方法进行映射，有以下的六个配置属性</p>

<ul>
  <li>value:映射的请求URL或者其别名</li>
  <li>method:兼容HTTP的方法名</li>
  <li>params:根据HTTP参数的存在、缺省或值对请求进行过滤</li>
  <li>header:根据HTTP Header的存在、缺省或值对请求进行过滤</li>
  <li>consume:设定在HTTP请求正文中允许使用的媒体类型</li>
  <li>product:在HTTP响应体中允许使用的媒体类型</li>
</ul>

<p>提示：在使用@RequestMapping之前，请求处理类还需要使用@Controller或@RestController进行标记</p>

<p><img src="/assets/images/2021/spring/annotation-requestmapping.jpg" alt="" /></p>

<p><strong>@RequestBody</strong></p>

<p>@RequestBody在处理请求方法的参数列表中使用，它可以将请求主体中的参数绑定到一个对象中，请求主体参数是通过<strong>HttpMessageConverter</strong>传递的，根据请求主体中的参数名与对象的属性名进行匹配并绑定值。此外，还可以通过<mark>@Valid注解对请求主体中的参数进行校验</mark>。下面是一个使用@RequestBody的示例</p>

<p><img src="/assets/images/2021/spring/annotation-requestbody.jpg" alt="" /></p>

<p>相当于其它4大请求注解：</p>

<ul>
  <li><strong>@GetMapping</strong> = @RequestMapping(method = RequestMethod.GET)</li>
  <li><strong>@PostMapping</strong> = @RequestMapping(method = RequestMethod.POST)</li>
  <li><strong>@PutMapping</strong> = @RequestMapping(method = RequestMethod.PUT)</li>
  <li><strong>@DeleteMapping</strong> = @RequestMapping(method = RequestMethod.DELETE)</li>
</ul>

<blockquote>
  <p>区别</p>
</blockquote>

<ol>
  <li>
    <p>语义上的不同，Get 是获取数据，把参数放在url中，Post 是提交数据，把参数放在request body中，所以Get就会暴露参数，相对不安全，而且url 传送参数长度是有限制的；</p>
  </li>
  <li>
    <p>Get 在浏览器回退时是无害的，Post 会再次提交请求，会造成重复提交；</p>
  </li>
  <li>
    <p>Get 的url地址可以被浏览器历史记录记住，Post 不会；</p>
  </li>
  <li>
    <p>Get 请求会被浏览器主动cache，而Post 不会，除非手动设置；</p>
  </li>
  <li>
    <p>Put 更新单个对象数据</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ApiOperation</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"根据id更新章节"</span><span class="o">)</span>
<span class="nd">@PutMapping</span><span class="o">(</span><span class="s">"{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="no">R</span> <span class="nf">updateById</span><span class="o">(</span><span class="nd">@ApiParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"章节id"</span><span class="o">,</span><span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">id</span><span class="o">,</span>
                    <span class="nd">@ApiParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"chapter"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"章节对象"</span><span class="o">,</span><span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="nd">@RequestBody</span> <span class="nc">Chapter</span> <span class="n">chapter</span><span class="o">){</span>
  <span class="n">chapterService</span><span class="o">.</span><span class="na">updateById</span><span class="o">(</span><span class="n">chapter</span><span class="o">);</span>
  <span class="k">return</span> <span class="no">R</span><span class="o">.</span><span class="na">ok</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>Put与Post 都是向服务端发送数据，区别在于Post主要作用一个集合资源上(url)，而Put主要作用在一个具体资源上(url/xxx)，如果URL可以在客户端确定，那么可使用PUT，否则用POST</p>
  </li>
  <li>
    <p>Delete 请求顾名思义，就是用来删除某一个资源的，该请求就像数据库的delete操作。</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ApiOperation</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"根据id删除章节"</span><span class="o">)</span>
<span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">"{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="no">R</span> <span class="nf">removeById</span><span class="o">(</span><span class="nd">@ApiParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"章节id"</span><span class="o">,</span><span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">id</span><span class="o">){</span>
  <span class="n">chapterService</span><span class="o">.</span><span class="na">removeChapterById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
  <span class="k">return</span> <span class="no">R</span><span class="o">.</span><span class="na">ok</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<p><strong>@PatchMapping</strong></p>

<p>@PatchMapping注解用于处理HTTP PATCH请求，并将请求映射到对应的处理方法中。@PatchMapping相当于是@RequestMapping(method=HttpMethod.PATCH)的快捷方式。下面是一个简单的示例：</p>

<p><img src="/assets/images/2021/spring/annotation-patchmapping.jpg" alt="" /></p>

<blockquote>
  <p>总结</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST    /url      创建  
DELETE  /url/<span class="o">{</span><span class="nb">id</span><span class="o">}</span>  删除  
PUT     /url/<span class="o">{</span><span class="nb">id</span><span class="o">}</span>  更新
GET     /url/<span class="o">{</span>courseId<span class="o">}</span>  查看
GET     /url/<span class="o">{</span>page<span class="o">}</span>/<span class="o">{</span>limit<span class="o">}</span>  查看
</code></pre></div></div>

<p>说到请求，就提一下请求时的contentType的值（提交数据的方式）</p>

<ul>
  <li>
    <p>application/x-www-form-urlencoded</p>

    <p>原生浏览器的form表单提交方式，默认的方式，键值对，action为get时会把参数拼接到url上，action为post时会把参数放入request body中，</p>
  </li>
  <li>
    <p>multipart/form-data</p>

    <p>使用表单上传文件时，必须设置form元素的enctyped 属性为该值。</p>

    <p>前端接口上传文件的时候，通常会将请求header的content-type设置为:multipart/form-data, 或者form表单提交的时候将enctype设置为”multipart/form-data” 。</p>
  </li>
  <li>
    <p>application/json</p>

    <p>主流的json字符串提交方式，数据对象放入request body中，jquery时代的ajax和vue时代的axios异步一般都会使用该方式提交数据</p>
  </li>
</ul>

<h2 id="9aspect-切面编程">9、@Aspect 切面编程</h2>

<p>spring简化开发的4大核心思想：</p>

<ol>
  <li>Spring Bean，生命周期由spring 容器管理的ava对象</li>
  <li>IOC，控制反转的思想，所有的对象都去Spring容器getbean</li>
  <li>AOP，切面编程降低侵入。</li>
  <li>xxxTemplate模版技术，如RestTemplate,RedisTemplate</li>
</ol>

<p>AOP是Spring框架面向切面的编程思想，它将涉及多业务流程的<strong>通用功能抽取</strong>并单独封装，形成独立的切面，在合适的时机将这些切面横向切入到业务流程指定的位置中，从而让业务层只关注业务本身，降低程序的耦合度，是函数式编程的一种衍生。</p>

<p>通用功能：非业务逻辑功能，如日志记录（renren-fast有实现），权限验证（renren-fast有实现），事务处理，异常处理等</p>

<p><img src="\assets\images\2020\java\spring-aop.png" alt="" /></p>

<p>具体看我的另外一篇文章：<a href="/java/2020/11/27/spring-aop.html">Spring AOP 切面编程</a></p>

<h2 id="10jsonformat-日期格式化">10、@JsonFormat 日期格式化</h2>

<p>常用的做法在po类的日期类型字段上贴 <strong>@JsonFormat</strong>方式来设置格式</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@JsonFormat</span><span class="o">(</span><span class="n">timezone</span> <span class="o">=</span> <span class="s">"GMT+8"</span><span class="o">,</span><span class="n">pattern</span> <span class="o">=</span> <span class="s">"yyyy-MM-dd"</span><span class="o">)</span> <span class="c1">// 返回给前端json字符串格式</span>
<span class="nd">@DateTimeFormat</span><span class="o">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">"yyyy-MM-dd"</span><span class="o">)</span><span class="c1">//前端传参，接受格式，不是这个格式的就会报错</span>
<span class="kd">private</span> <span class="nc">Date</span> <span class="n">birthday</span><span class="o">;</span>
</code></pre></div></div>

<p>全局配置，可以在application.properties中配置</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 接受和返回的日期格式
</span><span class="py">spring.jackson.date-format</span><span class="p">=</span><span class="s">yyyy-MM-dd HH:mm:ss</span>
<span class="py">spring.jackson.time-zone</span><span class="p">=</span><span class="s">GMT+8 # 北京时间</span>
</code></pre></div></div>

<p>上面是SpringBoot默认使用的jackson进行时间格式设置，spring-boot-starter-web默认引入jackson依赖</p>

<h2 id="11redisopener">11、@RedisOpener</h2>

<p>点击源码</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Import</span><span class="o">({</span><span class="nc">RedisSelecter</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">RedisOpener</span> <span class="o">{</span>
  <span class="c1">// 开启模板类</span>
  <span class="kt">boolean</span> <span class="nf">enableTemplate</span><span class="o">()</span> <span class="k">default</span> <span class="kc">true</span><span class="o">;</span>
<span class="c1">// 开启缓存</span>
  <span class="kt">boolean</span> <span class="nf">enableCache</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>
<span class="c1">// 开启分布式锁</span>
  <span class="kt">boolean</span> <span class="nf">enableLock</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>可以看到会引入<code class="highlighter-rouge">RedisSelecter</code>选择器，点击源码</p>

<p><img src="\assets\images\2021\redis\redisselector.png" alt="" /></p>

<p>enableLock=true会开启RedissonConfig的配置，就是配置redisson分布式锁</p>

<p><img src="\assets\images\2021\redis\redisson-config.png" alt="" /></p>

<p><strong>@ControllerAdvice</strong></p>

<p>@ControllerAdvice是@Component注解的一个延伸注解，Spring会自动扫描并检测被@ControllerAdvice所标注的类。@ControllerAdvice需要和@ExceptionHandler、@InitBinder以及@ModelAttribute注解搭配使用，主要是用来处理控制器所抛出的异常信息。首先，我们需要定义一个被@ControllerAdvice所标注的类，在该类中，定义一个用于处理具体异常的方法，并使用@ExceptionHandler注解进行标记。此外，在有必要的时候，可以使用@InitBinder在类中进行全局的配置，还可以使用@ModelAttribute配置与视图相关的参数。使用@ControllerAdvice注解，就可以快速的创建统一的，自定义的异常处理类。</p>

<p>下面是一个使用@ControllerAdvice的示例代码：</p>

<p><img src="/assets/images/2021/spring/annotation-controlleradvice.jpg" alt="" /></p>

<p><strong>@ExceptionHandler</strong></p>

<p>@ExceptionHander注解用于标注处理特定类型异常类所抛出异常的方法。当控制器中的方法抛出异常时，Spring会自动捕获异常，并将捕获的异常信息传递给被@ExceptionHandler标注的方法。</p>

<p>下面是使用该注解的一个示例：</p>

<p><img src="/assets/images/2021/spring/annotation-exceptionhandler.jpg" alt="" /></p>

<p><strong>@ResponseBody</strong></p>

<p>@ResponseBody会自动将控制器中方法的返回值写入到HTTP响应中。特别的，@ResponseBody注解只能用在被@Controller注解标记的类中。如果在被@RestController标记的类中，则方法不需要使用@ResponseBody注解进行标注。@RestController相当于是@Controller和@ResponseBody的组合注解。</p>

<p>下面是使用该注解的一个示例</p>

<p><img src="/assets/images/2021/spring/annotation-responsebody.jpg" alt="" /></p>

<p><strong>@ResponseStatus</strong></p>

<p>@ResponseStatus注解可以标注请求处理方法。使用此注解，可以指定响应所需要的HTTP STATUS。特别地，我们可以使用HttpStauts类对该注解的value属性进行赋值。</p>

<p>下面是使用@ResponseStatus注解的一个示例：</p>

<p><img src="/assets/images/2021/spring/annotation-response-status.jpg" alt="" /></p>

<p><strong>@PathVariable</strong></p>

<p>@PathVariable注解是将方法中的参数绑定到请求URI中的模板变量上。可以通过@RequestMapping注解来指定URI的模板变量，然后使用@PathVariable注解将方法中的参数绑定到模板变量上。特别地，@PathVariable注解允许我们使用value或name属性来给参数取一个别名。</p>

<p>下面是使用此注解的一个示例：</p>

<p><img src="/assets/images/2021/spring/annotation-pathvariable.jpg" alt="" /></p>

<p>模板变量名需要使用“{ }”进行包裹，如果方法的参数名与URI模板变量名一致，则在@PathVariable中就可以省略别名的定义。下面是一个简写的示例：</p>

<p><img src="/assets/images/2021/spring/annotation-pathvariable-2.jpg" alt="" /></p>

<p>提示：如果参数是一个非必须的，可选的项，则可以在@PathVariable中设置require = false</p>

<p><strong>@RequestParam</strong></p>

<p>@RequestParam注解用于将方法的参数与Web请求的传递的参数进行绑定。使用@RequestParam可以轻松的访问HTTP请求参数的值。下面是使用该注解的代码示例：</p>

<p><img src="/assets/images/2021/spring/annotation-requestparam.jpg" alt="" /></p>

<p>该注解的其他属性配置与@PathVariable的配置相同，特别的，如果传递的参数为空，还可以通过defaultValue设置一个默认值。示例代码如下：</p>

<p><img src="/assets/images/2021/spring/annotation-request-param-2.jpg" alt="" /></p>

<p><strong>@Controller</strong></p>

<p>@Controller是@Component注解的一个延伸，<a href="http://mp.weixin.qq.com/s?__biz=Mzg2MjEwMjI1Mg==&amp;mid=2247488534&amp;idx=1&amp;sn=109a9ecbc8784fb71b5b92809d04449a&amp;chksm=ce0da395f97a2a83513f039a1b9f47ccd12701cdffac8bb0f3b24bbab13033338b6f9898a518&amp;scene=21#wechat_redirect">Spring</a>会自动扫描并配置被该注解标注的类。此注解用于标注Spring MVC的控制器</p>

<p><strong>@RestController</strong></p>

<p>@RestController是在Spring 4.0开始引入的，这是一个特定的控制器注解。此注解相当于@Controller和@ResponseBody的快捷方式。当使用此注解时，不需要再在方法上使用@ResponseBody注解。</p>

<p><strong>@ModelAttribute</strong></p>

<p>通过此注解，可以通过模型索引名称来访问已经存在于控制器中的model。下面是使用此注解的一个简单示例：</p>

<p><img src="/assets/images/2021/spring/annotation-modelattribute.jpg" alt="" /></p>

<p>与@PathVariable和@RequestParam注解一样，如果参数名与模型具有相同的名字，则不必指定索引名称，简写示例如下：</p>

<p><img src="/assets/images/2021/spring/annotation-modelattribute-2.jpg" alt="" /></p>

<p>特别地，如果使用@ModelAttribute对方法进行标注，Spring会将方法的返回值绑定到具体的Model上。示例如下</p>

<p><img src="/assets/images/2021/spring/annotation-modelattribute-3.jpg" alt="" /></p>

<p><strong>@InitBinder</strong></p>

<p>@InitBinder注解用于标注初始化<strong>WebDataBinider</strong>的方法，该方法用于对Http请求传递的表单数据进行处理，如时间格式化、字符串处理等。下面是使用此注解的示例：</p>

<p><img src="/assets/images/2021/spring/annotation-initbinder.jpg" alt="" /></p>

<h2 id="12spring-bean-注解">12、Spring Bean 注解</h2>

<p>主要列举与Spring Bean相关的4个注解以及它们的使用方式。</p>

<p><strong>@ComponentScan</strong></p>

<p>@ComponentScan注解用于配置Spring需要扫描的被组件注解注释的类所在的包。可以通过配置其basePackages属性或者value属性来配置需要扫描的包路径。value属性是basePackages的别名。此注解的用法如下</p>

<p><img src="/assets/images/2021/spring/annotation-componentscan.jpg" alt="" /></p>

<p><strong>@Component</strong></p>

<p>@Component注解用于标注一个普通的组件类，它没有明确的业务范围，只是通知Spring被此注解的类需要被纳入到Spring Bean容器中并进行管理。此注解的使用示例如下：</p>

<p><img src="/assets/images/2021/spring/annotation-component.jpg" alt="" /></p>

<p><strong>@Service</strong></p>

<p>@Service注解是@Component的一个延伸（特例），它用于标注业务逻辑类。与@Component注解一样，被此注解标注的类，会自动被Spring所管理。下面是使用@Service注解的示例：</p>

<p><img src="/assets/images/2021/spring/annotation-service.jpg" alt="" /></p>

<p><strong>@Repository</strong></p>

<p>@Repository注解也是@Component注解的延伸，与@Component注解一样，被此注解标注的类会被Spring自动管理起来，@Repository注解用于标注DAO层的数据持久化类。此注解的用法如下：</p>

<p><img src="/assets/images/2021/spring/annotation-repository.jpg" alt="" /></p>

<h2 id="13spring-dependency-注入">13、Spring Dependency 注入</h2>

<p><strong>@DependsOn</strong></p>

<p>@DependsOn注解可以配置Spring IoC容器在初始化一个Bean之前，先初始化其他的Bean对象。下面是此注解使用示例代码：</p>

<p><img src="/assets/images/2021/spring/annotation-dependson.jpg" alt="" /></p>

<p><strong>@Bean</strong></p>

<p>@Bean注解主要的作用是告知Spring，被此注解所标注的类将需要纳入到Bean管理工厂中。@Bean注解的用法很简单，在这里，着重介绍@Bean注解中initMethod和destroyMethod的用法。示例如下</p>

<p><img src="/assets/images/2021/spring/annotation-bean.jpg" alt="" /></p>

<p><strong>@Scope</strong></p>

<p>@Scope注解可以用来定义@Component标注的类的作用范围以及@Bean所标记的类的作用范围。@Scope所限定的作用范围有：singleton、prototype、request、session、globalSession或者其他的自定义范围。这里以prototype为例子进行讲解。当一个Spring Bean被声明为prototype（原型模式）时，在每次需要使用到该类的时候，Spring IoC容器都会初始化一个新的改类的实例。在定义一个Bean时，可以设置Bean的scope属性为prototype：scope=“prototype”,也可以使用@Scope注解设置，如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="nc">ConfigurableBeanFactory</span><span class="o">.</span><span class="na">SCOPE_PROPTOTYPE</span><span class="o">)</span>
</code></pre></div></div>

<p><img src="/assets/images/2021/spring/annotation-scope-prototype.jpg" alt="" /></p>

<p><strong>@Scope 单例模式</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="nc">ConfigurableBeanFactory</span><span class="o">.</span><span class="na">SCOPE_SINGLETON</span><span class="o">)</span>
</code></pre></div></div>

<p>当@Scope的作用范围设置成Singleton时，被此注解所标注的类只会被Spring IoC容器初始化一次。在默认情况下，Spring IoC容器所初始化的类实例都为singleton。同样的原理，此情形也有两种配置方式，示例代码如下：</p>

<p><img src="/assets/images/2021/spring/annotation-scope-singleton.jpg" alt="" /></p>

<h2 id="14容器配置注解">14、容器配置注解</h2>

<p><strong>@Autowired</strong></p>

<p>@Autowired注解用于标记Spring将要解析和注入的依赖项。此注解可以作用在构造函数、字段和setter方法上。</p>

<p>作用于构造函数</p>

<p><img src="/assets/images/2021/spring/annotation-autowired-1.jpg" alt="" /></p>

<p>作用于setter方法</p>

<p><img src="/assets/images/2021/spring/annotation-autowired-2.jpg" alt="" /></p>

<p>作用于字段</p>

<p>@Autowired注解标注字段是最简单的，只需要在对应的字段上加入此注解即可，示例代码如下：</p>

<p><img src="/assets/images/2021/spring/annotation-autowired-3.jpg" alt="" /></p>

<p><strong>@Primary</strong></p>

<p>当系统中需要配置多个具有相同类型的bean时，@Primary可以定义这些Bean的优先级。下面将给出一个实例代码来说明这一特性：</p>

<p><img src="/assets/images/2021/spring/annotation-autowired-parimary.jpg" alt="" /></p>

<p>结果</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this is send DingDing method message.
</code></pre></div></div>

<p><strong>@Qualifier</strong></p>

<p>当系统中存在同一类型的多个Bean时，@Autowired在进行依赖注入的时候就不知道该选择哪一个实现类进行注入。此时，我们可以使用@Qualifier注解来微调，帮助@Autowired选择正确的依赖项。下面是一个关于此注解的代码示例：</p>

<p><img src="/assets/images/2021/spring/annotation-qualifier.jpg" alt="" /></p>

<h2 id="15springboot注解">15、SpringBoot注解</h2>

<p><strong>@SpringBootApplication</strong></p>

<p>@SpringBootApplication注解是一个快捷的配置注解，在被它标注的类中，可以定义一个或多个Bean，并自动触发自动配置Bean和自动扫描组件。此注解相当于@Configuration、@EnableAutoConfiguration和@ComponentScan的组合。在Spring Boot应用程序的主类中，就使用了此注解。示例代码如下</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span><span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
   <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
 <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@EnableAutoConfiguration</strong></p>

<p>@EnableAutoConfiguration注解用于通知Spring，根据当前类路径下引入的依赖包，自动配置与这些依赖包相关的配置项。</p>

<p><strong>@ConditionalOnClass与@ConditionalOnMissingClass</strong></p>

<p>这两个注解属于类条件注解，它们根据是否存在某个类作为判断依据来决定是否要执行某些配置。下面是一个简单的示例代码：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ConditionalOnClass</span><span class="o">(</span><span class="nc">DataSource</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MySQLAutoConfiguration</span> <span class="o">{</span>
 <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@ConditionalOnBean与@ConditionalOnMissingBean</strong></p>

<p>这两个注解属于对象条件注解，根据是否存在某个对象作为依据来决定是否要执行某些配置方法。示例代码如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Bean</span>
<span class="nd">@ConditionalOnBean</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"dataSource"</span><span class="o">)</span>
<span class="nc">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">(){</span>
 <span class="c1">//...</span>
<span class="o">}</span>
<span class="nd">@Bean</span>
<span class="nd">@ConditionalOnMissingBean</span>
<span class="kd">public</span> <span class="nc">MyBean</span> <span class="nf">myBean</span><span class="o">(){</span>
 <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@ConditionalOnProperty</strong></p>

<p>@ConditionalOnProperty注解会根据Spring配置文件中的配置项是否满足配置要求，从而决定是否要执行被其标注的方法。示例代码如下</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@ConditionalOnProperty</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"alipay"</span><span class="o">,</span><span class="n">havingValue</span><span class="o">=</span><span class="s">"on"</span><span class="o">)</span>
<span class="nc">Alipay</span> <span class="nf">alipay</span><span class="o">(){</span>
 <span class="k">return</span> <span class="k">new</span> <span class="nf">Alipay</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@ConditionalOnResource</strong></p>

<p>此注解用于检测当某个配置文件存在，则触发被其标注的方法，下面是使用此注解的代码示例：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnResource</span><span class="o">(</span><span class="n">resources</span> <span class="o">=</span> <span class="s">"classpath:website.properties"</span><span class="o">)</span>
<span class="nc">Properties</span> <span class="nf">addWebsiteProperties</span><span class="o">(){</span>
 <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@ConditionalOnWebApplication与@ConditionalOnNotWebApplication</strong></p>

<p>这两个注解用于判断当前的应用程序是否是Web应用程序。如果当前应用是Web应用程序，则使用Spring WebApplicationContext,并定义其会话的生命周期。下面是一个简单的示例：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnWebApplication</span>
<span class="nc">HealthCheckController</span> <span class="nf">healthCheckController</span><span class="o">(){</span>
 <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@ConditionalExpression</strong></p>

<p>此注解可以让我们控制更细粒度的基于表达式的配置条件限制。当表达式满足某个条件或者表达式为真的时候，将会执行被此注解标注的方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@ConditionalException</span><span class="o">(</span><span class="s">"${localstore} &amp;&amp; ${local == 'true'}"</span><span class="o">)</span>
<span class="nc">LocalFileStore</span> <span class="nf">store</span><span class="o">(){</span>
 <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@Conditional</strong></p>

<p>@Conditional注解可以控制更为复杂的配置条件。在Spring内置的条件控制注解不满足应用需求的时候，可以使用此注解定义自定义的控制条件，以达到自定义的要求。下面是使用该注解的简单示例：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Conditioanl</span><span class="o">(</span><span class="nc">CustomConditioanl</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nc">CustomProperties</span> <span class="nf">addCustomProperties</span><span class="o">(){</span>
 <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>


            <div>
   <!-- <p align="center">
     	  
         <img src="/assets/images/keeppuresmile.jpg" >
         <br/>
         微信扫描二维码，关注一个有故事的程序员
        

   </p>
   <p align="center" style="margin-top: 15px; font-size: 11px;color: #cc0000;">
       <strong>（转载本站文章请注明作者和出处 <a href="http://www.ityouknow.com">纯洁的微笑-ityouknow</a>）</strong>
   </p>
   <p align="center" style="margin-top: 15px; font-size: 16px;color: #337ab7;">
       <strong><a href="http://www.justdojava.com/" target="_blank">点击了解 ：Java 技术人的网站</a></strong>
   </p> -->
</div>

            <!-- Comments -->
            <div class="comment">
             

  

  
        <div id="gitalk-container"></div>
        <script src="/assets/js/gitalk.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
        <script>
        var gitalk = new Gitalk({
            id: '/springboot/2020/04/20/spring-annotation.html',
            clientID: '6cd8ad4d1cf1d1e6ad95',
            clientSecret: 'c4ce22a25efe50bfd60da67c990b534bc99a6424',
            repo: 'aikomj.github.io',
            owner: 'aikomj',
            admin: ['aikomj'],
            labels: ['gitalk'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
  


            </div>
        </div>

        <div class="col-md-3">
            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>
        

    </div>
     <!--<div class="asb-post-01">-->
        <!--<div class="mask"></div>-->
            <!--<div class="info">-->
                <!--<div>扫码关注公众号：<span style="color: #E9405A; font-weight: bold;">纯洁的微笑</span></div>-->
            <!--<div>-->
            <!--<span>发送 </span><span class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span>-->
            <!--<div>-->
                <!--即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章-->
            <!--</div>-->
            <!--<img class="code-img" style="width: 300px;display:unset" src="/assets/images/keeppuresmile.jpg">-->
        <!--</div>-->
    <!--</div>-->
</article>

        </div>

    
<footer class="container">
    <div class="site-footer">
       <!--  <div class="site-footer-icons">
            <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
               知乎
            </a>
            <a target="_blank" href="http://weibo.com/ityouknow">
               微博
            </a>
            <a target="_blank" href="https://github.com/ityouknow">
                GitHub
            </a>
        </div> -->
        <!-- <div class="card text-center">
            <ul class="list-inline" style="margin-left: 0;">
               <li>
                <a target="_blank" href="https://github.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a target="_blank" href="https://www.zhihu.com/people/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa  fa-stack-1x fa-inverse">知</i>
                  </span>
                </a>
              </li>
                  <li>
                <a target="_blank" href="https://weibo.com/ityouknow">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          </ul>
        </div> -->
        <div class="site-footer-links mobile-hidden">
            
        </div>
        <div class="scrolltop">
            <a href="javascript:window.scrollTo(0,0)" >TOP</a>
        </div>
        <div class="rss">
            <a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a>
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>
    </div>
    <!-- Third-Party JS -->
    <script type="text/javascript" src="/bower_components/geopattern/js/geopattern.min.js"></script>
    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>
    
    
     <!-- Cnzz Analytics -->
       <div style="display:none">
         <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260945749'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1260945749' type='text/javascript'%3E%3C/script%3E"));</script>
       </div>
     <!-- Cnzz Analytics -->
</footer>


    </body>

</html>
